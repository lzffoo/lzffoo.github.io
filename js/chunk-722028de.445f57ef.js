(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-722028de"],{"0329":function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"hello",attrs:{align:"center"},on:{contextmenu:t.initContenMenu}},[i("div",{staticClass:"container"},[i("el-row",[i("el-col",{attrs:{span:t.cb1}},[i("el-select",{attrs:{placeholder:"请选择"},on:{change:t.changeGame},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}},t._l(t.options,(function(e){return i("el-option-group",{key:e.label,attrs:{label:e.label}},t._l(e.options,(function(t){return i("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)})),1),i("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{drag:"","show-file-list":t.falseFlag,action:"#",multiple:t.fileMulti,accept:t.fileAcc,"http-request":t.fileUpload,success:t.fileSuccess}},[i("i",{staticClass:"el-icon-upload"}),i("div",{staticClass:"el-upload__text"},[t._v("加载离线存档"),i("em",[t._v("点击上传")])])]),i("el-upload",{ref:"upload2",staticClass:"upload-demo",attrs:{drag:"","show-file-list":t.falseFlag,action:"#",multiple:t.fileMulti,accept:t.fileAcc,"http-request":t.fileUpload2,success:t.fileSuccess}},[i("i",{staticClass:"el-icon-upload"}),i("div",{staticClass:"el-upload__text"},[t._v("加在本地NES游戏"),i("em",[t._v("点击上传")])])])],1),i("el-col",{attrs:{span:t.cb2}},[i("el-tag",{staticStyle:{float:"left"},model:{value:t.fps,callback:function(e){t.fps=e},expression:"fps"}},[t._v("FPS:"+t._s(t.fps))])],1),i("el-col",{attrs:{span:t.zj}},[i("DIV",{staticStyle:{"text-align":"center"},attrs:{ID:"emulator"}},[i("canvas",{attrs:{id:"nes-canvas",width:t.canWidth,height:t.canHeigh}})])],1),i("el-col",{attrs:{span:t.cb3}},[i("el-collapse",{attrs:{accordion:""},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[i("el-collapse-item",{attrs:{title:"手柄设置",name:"gamepad"}},t._l(t.gamePadSet,(function(e,s){return i("el-row",{key:s},[i("el-col",{attrs:{span:t.labSpan}},[i("el-tag",[t._v(t._s(e.label))])],1),i("el-col",{attrs:{span:t.inputSpan}},[i("el-input",{attrs:{placeholder:"请输入内容"},model:{value:e.key,callback:function(i){t.$set(e,"key",i)},expression:"item.key"}})],1)],1)})),1),i("el-collapse-item",{attrs:{title:"p1",name:"p1"}},t._l(t.player1Set,(function(e,s){return i("el-row",{key:s},[i("el-col",{attrs:{span:t.labSpan}},[i("el-tag",[t._v(t._s(e.label))])],1),i("el-col",{attrs:{span:t.inputSpan}},[i("el-input",{attrs:{placeholder:"请输入内容"},model:{value:t.keyMap[e.key],callback:function(i){t.$set(t.keyMap,e.key,i)},expression:"keyMap[item.key]"}})],1)],1)})),1),i("el-collapse-item",{attrs:{title:"p2",name:"p2"}},t._l(t.player2Set,(function(e,s){return i("el-row",{key:s},[i("el-col",{attrs:{span:t.labSpan}},[i("el-tag",[t._v(t._s(e.label))])],1),i("el-col",{attrs:{span:t.inputSpan}},[i("el-input",{attrs:{placeholder:"请输入内容"},model:{value:t.keyMap[e.key],callback:function(i){t.$set(t.keyMap,e.key,i)},expression:"keyMap[item.key]"}})],1)],1)})),1)],1)],1)],1)],1)])},r=[];i("d3b7");function a(t,e,i,s,r,a,n){try{var h=t[a](n),o=h.value}catch(l){return void i(l)}h.done?e(o):Promise.resolve(o).then(s,r)}function n(t){return function(){var e=this,i=arguments;return new Promise((function(s,r){var n=t.apply(e,i);function h(t){a(n,s,r,h,o,"next",t)}function o(t){a(n,s,r,h,o,"throw",t)}h(void 0)}))}}i("99af"),i("b680"),i("ac1f"),i("1276"),i("20bf"),i("5cc6"),i("9a8c"),i("a975"),i("735e"),i("c1ac"),i("d139"),i("3a7b"),i("d5d6"),i("82f8"),i("e91f"),i("60bd"),i("5f96"),i("3280"),i("3fcc"),i("ca91"),i("25a1"),i("cd26"),i("3c5d"),i("2954"),i("649e"),i("219c"),i("170b"),i("b39a"),i("72f7"),i("25f0"),i("3ca3"),i("ddb0"),i("2b3d"),i("9861"),i("a15b"),i("96cf"),i("cfc3"),i("c19f"),i("8a59"),i("fb2c"),i("bf19");var h=function(){this.state=new Array(8);for(var t=0;t<this.state.length;t++)this.state[t]=64};h.BUTTON_A=0,h.BUTTON_B=1,h.BUTTON_SELECT=2,h.BUTTON_START=3,h.BUTTON_UP=4,h.BUTTON_DOWN=5,h.BUTTON_LEFT=6,h.BUTTON_RIGHT=7,h.prototype={buttonDown:function(t){this.state[t]=65},buttonUp:function(t){this.state[t]=64}};i("fb6a");var o={copyArrayElements:function(t,e,i,s,r){for(var a=0;a<r;++a)i[s+a]=t[e+a]},copyArray:function(t){return t.slice(0)},fromJSON:function(t,e){for(var i=0;i<t.JSON_PROPERTIES.length;i++)t[t.JSON_PROPERTIES[i]]=e[t.JSON_PROPERTIES[i]]},toJSON:function(t){for(var e={},i=0;i<t.JSON_PROPERTIES.length;i++)e[t.JSON_PROPERTIES[i]]=t[t.JSON_PROPERTIES[i]];return e}},l=function(t){this.nes=t,this.mem=null,this.REG_ACC=null,this.REG_X=null,this.REG_Y=null,this.REG_SP=null,this.REG_PC=null,this.REG_PC_NEW=null,this.REG_STATUS=null,this.F_CARRY=null,this.F_DECIMAL=null,this.F_INTERRUPT=null,this.F_INTERRUPT_NEW=null,this.F_OVERFLOW=null,this.F_SIGN=null,this.F_ZERO=null,this.F_NOTUSED=null,this.F_NOTUSED_NEW=null,this.F_BRK=null,this.F_BRK_NEW=null,this.opdata=null,this.cyclesToHalt=null,this.crash=null,this.irqRequested=null,this.irqType=null,this.reset()};l.prototype={IRQ_NORMAL:0,IRQ_NMI:1,IRQ_RESET:2,reset:function(){this.mem=new Array(65536);for(var t=0;t<8192;t++)this.mem[t]=255;for(var e=0;e<4;e++){var i=2048*e;this.mem[i+8]=247,this.mem[i+9]=239,this.mem[i+10]=223,this.mem[i+15]=191}for(var s=8193;s<this.mem.length;s++)this.mem[s]=0;this.REG_ACC=0,this.REG_X=0,this.REG_Y=0,this.REG_SP=511,this.REG_PC=32767,this.REG_PC_NEW=32767,this.REG_STATUS=40,this.setStatus(40),this.F_CARRY=0,this.F_DECIMAL=0,this.F_INTERRUPT=1,this.F_INTERRUPT_NEW=1,this.F_OVERFLOW=0,this.F_SIGN=0,this.F_ZERO=1,this.F_NOTUSED=1,this.F_NOTUSED_NEW=1,this.F_BRK=1,this.F_BRK_NEW=1,this.opdata=(new u).opdata,this.cyclesToHalt=0,this.crash=!1,this.irqRequested=!1,this.irqType=null},emulate:function(){var t,e;if(this.irqRequested){switch(t=this.F_CARRY|(0===this.F_ZERO?1:0)<<1|this.F_INTERRUPT<<2|this.F_DECIMAL<<3|this.F_BRK<<4|this.F_NOTUSED<<5|this.F_OVERFLOW<<6|this.F_SIGN<<7,this.REG_PC_NEW=this.REG_PC,this.F_INTERRUPT_NEW=this.F_INTERRUPT,this.irqType){case 0:if(0!==this.F_INTERRUPT)break;this.doIrq(t);break;case 1:this.doNonMaskableInterrupt(t);break;case 2:this.doResetInterrupt();break}this.REG_PC=this.REG_PC_NEW,this.F_INTERRUPT=this.F_INTERRUPT_NEW,this.F_BRK=this.F_BRK_NEW,this.irqRequested=!1}var i=this.opdata[this.nes.mmap.load(this.REG_PC+1)],s=i>>24,r=0,a=i>>8&255,n=this.REG_PC;this.REG_PC+=i>>16&255;var h=0;switch(a){case 0:h=this.load(n+2);break;case 1:h=this.load(n+2),h+=h<128?this.REG_PC:this.REG_PC-256;break;case 2:break;case 3:h=this.load16bit(n+2);break;case 4:h=this.REG_ACC;break;case 5:h=this.REG_PC;break;case 6:h=this.load(n+2)+this.REG_X&255;break;case 7:h=this.load(n+2)+this.REG_Y&255;break;case 8:h=this.load16bit(n+2),(65280&h)!==(h+this.REG_X&65280)&&(r=1),h+=this.REG_X;break;case 9:h=this.load16bit(n+2),(65280&h)!==(h+this.REG_Y&65280)&&(r=1),h+=this.REG_Y;break;case 10:h=this.load(n+2),(65280&h)!==(h+this.REG_X&65280)&&(r=1),h+=this.REG_X,h&=255,h=this.load16bit(h);break;case 11:h=this.load16bit(this.load(n+2)),(65280&h)!==(h+this.REG_Y&65280)&&(r=1),h+=this.REG_Y;break;case 12:h=this.load16bit(n+2),h=h<8191?this.mem[h]+(this.mem[65280&h|1+(255&h)&255]<<8):this.nes.mmap.load(h)+(this.nes.mmap.load(65280&h|1+(255&h)&255)<<8);break}switch(h&=65535,255&i){case 0:t=this.REG_ACC+this.load(h)+this.F_CARRY,0===(128&(this.REG_ACC^this.load(h)))&&0!==(128&(this.REG_ACC^t))?this.F_OVERFLOW=1:this.F_OVERFLOW=0,this.F_CARRY=t>255?1:0,this.F_SIGN=t>>7&1,this.F_ZERO=255&t,this.REG_ACC=255&t,s+=r;break;case 1:this.REG_ACC=this.REG_ACC&this.load(h),this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC,11!==a&&(s+=r);break;case 2:4===a?(this.F_CARRY=this.REG_ACC>>7&1,this.REG_ACC=this.REG_ACC<<1&255,this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC):(t=this.load(h),this.F_CARRY=t>>7&1,t=t<<1&255,this.F_SIGN=t>>7&1,this.F_ZERO=t,this.write(h,t));break;case 3:0===this.F_CARRY&&(s+=(65280&n)!==(65280&h)?2:1,this.REG_PC=h);break;case 4:1===this.F_CARRY&&(s+=(65280&n)!==(65280&h)?2:1,this.REG_PC=h);break;case 5:0===this.F_ZERO&&(s+=(65280&n)!==(65280&h)?2:1,this.REG_PC=h);break;case 6:t=this.load(h),this.F_SIGN=t>>7&1,this.F_OVERFLOW=t>>6&1,t&=this.REG_ACC,this.F_ZERO=t;break;case 7:1===this.F_SIGN&&(s++,this.REG_PC=h);break;case 8:0!==this.F_ZERO&&(s+=(65280&n)!==(65280&h)?2:1,this.REG_PC=h);break;case 9:0===this.F_SIGN&&(s+=(65280&n)!==(65280&h)?2:1,this.REG_PC=h);break;case 10:this.REG_PC+=2,this.push(this.REG_PC>>8&255),this.push(255&this.REG_PC),this.F_BRK=1,this.push(this.F_CARRY|(0===this.F_ZERO?1:0)<<1|this.F_INTERRUPT<<2|this.F_DECIMAL<<3|this.F_BRK<<4|this.F_NOTUSED<<5|this.F_OVERFLOW<<6|this.F_SIGN<<7),this.F_INTERRUPT=1,this.REG_PC=this.load16bit(65534),this.REG_PC--;break;case 11:0===this.F_OVERFLOW&&(s+=(65280&n)!==(65280&h)?2:1,this.REG_PC=h);break;case 12:1===this.F_OVERFLOW&&(s+=(65280&n)!==(65280&h)?2:1,this.REG_PC=h);break;case 13:this.F_CARRY=0;break;case 14:this.F_DECIMAL=0;break;case 15:this.F_INTERRUPT=0;break;case 16:this.F_OVERFLOW=0;break;case 17:t=this.REG_ACC-this.load(h),this.F_CARRY=t>=0?1:0,this.F_SIGN=t>>7&1,this.F_ZERO=255&t,s+=r;break;case 18:t=this.REG_X-this.load(h),this.F_CARRY=t>=0?1:0,this.F_SIGN=t>>7&1,this.F_ZERO=255&t;break;case 19:t=this.REG_Y-this.load(h),this.F_CARRY=t>=0?1:0,this.F_SIGN=t>>7&1,this.F_ZERO=255&t;break;case 20:t=this.load(h)-1&255,this.F_SIGN=t>>7&1,this.F_ZERO=t,this.write(h,t);break;case 21:this.REG_X=this.REG_X-1&255,this.F_SIGN=this.REG_X>>7&1,this.F_ZERO=this.REG_X;break;case 22:this.REG_Y=this.REG_Y-1&255,this.F_SIGN=this.REG_Y>>7&1,this.F_ZERO=this.REG_Y;break;case 23:this.REG_ACC=255&(this.load(h)^this.REG_ACC),this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC,s+=r;break;case 24:t=this.load(h)+1&255,this.F_SIGN=t>>7&1,this.F_ZERO=t,this.write(h,255&t);break;case 25:this.REG_X=this.REG_X+1&255,this.F_SIGN=this.REG_X>>7&1,this.F_ZERO=this.REG_X;break;case 26:this.REG_Y++,this.REG_Y&=255,this.F_SIGN=this.REG_Y>>7&1,this.F_ZERO=this.REG_Y;break;case 27:this.REG_PC=h-1;break;case 28:this.push(this.REG_PC>>8&255),this.push(255&this.REG_PC),this.REG_PC=h-1;break;case 29:this.REG_ACC=this.load(h),this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC,s+=r;break;case 30:this.REG_X=this.load(h),this.F_SIGN=this.REG_X>>7&1,this.F_ZERO=this.REG_X,s+=r;break;case 31:this.REG_Y=this.load(h),this.F_SIGN=this.REG_Y>>7&1,this.F_ZERO=this.REG_Y,s+=r;break;case 32:4===a?(t=255&this.REG_ACC,this.F_CARRY=1&t,t>>=1,this.REG_ACC=t):(t=255&this.load(h),this.F_CARRY=1&t,t>>=1,this.write(h,t)),this.F_SIGN=0,this.F_ZERO=t;break;case 33:break;case 34:t=255&(this.load(h)|this.REG_ACC),this.F_SIGN=t>>7&1,this.F_ZERO=t,this.REG_ACC=t,11!==a&&(s+=r);break;case 35:this.push(this.REG_ACC);break;case 36:this.F_BRK=1,this.push(this.F_CARRY|(0===this.F_ZERO?1:0)<<1|this.F_INTERRUPT<<2|this.F_DECIMAL<<3|this.F_BRK<<4|this.F_NOTUSED<<5|this.F_OVERFLOW<<6|this.F_SIGN<<7);break;case 37:this.REG_ACC=this.pull(),this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC;break;case 38:t=this.pull(),this.F_CARRY=1&t,this.F_ZERO=1===(t>>1&1)?0:1,this.F_INTERRUPT=t>>2&1,this.F_DECIMAL=t>>3&1,this.F_BRK=t>>4&1,this.F_NOTUSED=t>>5&1,this.F_OVERFLOW=t>>6&1,this.F_SIGN=t>>7&1,this.F_NOTUSED=1;break;case 39:4===a?(t=this.REG_ACC,e=this.F_CARRY,this.F_CARRY=t>>7&1,t=(t<<1&255)+e,this.REG_ACC=t):(t=this.load(h),e=this.F_CARRY,this.F_CARRY=t>>7&1,t=(t<<1&255)+e,this.write(h,t)),this.F_SIGN=t>>7&1,this.F_ZERO=t;break;case 40:4===a?(e=this.F_CARRY<<7,this.F_CARRY=1&this.REG_ACC,t=(this.REG_ACC>>1)+e,this.REG_ACC=t):(t=this.load(h),e=this.F_CARRY<<7,this.F_CARRY=1&t,t=(t>>1)+e,this.write(h,t)),this.F_SIGN=t>>7&1,this.F_ZERO=t;break;case 41:if(t=this.pull(),this.F_CARRY=1&t,this.F_ZERO=0===(t>>1&1)?1:0,this.F_INTERRUPT=t>>2&1,this.F_DECIMAL=t>>3&1,this.F_BRK=t>>4&1,this.F_NOTUSED=t>>5&1,this.F_OVERFLOW=t>>6&1,this.F_SIGN=t>>7&1,this.REG_PC=this.pull(),this.REG_PC+=this.pull()<<8,65535===this.REG_PC)return;this.REG_PC--,this.F_NOTUSED=1;break;case 42:if(this.REG_PC=this.pull(),this.REG_PC+=this.pull()<<8,65535===this.REG_PC)return;break;case 43:t=this.REG_ACC-this.load(h)-(1-this.F_CARRY),this.F_SIGN=t>>7&1,this.F_ZERO=255&t,0!==(128&(this.REG_ACC^t))&&0!==(128&(this.REG_ACC^this.load(h)))?this.F_OVERFLOW=1:this.F_OVERFLOW=0,this.F_CARRY=t<0?0:1,this.REG_ACC=255&t,11!==a&&(s+=r);break;case 44:this.F_CARRY=1;break;case 45:this.F_DECIMAL=1;break;case 46:this.F_INTERRUPT=1;break;case 47:this.write(h,this.REG_ACC);break;case 48:this.write(h,this.REG_X);break;case 49:this.write(h,this.REG_Y);break;case 50:this.REG_X=this.REG_ACC,this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC;break;case 51:this.REG_Y=this.REG_ACC,this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC;break;case 52:this.REG_X=this.REG_SP-256,this.F_SIGN=this.REG_SP>>7&1,this.F_ZERO=this.REG_X;break;case 53:this.REG_ACC=this.REG_X,this.F_SIGN=this.REG_X>>7&1,this.F_ZERO=this.REG_X;break;case 54:this.REG_SP=this.REG_X+256,this.stackWrap();break;case 55:this.REG_ACC=this.REG_Y,this.F_SIGN=this.REG_Y>>7&1,this.F_ZERO=this.REG_Y;break;case 56:t=this.REG_ACC&this.load(h),this.F_CARRY=1&t,this.REG_ACC=this.F_ZERO=t>>1,this.F_SIGN=0;break;case 57:this.REG_ACC=this.F_ZERO=this.REG_ACC&this.load(h),this.F_CARRY=this.F_SIGN=this.REG_ACC>>7&1;break;case 58:t=this.REG_ACC&this.load(h),this.REG_ACC=this.F_ZERO=(t>>1)+(this.F_CARRY<<7),this.F_SIGN=this.F_CARRY,this.F_CARRY=t>>7&1,this.F_OVERFLOW=1&(t>>7^t>>6);break;case 59:t=(this.REG_X&this.REG_ACC)-this.load(h),this.F_SIGN=t>>7&1,this.F_ZERO=255&t,0!==(128&(this.REG_X^t))&&0!==(128&(this.REG_X^this.load(h)))?this.F_OVERFLOW=1:this.F_OVERFLOW=0,this.F_CARRY=t<0?0:1,this.REG_X=255&t;break;case 60:this.REG_ACC=this.REG_X=this.F_ZERO=this.load(h),this.F_SIGN=this.REG_ACC>>7&1,s+=r;break;case 61:this.write(h,this.REG_ACC&this.REG_X);break;case 62:t=this.load(h)-1&255,this.write(h,t),t=this.REG_ACC-t,this.F_CARRY=t>=0?1:0,this.F_SIGN=t>>7&1,this.F_ZERO=255&t,11!==a&&(s+=r);break;case 63:t=this.load(h)+1&255,this.write(h,t),t=this.REG_ACC-t-(1-this.F_CARRY),this.F_SIGN=t>>7&1,this.F_ZERO=255&t,0!==(128&(this.REG_ACC^t))&&0!==(128&(this.REG_ACC^this.load(h)))?this.F_OVERFLOW=1:this.F_OVERFLOW=0,this.F_CARRY=t<0?0:1,this.REG_ACC=255&t,11!==a&&(s+=r);break;case 64:t=this.load(h),e=this.F_CARRY,this.F_CARRY=t>>7&1,t=(t<<1&255)+e,this.write(h,t),this.REG_ACC=this.REG_ACC&t,this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC,11!==a&&(s+=r);break;case 65:t=this.load(h),e=this.F_CARRY<<7,this.F_CARRY=1&t,t=(t>>1)+e,this.write(h,t),t=this.REG_ACC+this.load(h)+this.F_CARRY,0===(128&(this.REG_ACC^this.load(h)))&&0!==(128&(this.REG_ACC^t))?this.F_OVERFLOW=1:this.F_OVERFLOW=0,this.F_CARRY=t>255?1:0,this.F_SIGN=t>>7&1,this.F_ZERO=255&t,this.REG_ACC=255&t,11!==a&&(s+=r);break;case 66:t=this.load(h),this.F_CARRY=t>>7&1,t=t<<1&255,this.write(h,t),this.REG_ACC=this.REG_ACC|t,this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC,11!==a&&(s+=r);break;case 67:t=255&this.load(h),this.F_CARRY=1&t,t>>=1,this.write(h,t),this.REG_ACC=this.REG_ACC^t,this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC,11!==a&&(s+=r);break;case 68:break;case 69:this.load(h),11!==a&&(s+=r);break;default:this.nes.stop(),this.nes.crashMessage="Game crashed, invalid opcode at address $"+n.toString(16);break}return s},load:function(t){return t<8192?this.mem[2047&t]:this.nes.mmap.load(t)},load16bit:function(t){return t<8191?this.mem[2047&t]|this.mem[t+1&2047]<<8:this.nes.mmap.load(t)|this.nes.mmap.load(t+1)<<8},write:function(t,e){t<8192?this.mem[2047&t]=e:this.nes.mmap.write(t,e)},requestIrq:function(t){this.irqRequested&&t===this.IRQ_NORMAL||(this.irqRequested=!0,this.irqType=t)},push:function(t){this.nes.mmap.write(this.REG_SP,t),this.REG_SP--,this.REG_SP=256|255&this.REG_SP},stackWrap:function(){this.REG_SP=256|255&this.REG_SP},pull:function(){return this.REG_SP++,this.REG_SP=256|255&this.REG_SP,this.nes.mmap.load(this.REG_SP)},pageCrossed:function(t,e){return(65280&t)!==(65280&e)},haltCycles:function(t){this.cyclesToHalt+=t},doNonMaskableInterrupt:function(t){0!==(128&this.nes.mmap.load(8192))&&(this.REG_PC_NEW++,this.push(this.REG_PC_NEW>>8&255),this.push(255&this.REG_PC_NEW),this.push(t),this.REG_PC_NEW=this.nes.mmap.load(65530)|this.nes.mmap.load(65531)<<8,this.REG_PC_NEW--)},doResetInterrupt:function(){this.REG_PC_NEW=this.nes.mmap.load(65532)|this.nes.mmap.load(65533)<<8,this.REG_PC_NEW--},doIrq:function(t){this.REG_PC_NEW++,this.push(this.REG_PC_NEW>>8&255),this.push(255&this.REG_PC_NEW),this.push(t),this.F_INTERRUPT_NEW=1,this.F_BRK_NEW=0,this.REG_PC_NEW=this.nes.mmap.load(65534)|this.nes.mmap.load(65535)<<8,this.REG_PC_NEW--},getStatus:function(){return this.F_CARRY|this.F_ZERO<<1|this.F_INTERRUPT<<2|this.F_DECIMAL<<3|this.F_BRK<<4|this.F_NOTUSED<<5|this.F_OVERFLOW<<6|this.F_SIGN<<7},setStatus:function(t){this.F_CARRY=1&t,this.F_ZERO=t>>1&1,this.F_INTERRUPT=t>>2&1,this.F_DECIMAL=t>>3&1,this.F_BRK=t>>4&1,this.F_NOTUSED=t>>5&1,this.F_OVERFLOW=t>>6&1,this.F_SIGN=t>>7&1},JSON_PROPERTIES:["mem","cyclesToHalt","irqRequested","irqType","REG_ACC","REG_X","REG_Y","REG_SP","REG_PC","REG_PC_NEW","REG_STATUS","F_CARRY","F_DECIMAL","F_INTERRUPT","F_INTERRUPT_NEW","F_OVERFLOW","F_SIGN","F_ZERO","F_NOTUSED","F_NOTUSED_NEW","F_BRK","F_BRK_NEW"],toJSON:function(){return o.toJSON(this)},fromJSON:function(t){o.fromJSON(this,t)}};var u=function(){this.opdata=new Array(256);for(var t=0;t<256;t++)this.opdata[t]=255;this.setOp(this.INS_ADC,105,this.ADDR_IMM,2,2),this.setOp(this.INS_ADC,101,this.ADDR_ZP,2,3),this.setOp(this.INS_ADC,117,this.ADDR_ZPX,2,4),this.setOp(this.INS_ADC,109,this.ADDR_ABS,3,4),this.setOp(this.INS_ADC,125,this.ADDR_ABSX,3,4),this.setOp(this.INS_ADC,121,this.ADDR_ABSY,3,4),this.setOp(this.INS_ADC,97,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_ADC,113,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_AND,41,this.ADDR_IMM,2,2),this.setOp(this.INS_AND,37,this.ADDR_ZP,2,3),this.setOp(this.INS_AND,53,this.ADDR_ZPX,2,4),this.setOp(this.INS_AND,45,this.ADDR_ABS,3,4),this.setOp(this.INS_AND,61,this.ADDR_ABSX,3,4),this.setOp(this.INS_AND,57,this.ADDR_ABSY,3,4),this.setOp(this.INS_AND,33,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_AND,49,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_ASL,10,this.ADDR_ACC,1,2),this.setOp(this.INS_ASL,6,this.ADDR_ZP,2,5),this.setOp(this.INS_ASL,22,this.ADDR_ZPX,2,6),this.setOp(this.INS_ASL,14,this.ADDR_ABS,3,6),this.setOp(this.INS_ASL,30,this.ADDR_ABSX,3,7),this.setOp(this.INS_BCC,144,this.ADDR_REL,2,2),this.setOp(this.INS_BCS,176,this.ADDR_REL,2,2),this.setOp(this.INS_BEQ,240,this.ADDR_REL,2,2),this.setOp(this.INS_BIT,36,this.ADDR_ZP,2,3),this.setOp(this.INS_BIT,44,this.ADDR_ABS,3,4),this.setOp(this.INS_BMI,48,this.ADDR_REL,2,2),this.setOp(this.INS_BNE,208,this.ADDR_REL,2,2),this.setOp(this.INS_BPL,16,this.ADDR_REL,2,2),this.setOp(this.INS_BRK,0,this.ADDR_IMP,1,7),this.setOp(this.INS_BVC,80,this.ADDR_REL,2,2),this.setOp(this.INS_BVS,112,this.ADDR_REL,2,2),this.setOp(this.INS_CLC,24,this.ADDR_IMP,1,2),this.setOp(this.INS_CLD,216,this.ADDR_IMP,1,2),this.setOp(this.INS_CLI,88,this.ADDR_IMP,1,2),this.setOp(this.INS_CLV,184,this.ADDR_IMP,1,2),this.setOp(this.INS_CMP,201,this.ADDR_IMM,2,2),this.setOp(this.INS_CMP,197,this.ADDR_ZP,2,3),this.setOp(this.INS_CMP,213,this.ADDR_ZPX,2,4),this.setOp(this.INS_CMP,205,this.ADDR_ABS,3,4),this.setOp(this.INS_CMP,221,this.ADDR_ABSX,3,4),this.setOp(this.INS_CMP,217,this.ADDR_ABSY,3,4),this.setOp(this.INS_CMP,193,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_CMP,209,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_CPX,224,this.ADDR_IMM,2,2),this.setOp(this.INS_CPX,228,this.ADDR_ZP,2,3),this.setOp(this.INS_CPX,236,this.ADDR_ABS,3,4),this.setOp(this.INS_CPY,192,this.ADDR_IMM,2,2),this.setOp(this.INS_CPY,196,this.ADDR_ZP,2,3),this.setOp(this.INS_CPY,204,this.ADDR_ABS,3,4),this.setOp(this.INS_DEC,198,this.ADDR_ZP,2,5),this.setOp(this.INS_DEC,214,this.ADDR_ZPX,2,6),this.setOp(this.INS_DEC,206,this.ADDR_ABS,3,6),this.setOp(this.INS_DEC,222,this.ADDR_ABSX,3,7),this.setOp(this.INS_DEX,202,this.ADDR_IMP,1,2),this.setOp(this.INS_DEY,136,this.ADDR_IMP,1,2),this.setOp(this.INS_EOR,73,this.ADDR_IMM,2,2),this.setOp(this.INS_EOR,69,this.ADDR_ZP,2,3),this.setOp(this.INS_EOR,85,this.ADDR_ZPX,2,4),this.setOp(this.INS_EOR,77,this.ADDR_ABS,3,4),this.setOp(this.INS_EOR,93,this.ADDR_ABSX,3,4),this.setOp(this.INS_EOR,89,this.ADDR_ABSY,3,4),this.setOp(this.INS_EOR,65,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_EOR,81,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_INC,230,this.ADDR_ZP,2,5),this.setOp(this.INS_INC,246,this.ADDR_ZPX,2,6),this.setOp(this.INS_INC,238,this.ADDR_ABS,3,6),this.setOp(this.INS_INC,254,this.ADDR_ABSX,3,7),this.setOp(this.INS_INX,232,this.ADDR_IMP,1,2),this.setOp(this.INS_INY,200,this.ADDR_IMP,1,2),this.setOp(this.INS_JMP,76,this.ADDR_ABS,3,3),this.setOp(this.INS_JMP,108,this.ADDR_INDABS,3,5),this.setOp(this.INS_JSR,32,this.ADDR_ABS,3,6),this.setOp(this.INS_LDA,169,this.ADDR_IMM,2,2),this.setOp(this.INS_LDA,165,this.ADDR_ZP,2,3),this.setOp(this.INS_LDA,181,this.ADDR_ZPX,2,4),this.setOp(this.INS_LDA,173,this.ADDR_ABS,3,4),this.setOp(this.INS_LDA,189,this.ADDR_ABSX,3,4),this.setOp(this.INS_LDA,185,this.ADDR_ABSY,3,4),this.setOp(this.INS_LDA,161,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_LDA,177,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_LDX,162,this.ADDR_IMM,2,2),this.setOp(this.INS_LDX,166,this.ADDR_ZP,2,3),this.setOp(this.INS_LDX,182,this.ADDR_ZPY,2,4),this.setOp(this.INS_LDX,174,this.ADDR_ABS,3,4),this.setOp(this.INS_LDX,190,this.ADDR_ABSY,3,4),this.setOp(this.INS_LDY,160,this.ADDR_IMM,2,2),this.setOp(this.INS_LDY,164,this.ADDR_ZP,2,3),this.setOp(this.INS_LDY,180,this.ADDR_ZPX,2,4),this.setOp(this.INS_LDY,172,this.ADDR_ABS,3,4),this.setOp(this.INS_LDY,188,this.ADDR_ABSX,3,4),this.setOp(this.INS_LSR,74,this.ADDR_ACC,1,2),this.setOp(this.INS_LSR,70,this.ADDR_ZP,2,5),this.setOp(this.INS_LSR,86,this.ADDR_ZPX,2,6),this.setOp(this.INS_LSR,78,this.ADDR_ABS,3,6),this.setOp(this.INS_LSR,94,this.ADDR_ABSX,3,7),this.setOp(this.INS_NOP,26,this.ADDR_IMP,1,2),this.setOp(this.INS_NOP,58,this.ADDR_IMP,1,2),this.setOp(this.INS_NOP,90,this.ADDR_IMP,1,2),this.setOp(this.INS_NOP,122,this.ADDR_IMP,1,2),this.setOp(this.INS_NOP,218,this.ADDR_IMP,1,2),this.setOp(this.INS_NOP,234,this.ADDR_IMP,1,2),this.setOp(this.INS_NOP,250,this.ADDR_IMP,1,2),this.setOp(this.INS_ORA,9,this.ADDR_IMM,2,2),this.setOp(this.INS_ORA,5,this.ADDR_ZP,2,3),this.setOp(this.INS_ORA,21,this.ADDR_ZPX,2,4),this.setOp(this.INS_ORA,13,this.ADDR_ABS,3,4),this.setOp(this.INS_ORA,29,this.ADDR_ABSX,3,4),this.setOp(this.INS_ORA,25,this.ADDR_ABSY,3,4),this.setOp(this.INS_ORA,1,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_ORA,17,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_PHA,72,this.ADDR_IMP,1,3),this.setOp(this.INS_PHP,8,this.ADDR_IMP,1,3),this.setOp(this.INS_PLA,104,this.ADDR_IMP,1,4),this.setOp(this.INS_PLP,40,this.ADDR_IMP,1,4),this.setOp(this.INS_ROL,42,this.ADDR_ACC,1,2),this.setOp(this.INS_ROL,38,this.ADDR_ZP,2,5),this.setOp(this.INS_ROL,54,this.ADDR_ZPX,2,6),this.setOp(this.INS_ROL,46,this.ADDR_ABS,3,6),this.setOp(this.INS_ROL,62,this.ADDR_ABSX,3,7),this.setOp(this.INS_ROR,106,this.ADDR_ACC,1,2),this.setOp(this.INS_ROR,102,this.ADDR_ZP,2,5),this.setOp(this.INS_ROR,118,this.ADDR_ZPX,2,6),this.setOp(this.INS_ROR,110,this.ADDR_ABS,3,6),this.setOp(this.INS_ROR,126,this.ADDR_ABSX,3,7),this.setOp(this.INS_RTI,64,this.ADDR_IMP,1,6),this.setOp(this.INS_RTS,96,this.ADDR_IMP,1,6),this.setOp(this.INS_SBC,233,this.ADDR_IMM,2,2),this.setOp(this.INS_SBC,229,this.ADDR_ZP,2,3),this.setOp(this.INS_SBC,245,this.ADDR_ZPX,2,4),this.setOp(this.INS_SBC,237,this.ADDR_ABS,3,4),this.setOp(this.INS_SBC,253,this.ADDR_ABSX,3,4),this.setOp(this.INS_SBC,249,this.ADDR_ABSY,3,4),this.setOp(this.INS_SBC,225,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_SBC,241,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_SEC,56,this.ADDR_IMP,1,2),this.setOp(this.INS_SED,248,this.ADDR_IMP,1,2),this.setOp(this.INS_SEI,120,this.ADDR_IMP,1,2),this.setOp(this.INS_STA,133,this.ADDR_ZP,2,3),this.setOp(this.INS_STA,149,this.ADDR_ZPX,2,4),this.setOp(this.INS_STA,141,this.ADDR_ABS,3,4),this.setOp(this.INS_STA,157,this.ADDR_ABSX,3,5),this.setOp(this.INS_STA,153,this.ADDR_ABSY,3,5),this.setOp(this.INS_STA,129,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_STA,145,this.ADDR_POSTIDXIND,2,6),this.setOp(this.INS_STX,134,this.ADDR_ZP,2,3),this.setOp(this.INS_STX,150,this.ADDR_ZPY,2,4),this.setOp(this.INS_STX,142,this.ADDR_ABS,3,4),this.setOp(this.INS_STY,132,this.ADDR_ZP,2,3),this.setOp(this.INS_STY,148,this.ADDR_ZPX,2,4),this.setOp(this.INS_STY,140,this.ADDR_ABS,3,4),this.setOp(this.INS_TAX,170,this.ADDR_IMP,1,2),this.setOp(this.INS_TAY,168,this.ADDR_IMP,1,2),this.setOp(this.INS_TSX,186,this.ADDR_IMP,1,2),this.setOp(this.INS_TXA,138,this.ADDR_IMP,1,2),this.setOp(this.INS_TXS,154,this.ADDR_IMP,1,2),this.setOp(this.INS_TYA,152,this.ADDR_IMP,1,2),this.setOp(this.INS_ALR,75,this.ADDR_IMM,2,2),this.setOp(this.INS_ANC,11,this.ADDR_IMM,2,2),this.setOp(this.INS_ANC,43,this.ADDR_IMM,2,2),this.setOp(this.INS_ARR,107,this.ADDR_IMM,2,2),this.setOp(this.INS_AXS,203,this.ADDR_IMM,2,2),this.setOp(this.INS_LAX,163,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_LAX,167,this.ADDR_ZP,2,3),this.setOp(this.INS_LAX,175,this.ADDR_ABS,3,4),this.setOp(this.INS_LAX,179,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_LAX,183,this.ADDR_ZPY,2,4),this.setOp(this.INS_LAX,191,this.ADDR_ABSY,3,4),this.setOp(this.INS_SAX,131,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_SAX,135,this.ADDR_ZP,2,3),this.setOp(this.INS_SAX,143,this.ADDR_ABS,3,4),this.setOp(this.INS_SAX,151,this.ADDR_ZPY,2,4),this.setOp(this.INS_DCP,195,this.ADDR_PREIDXIND,2,8),this.setOp(this.INS_DCP,199,this.ADDR_ZP,2,5),this.setOp(this.INS_DCP,207,this.ADDR_ABS,3,6),this.setOp(this.INS_DCP,211,this.ADDR_POSTIDXIND,2,8),this.setOp(this.INS_DCP,215,this.ADDR_ZPX,2,6),this.setOp(this.INS_DCP,219,this.ADDR_ABSY,3,7),this.setOp(this.INS_DCP,223,this.ADDR_ABSX,3,7),this.setOp(this.INS_ISC,227,this.ADDR_PREIDXIND,2,8),this.setOp(this.INS_ISC,231,this.ADDR_ZP,2,5),this.setOp(this.INS_ISC,239,this.ADDR_ABS,3,6),this.setOp(this.INS_ISC,243,this.ADDR_POSTIDXIND,2,8),this.setOp(this.INS_ISC,247,this.ADDR_ZPX,2,6),this.setOp(this.INS_ISC,251,this.ADDR_ABSY,3,7),this.setOp(this.INS_ISC,255,this.ADDR_ABSX,3,7),this.setOp(this.INS_RLA,35,this.ADDR_PREIDXIND,2,8),this.setOp(this.INS_RLA,39,this.ADDR_ZP,2,5),this.setOp(this.INS_RLA,47,this.ADDR_ABS,3,6),this.setOp(this.INS_RLA,51,this.ADDR_POSTIDXIND,2,8),this.setOp(this.INS_RLA,55,this.ADDR_ZPX,2,6),this.setOp(this.INS_RLA,59,this.ADDR_ABSY,3,7),this.setOp(this.INS_RLA,63,this.ADDR_ABSX,3,7),this.setOp(this.INS_RRA,99,this.ADDR_PREIDXIND,2,8),this.setOp(this.INS_RRA,103,this.ADDR_ZP,2,5),this.setOp(this.INS_RRA,111,this.ADDR_ABS,3,6),this.setOp(this.INS_RRA,115,this.ADDR_POSTIDXIND,2,8),this.setOp(this.INS_RRA,119,this.ADDR_ZPX,2,6),this.setOp(this.INS_RRA,123,this.ADDR_ABSY,3,7),this.setOp(this.INS_RRA,127,this.ADDR_ABSX,3,7),this.setOp(this.INS_SLO,3,this.ADDR_PREIDXIND,2,8),this.setOp(this.INS_SLO,7,this.ADDR_ZP,2,5),this.setOp(this.INS_SLO,15,this.ADDR_ABS,3,6),this.setOp(this.INS_SLO,19,this.ADDR_POSTIDXIND,2,8),this.setOp(this.INS_SLO,23,this.ADDR_ZPX,2,6),this.setOp(this.INS_SLO,27,this.ADDR_ABSY,3,7),this.setOp(this.INS_SLO,31,this.ADDR_ABSX,3,7),this.setOp(this.INS_SRE,67,this.ADDR_PREIDXIND,2,8),this.setOp(this.INS_SRE,71,this.ADDR_ZP,2,5),this.setOp(this.INS_SRE,79,this.ADDR_ABS,3,6),this.setOp(this.INS_SRE,83,this.ADDR_POSTIDXIND,2,8),this.setOp(this.INS_SRE,87,this.ADDR_ZPX,2,6),this.setOp(this.INS_SRE,91,this.ADDR_ABSY,3,7),this.setOp(this.INS_SRE,95,this.ADDR_ABSX,3,7),this.setOp(this.INS_SKB,128,this.ADDR_IMM,2,2),this.setOp(this.INS_SKB,130,this.ADDR_IMM,2,2),this.setOp(this.INS_SKB,137,this.ADDR_IMM,2,2),this.setOp(this.INS_SKB,194,this.ADDR_IMM,2,2),this.setOp(this.INS_SKB,226,this.ADDR_IMM,2,2),this.setOp(this.INS_IGN,12,this.ADDR_ABS,3,4),this.setOp(this.INS_IGN,28,this.ADDR_ABSX,3,4),this.setOp(this.INS_IGN,60,this.ADDR_ABSX,3,4),this.setOp(this.INS_IGN,92,this.ADDR_ABSX,3,4),this.setOp(this.INS_IGN,124,this.ADDR_ABSX,3,4),this.setOp(this.INS_IGN,220,this.ADDR_ABSX,3,4),this.setOp(this.INS_IGN,252,this.ADDR_ABSX,3,4),this.setOp(this.INS_IGN,4,this.ADDR_ZP,2,3),this.setOp(this.INS_IGN,68,this.ADDR_ZP,2,3),this.setOp(this.INS_IGN,100,this.ADDR_ZP,2,3),this.setOp(this.INS_IGN,20,this.ADDR_ZPX,2,4),this.setOp(this.INS_IGN,52,this.ADDR_ZPX,2,4),this.setOp(this.INS_IGN,84,this.ADDR_ZPX,2,4),this.setOp(this.INS_IGN,116,this.ADDR_ZPX,2,4),this.setOp(this.INS_IGN,212,this.ADDR_ZPX,2,4),this.setOp(this.INS_IGN,244,this.ADDR_ZPX,2,4),this.cycTable=new Array(7,6,2,8,3,3,5,5,3,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,4,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,3,2,2,2,3,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,4,2,2,2,5,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,2,6,2,6,3,3,3,3,2,2,2,2,4,4,4,4,2,6,2,6,4,4,4,4,2,5,2,5,5,5,5,5,2,6,2,6,3,3,3,3,2,2,2,2,4,4,4,4,2,5,2,5,4,4,4,4,2,4,2,4,4,4,4,4,2,6,2,8,3,3,5,5,2,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,2,6,3,8,3,3,5,5,2,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7),this.instname=new Array(70),this.instname[0]="ADC",this.instname[1]="AND",this.instname[2]="ASL",this.instname[3]="BCC",this.instname[4]="BCS",this.instname[5]="BEQ",this.instname[6]="BIT",this.instname[7]="BMI",this.instname[8]="BNE",this.instname[9]="BPL",this.instname[10]="BRK",this.instname[11]="BVC",this.instname[12]="BVS",this.instname[13]="CLC",this.instname[14]="CLD",this.instname[15]="CLI",this.instname[16]="CLV",this.instname[17]="CMP",this.instname[18]="CPX",this.instname[19]="CPY",this.instname[20]="DEC",this.instname[21]="DEX",this.instname[22]="DEY",this.instname[23]="EOR",this.instname[24]="INC",this.instname[25]="INX",this.instname[26]="INY",this.instname[27]="JMP",this.instname[28]="JSR",this.instname[29]="LDA",this.instname[30]="LDX",this.instname[31]="LDY",this.instname[32]="LSR",this.instname[33]="NOP",this.instname[34]="ORA",this.instname[35]="PHA",this.instname[36]="PHP",this.instname[37]="PLA",this.instname[38]="PLP",this.instname[39]="ROL",this.instname[40]="ROR",this.instname[41]="RTI",this.instname[42]="RTS",this.instname[43]="SBC",this.instname[44]="SEC",this.instname[45]="SED",this.instname[46]="SEI",this.instname[47]="STA",this.instname[48]="STX",this.instname[49]="STY",this.instname[50]="TAX",this.instname[51]="TAY",this.instname[52]="TSX",this.instname[53]="TXA",this.instname[54]="TXS",this.instname[55]="TYA",this.instname[56]="ALR",this.instname[57]="ANC",this.instname[58]="ARR",this.instname[59]="AXS",this.instname[60]="LAX",this.instname[61]="SAX",this.instname[62]="DCP",this.instname[63]="ISC",this.instname[64]="RLA",this.instname[65]="RRA",this.instname[66]="SLO",this.instname[67]="SRE",this.instname[68]="SKB",this.instname[69]="IGN",this.addrDesc=new Array("Zero Page           ","Relative            ","Implied             ","Absolute            ","Accumulator         ","Immediate           ","Zero Page,X         ","Zero Page,Y         ","Absolute,X          ","Absolute,Y          ","Preindexed Indirect ","Postindexed Indirect","Indirect Absolute   ")};u.prototype={INS_ADC:0,INS_AND:1,INS_ASL:2,INS_BCC:3,INS_BCS:4,INS_BEQ:5,INS_BIT:6,INS_BMI:7,INS_BNE:8,INS_BPL:9,INS_BRK:10,INS_BVC:11,INS_BVS:12,INS_CLC:13,INS_CLD:14,INS_CLI:15,INS_CLV:16,INS_CMP:17,INS_CPX:18,INS_CPY:19,INS_DEC:20,INS_DEX:21,INS_DEY:22,INS_EOR:23,INS_INC:24,INS_INX:25,INS_INY:26,INS_JMP:27,INS_JSR:28,INS_LDA:29,INS_LDX:30,INS_LDY:31,INS_LSR:32,INS_NOP:33,INS_ORA:34,INS_PHA:35,INS_PHP:36,INS_PLA:37,INS_PLP:38,INS_ROL:39,INS_ROR:40,INS_RTI:41,INS_RTS:42,INS_SBC:43,INS_SEC:44,INS_SED:45,INS_SEI:46,INS_STA:47,INS_STX:48,INS_STY:49,INS_TAX:50,INS_TAY:51,INS_TSX:52,INS_TXA:53,INS_TXS:54,INS_TYA:55,INS_ALR:56,INS_ANC:57,INS_ARR:58,INS_AXS:59,INS_LAX:60,INS_SAX:61,INS_DCP:62,INS_ISC:63,INS_RLA:64,INS_RRA:65,INS_SLO:66,INS_SRE:67,INS_SKB:68,INS_IGN:69,INS_DUMMY:70,ADDR_ZP:0,ADDR_REL:1,ADDR_IMP:2,ADDR_ABS:3,ADDR_ACC:4,ADDR_IMM:5,ADDR_ZPX:6,ADDR_ZPY:7,ADDR_ABSX:8,ADDR_ABSY:9,ADDR_PREIDXIND:10,ADDR_POSTIDXIND:11,ADDR_INDABS:12,setOp:function(t,e,i,s,r){this.opdata[e]=255&t|(255&i)<<8|(255&s)<<16|(255&r)<<24}};i("b0c0");var c=function(){this.pix=new Array(64),this.fbIndex=null,this.tIndex=null,this.x=null,this.y=null,this.w=null,this.h=null,this.incX=null,this.incY=null,this.palIndex=null,this.tpri=null,this.c=null,this.initialized=!1,this.opaque=new Array(8)};c.prototype={setBuffer:function(t){for(this.y=0;this.y<8;this.y++)this.setScanline(this.y,t[this.y],t[this.y+8])},setScanline:function(t,e,i){for(this.initialized=!0,this.tIndex=t<<3,this.x=0;this.x<8;this.x++)this.pix[this.tIndex+this.x]=(e>>7-this.x&1)+((i>>7-this.x&1)<<1),0===this.pix[this.tIndex+this.x]&&(this.opaque[t]=!1)},render:function(t,e,i,s,r,a,n,h,o,l,u,c,p){if(!(a<-7||a>=256||n<-7||n>=240))if(this.w=s-e,this.h=r-i,a<0&&(e-=a),a+s>=256&&(s=256-a),n<0&&(i-=n),n+r>=240&&(r=240-n),l||u)if(l&&!u)for(this.fbIndex=(n<<8)+a,this.tIndex=7,this.y=0;this.y<8;this.y++){for(this.x=0;this.x<8;this.x++)this.x>=e&&this.x<s&&this.y>=i&&this.y<r&&(this.palIndex=this.pix[this.tIndex],this.tpri=p[this.fbIndex],0!==this.palIndex&&c<=(255&this.tpri)&&(t[this.fbIndex]=o[this.palIndex+h],this.tpri=3840&this.tpri|c,p[this.fbIndex]=this.tpri)),this.fbIndex++,this.tIndex--;this.fbIndex-=8,this.fbIndex+=256,this.tIndex+=16}else if(u&&!l)for(this.fbIndex=(n<<8)+a,this.tIndex=56,this.y=0;this.y<8;this.y++){for(this.x=0;this.x<8;this.x++)this.x>=e&&this.x<s&&this.y>=i&&this.y<r&&(this.palIndex=this.pix[this.tIndex],this.tpri=p[this.fbIndex],0!==this.palIndex&&c<=(255&this.tpri)&&(t[this.fbIndex]=o[this.palIndex+h],this.tpri=3840&this.tpri|c,p[this.fbIndex]=this.tpri)),this.fbIndex++,this.tIndex++;this.fbIndex-=8,this.fbIndex+=256,this.tIndex-=16}else for(this.fbIndex=(n<<8)+a,this.tIndex=63,this.y=0;this.y<8;this.y++){for(this.x=0;this.x<8;this.x++)this.x>=e&&this.x<s&&this.y>=i&&this.y<r&&(this.palIndex=this.pix[this.tIndex],this.tpri=p[this.fbIndex],0!==this.palIndex&&c<=(255&this.tpri)&&(t[this.fbIndex]=o[this.palIndex+h],this.tpri=3840&this.tpri|c,p[this.fbIndex]=this.tpri)),this.fbIndex++,this.tIndex--;this.fbIndex-=8,this.fbIndex+=256}else for(this.fbIndex=(n<<8)+a,this.tIndex=0,this.y=0;this.y<8;this.y++){for(this.x=0;this.x<8;this.x++)this.x>=e&&this.x<s&&this.y>=i&&this.y<r&&(this.palIndex=this.pix[this.tIndex],this.tpri=p[this.fbIndex],0!==this.palIndex&&c<=(255&this.tpri)&&(t[this.fbIndex]=o[this.palIndex+h],this.tpri=3840&this.tpri|c,p[this.fbIndex]=this.tpri)),this.fbIndex++,this.tIndex++;this.fbIndex-=8,this.fbIndex+=256}},isTransparent:function(t,e){return 0===this.pix[(e<<3)+t]},toJSON:function(){return{opaque:this.opaque,pix:this.pix}},fromJSON:function(t){this.opaque=t.opaque,this.pix=t.pix}};var p=function(t){this.nes=t,this.vramMem=null,this.spriteMem=null,this.vramAddress=null,this.vramTmpAddress=null,this.vramBufferedReadValue=null,this.firstWrite=null,this.sramAddress=null,this.currentMirroring=null,this.requestEndFrame=null,this.nmiOk=null,this.dummyCycleToggle=null,this.validTileData=null,this.nmiCounter=null,this.scanlineAlreadyRendered=null,this.f_nmiOnVblank=null,this.f_spriteSize=null,this.f_bgPatternTable=null,this.f_spPatternTable=null,this.f_addrInc=null,this.f_nTblAddress=null,this.f_color=null,this.f_spVisibility=null,this.f_bgVisibility=null,this.f_spClipping=null,this.f_bgClipping=null,this.f_dispType=null,this.cntFV=null,this.cntV=null,this.cntH=null,this.cntVT=null,this.cntHT=null,this.regFV=null,this.regV=null,this.regH=null,this.regVT=null,this.regHT=null,this.regFH=null,this.regS=null,this.curNt=null,this.attrib=null,this.buffer=null,this.bgbuffer=null,this.pixrendered=null,this.validTileData=null,this.scantile=null,this.scanline=null,this.lastRenderedScanline=null,this.curX=null,this.sprX=null,this.sprY=null,this.sprTile=null,this.sprCol=null,this.vertFlip=null,this.horiFlip=null,this.bgPriority=null,this.spr0HitX=null,this.spr0HitY=null,this.hitSpr0=null,this.sprPalette=null,this.imgPalette=null,this.ptTile=null,this.ntable1=null,this.currentMirroring=null,this.nameTable=null,this.vramMirrorTable=null,this.palTable=null,this.showSpr0Hit=!1,this.clipToTvSize=!0,this.reset()};p.prototype={STATUS_VRAMWRITE:4,STATUS_SLSPRITECOUNT:5,STATUS_SPRITE0HIT:6,STATUS_VBLANK:7,reset:function(){var t;for(this.vramMem=new Array(32768),this.spriteMem=new Array(256),t=0;t<this.vramMem.length;t++)this.vramMem[t]=0;for(t=0;t<this.spriteMem.length;t++)this.spriteMem[t]=0;for(this.vramAddress=null,this.vramTmpAddress=null,this.vramBufferedReadValue=0,this.firstWrite=!0,this.sramAddress=0,this.currentMirroring=-1,this.requestEndFrame=!1,this.nmiOk=!1,this.dummyCycleToggle=!1,this.validTileData=!1,this.nmiCounter=0,this.scanlineAlreadyRendered=null,this.f_nmiOnVblank=0,this.f_spriteSize=0,this.f_bgPatternTable=0,this.f_spPatternTable=0,this.f_addrInc=0,this.f_nTblAddress=0,this.f_color=0,this.f_spVisibility=0,this.f_bgVisibility=0,this.f_spClipping=0,this.f_bgClipping=0,this.f_dispType=0,this.cntFV=0,this.cntV=0,this.cntH=0,this.cntVT=0,this.cntHT=0,this.regFV=0,this.regV=0,this.regH=0,this.regVT=0,this.regHT=0,this.regFH=0,this.regS=0,this.curNt=null,this.attrib=new Array(32),this.buffer=new Array(61440),this.bgbuffer=new Array(61440),this.pixrendered=new Array(61440),this.validTileData=null,this.scantile=new Array(32),this.scanline=0,this.lastRenderedScanline=-1,this.curX=0,this.sprX=new Array(64),this.sprY=new Array(64),this.sprTile=new Array(64),this.sprCol=new Array(64),this.vertFlip=new Array(64),this.horiFlip=new Array(64),this.bgPriority=new Array(64),this.spr0HitX=0,this.spr0HitY=0,this.hitSpr0=!1,this.sprPalette=new Array(16),this.imgPalette=new Array(16),this.ptTile=new Array(512),t=0;t<512;t++)this.ptTile[t]=new c;for(this.ntable1=new Array(4),this.currentMirroring=-1,this.nameTable=new Array(4),t=0;t<4;t++)this.nameTable[t]=new d(32,32,"Nt"+t);for(this.vramMirrorTable=new Array(32768),t=0;t<32768;t++)this.vramMirrorTable[t]=t;this.palTable=new m,this.palTable.loadNTSCPalette(),this.updateControlReg1(0),this.updateControlReg2(0)},setMirroring:function(t){if(t!==this.currentMirroring){this.currentMirroring=t,this.triggerRendering(),null===this.vramMirrorTable&&(this.vramMirrorTable=new Array(32768));for(var e=0;e<32768;e++)this.vramMirrorTable[e]=e;this.defineMirrorRegion(16160,16128,32),this.defineMirrorRegion(16192,16128,32),this.defineMirrorRegion(16256,16128,32),this.defineMirrorRegion(16320,16128,32),this.defineMirrorRegion(12288,8192,3840),this.defineMirrorRegion(16384,0,16384),t===this.nes.rom.HORIZONTAL_MIRRORING?(this.ntable1[0]=0,this.ntable1[1]=0,this.ntable1[2]=1,this.ntable1[3]=1,this.defineMirrorRegion(9216,8192,1024),this.defineMirrorRegion(11264,10240,1024)):t===this.nes.rom.VERTICAL_MIRRORING?(this.ntable1[0]=0,this.ntable1[1]=1,this.ntable1[2]=0,this.ntable1[3]=1,this.defineMirrorRegion(10240,8192,1024),this.defineMirrorRegion(11264,9216,1024)):t===this.nes.rom.SINGLESCREEN_MIRRORING?(this.ntable1[0]=0,this.ntable1[1]=0,this.ntable1[2]=0,this.ntable1[3]=0,this.defineMirrorRegion(9216,8192,1024),this.defineMirrorRegion(10240,8192,1024),this.defineMirrorRegion(11264,8192,1024)):t===this.nes.rom.SINGLESCREEN_MIRRORING2?(this.ntable1[0]=1,this.ntable1[1]=1,this.ntable1[2]=1,this.ntable1[3]=1,this.defineMirrorRegion(9216,9216,1024),this.defineMirrorRegion(10240,9216,1024),this.defineMirrorRegion(11264,9216,1024)):(this.ntable1[0]=0,this.ntable1[1]=1,this.ntable1[2]=2,this.ntable1[3]=3)}},defineMirrorRegion:function(t,e,i){for(var s=0;s<i;s++)this.vramMirrorTable[t+s]=e+s},startVBlank:function(){this.nes.cpu.requestIrq(this.nes.cpu.IRQ_NMI),this.lastRenderedScanline<239&&this.renderFramePartially(this.lastRenderedScanline+1,240-this.lastRenderedScanline),this.endFrame(),this.lastRenderedScanline=-1},endScanline:function(){switch(this.scanline){case 19:this.dummyCycleToggle&&(this.curX=1,this.dummyCycleToggle=!this.dummyCycleToggle);break;case 20:this.setStatusFlag(this.STATUS_VBLANK,!1),this.setStatusFlag(this.STATUS_SPRITE0HIT,!1),this.hitSpr0=!1,this.spr0HitX=-1,this.spr0HitY=-1,1!==this.f_bgVisibility&&1!==this.f_spVisibility||(this.cntFV=this.regFV,this.cntV=this.regV,this.cntH=this.regH,this.cntVT=this.regVT,this.cntHT=this.regHT,1===this.f_bgVisibility&&this.renderBgScanline(!1,0)),1===this.f_bgVisibility&&1===this.f_spVisibility&&this.checkSprite0(0),1!==this.f_bgVisibility&&1!==this.f_spVisibility||this.nes.mmap.clockIrqCounter();break;case 261:this.setStatusFlag(this.STATUS_VBLANK,!0),this.requestEndFrame=!0,this.nmiCounter=9,this.scanline=-1;break;default:this.scanline>=21&&this.scanline<=260&&(1===this.f_bgVisibility&&(this.scanlineAlreadyRendered||(this.cntHT=this.regHT,this.cntH=this.regH,this.renderBgScanline(!0,this.scanline+1-21)),this.scanlineAlreadyRendered=!1,this.hitSpr0||1!==this.f_spVisibility||this.sprX[0]>=-7&&this.sprX[0]<256&&this.sprY[0]+1<=this.scanline-20&&this.sprY[0]+1+(0===this.f_spriteSize?8:16)>=this.scanline-20&&this.checkSprite0(this.scanline-20)&&(this.hitSpr0=!0)),1!==this.f_bgVisibility&&1!==this.f_spVisibility||this.nes.mmap.clockIrqCounter())}this.scanline++,this.regsToAddress(),this.cntsToAddress()},startFrame:function(){var t=0;if(0===this.f_dispType)t=this.imgPalette[0];else switch(this.f_color){case 0:t=0;break;case 1:t=65280;break;case 2:t=16711680;break;case 3:t=0;break;case 4:t=255;break;default:t=0}var e,i=this.buffer;for(e=0;e<61440;e++)i[e]=t;var s=this.pixrendered;for(e=0;e<s.length;e++)s[e]=65},endFrame:function(){var t,e,i,s=this.buffer;if(this.showSpr0Hit){if(this.sprX[0]>=0&&this.sprX[0]<256&&this.sprY[0]>=0&&this.sprY[0]<240){for(t=0;t<256;t++)s[(this.sprY[0]<<8)+t]=16733525;for(t=0;t<240;t++)s[(t<<8)+this.sprX[0]]=16733525}if(this.spr0HitX>=0&&this.spr0HitX<256&&this.spr0HitY>=0&&this.spr0HitY<240){for(t=0;t<256;t++)s[(this.spr0HitY<<8)+t]=5635925;for(t=0;t<240;t++)s[(t<<8)+this.spr0HitX]=5635925}}if(this.clipToTvSize||0===this.f_bgClipping||0===this.f_spClipping)for(i=0;i<240;i++)for(e=0;e<8;e++)s[(i<<8)+e]=0;if(this.clipToTvSize)for(i=0;i<240;i++)for(e=0;e<8;e++)s[255+(i<<8)-e]=0;if(this.clipToTvSize)for(i=0;i<8;i++)for(e=0;e<256;e++)s[(i<<8)+e]=0,s[(239-i<<8)+e]=0;this.nes.ui.writeFrame(s)},updateControlReg1:function(t){this.triggerRendering(),this.f_nmiOnVblank=t>>7&1,this.f_spriteSize=t>>5&1,this.f_bgPatternTable=t>>4&1,this.f_spPatternTable=t>>3&1,this.f_addrInc=t>>2&1,this.f_nTblAddress=3&t,this.regV=t>>1&1,this.regH=1&t,this.regS=t>>4&1},updateControlReg2:function(t){this.triggerRendering(),this.f_color=t>>5&7,this.f_spVisibility=t>>4&1,this.f_bgVisibility=t>>3&1,this.f_spClipping=t>>2&1,this.f_bgClipping=t>>1&1,this.f_dispType=1&t,0===this.f_dispType&&this.palTable.setEmphasis(this.f_color),this.updatePalettes()},setStatusFlag:function(t,e){var i=1<<t;this.nes.cpu.mem[8194]=this.nes.cpu.mem[8194]&255-i|(e?i:0)},readStatusRegister:function(){var t=this.nes.cpu.mem[8194];return this.firstWrite=!0,this.setStatusFlag(this.STATUS_VBLANK,!1),t},writeSRAMAddress:function(t){this.sramAddress=t},sramLoad:function(){return this.spriteMem[this.sramAddress]},sramWrite:function(t){this.spriteMem[this.sramAddress]=t,this.spriteRamWriteUpdate(this.sramAddress,t),this.sramAddress++,this.sramAddress%=256},scrollWrite:function(t){this.triggerRendering(),this.firstWrite?(this.regHT=t>>3&31,this.regFH=7&t):(this.regFV=7&t,this.regVT=t>>3&31),this.firstWrite=!this.firstWrite},writeVRAMAddress:function(t){this.firstWrite?(this.regFV=t>>4&3,this.regV=t>>3&1,this.regH=t>>2&1,this.regVT=7&this.regVT|(3&t)<<3):(this.triggerRendering(),this.regVT=24&this.regVT|t>>5&7,this.regHT=31&t,this.cntFV=this.regFV,this.cntV=this.regV,this.cntH=this.regH,this.cntVT=this.regVT,this.cntHT=this.regHT,this.checkSprite0(this.scanline-20)),this.firstWrite=!this.firstWrite,this.cntsToAddress(),this.vramAddress<8192&&this.nes.mmap.latchAccess(this.vramAddress)},vramLoad:function(){var t;return this.cntsToAddress(),this.regsToAddress(),this.vramAddress<=16127?(t=this.vramBufferedReadValue,this.vramAddress<8192?this.vramBufferedReadValue=this.vramMem[this.vramAddress]:this.vramBufferedReadValue=this.mirroredLoad(this.vramAddress),this.vramAddress<8192&&this.nes.mmap.latchAccess(this.vramAddress),this.vramAddress+=1===this.f_addrInc?32:1,this.cntsFromAddress(),this.regsFromAddress(),t):(t=this.mirroredLoad(this.vramAddress),this.vramAddress+=1===this.f_addrInc?32:1,this.cntsFromAddress(),this.regsFromAddress(),t)},vramWrite:function(t){this.triggerRendering(),this.cntsToAddress(),this.regsToAddress(),this.vramAddress>=8192?this.mirroredWrite(this.vramAddress,t):(this.writeMem(this.vramAddress,t),this.nes.mmap.latchAccess(this.vramAddress)),this.vramAddress+=1===this.f_addrInc?32:1,this.regsFromAddress(),this.cntsFromAddress()},sramDMA:function(t){for(var e,i=256*t,s=this.sramAddress;s<256;s++)e=this.nes.cpu.mem[i+s],this.spriteMem[s]=e,this.spriteRamWriteUpdate(s,e);this.nes.cpu.haltCycles(513)},regsFromAddress:function(){var t=this.vramTmpAddress>>8&255;this.regFV=t>>4&7,this.regV=t>>3&1,this.regH=t>>2&1,this.regVT=7&this.regVT|(3&t)<<3,t=255&this.vramTmpAddress,this.regVT=24&this.regVT|t>>5&7,this.regHT=31&t},cntsFromAddress:function(){var t=this.vramAddress>>8&255;this.cntFV=t>>4&3,this.cntV=t>>3&1,this.cntH=t>>2&1,this.cntVT=7&this.cntVT|(3&t)<<3,t=255&this.vramAddress,this.cntVT=24&this.cntVT|t>>5&7,this.cntHT=31&t},regsToAddress:function(){var t=(7&this.regFV)<<4;t|=(1&this.regV)<<3,t|=(1&this.regH)<<2,t|=this.regVT>>3&3;var e=(7&this.regVT)<<5;e|=31&this.regHT,this.vramTmpAddress=32767&(t<<8|e)},cntsToAddress:function(){var t=(7&this.cntFV)<<4;t|=(1&this.cntV)<<3,t|=(1&this.cntH)<<2,t|=this.cntVT>>3&3;var e=(7&this.cntVT)<<5;e|=31&this.cntHT,this.vramAddress=32767&(t<<8|e)},incTileCounter:function(t){for(var e=t;0!==e;e--)this.cntHT++,32===this.cntHT&&(this.cntHT=0,this.cntVT++,this.cntVT>=30&&(this.cntH++,2===this.cntH&&(this.cntH=0,this.cntV++,2===this.cntV&&(this.cntV=0,this.cntFV++,this.cntFV&=7))))},mirroredLoad:function(t){return this.vramMem[this.vramMirrorTable[t]]},mirroredWrite:function(t,e){if(t>=16128&&t<16160)16128===t||16144===t?(this.writeMem(16128,e),this.writeMem(16144,e)):16132===t||16148===t?(this.writeMem(16132,e),this.writeMem(16148,e)):16136===t||16152===t?(this.writeMem(16136,e),this.writeMem(16152,e)):16140===t||16156===t?(this.writeMem(16140,e),this.writeMem(16156,e)):this.writeMem(t,e);else{if(!(t<this.vramMirrorTable.length))throw new Error("Invalid VRAM address: "+t.toString(16));this.writeMem(this.vramMirrorTable[t],e)}},triggerRendering:function(){this.scanline>=21&&this.scanline<=260&&(this.renderFramePartially(this.lastRenderedScanline+1,this.scanline-21-this.lastRenderedScanline),this.lastRenderedScanline=this.scanline-21)},renderFramePartially:function(t,e){if(1===this.f_spVisibility&&this.renderSpritesPartially(t,e,!0),1===this.f_bgVisibility){var i=t<<8,s=t+e<<8;s>61440&&(s=61440);for(var r=this.buffer,a=this.bgbuffer,n=this.pixrendered,h=i;h<s;h++)n[h]>255&&(r[h]=a[h])}1===this.f_spVisibility&&this.renderSpritesPartially(t,e,!1),this.validTileData=!1},renderBgScanline:function(t,e){var i=0===this.regS?0:256,s=(e<<8)-this.regFH;if(this.curNt=this.ntable1[this.cntV+this.cntV+this.cntH],this.cntHT=this.regHT,this.cntH=this.regH,this.curNt=this.ntable1[this.cntV+this.cntV+this.cntH],e<240&&e-this.cntFV>=0){for(var r,a,n,h,o=this.cntFV<<3,l=this.scantile,u=this.attrib,c=this.ptTile,p=this.nameTable,d=this.imgPalette,m=this.pixrendered,_=t?this.bgbuffer:this.buffer,f=0;f<32;f++){if(e>=0){if(this.validTileData){if(r=l[f],"undefined"===typeof r)continue;a=r.pix,n=u[f]}else{if(r=c[i+p[this.curNt].getTileIndex(this.cntHT,this.cntVT)],"undefined"===typeof r)continue;a=r.pix,n=p[this.curNt].getAttrib(this.cntHT,this.cntVT),l[f]=r,u[f]=n}var R=0,g=(f<<3)-this.regFH;if(g>-8)if(g<0&&(s-=g,R=-g),r.opaque[this.cntFV])for(;R<8;R++)_[s]=d[a[o+R]+n],m[s]|=256,s++;else for(;R<8;R++)h=a[o+R],0!==h&&(_[s]=d[h+n],m[s]|=256),s++}32===++this.cntHT&&(this.cntHT=0,this.cntH++,this.cntH%=2,this.curNt=this.ntable1[(this.cntV<<1)+this.cntH])}this.validTileData=!0}this.cntFV++,8===this.cntFV&&(this.cntFV=0,this.cntVT++,30===this.cntVT?(this.cntVT=0,this.cntV++,this.cntV%=2,this.curNt=this.ntable1[(this.cntV<<1)+this.cntH]):32===this.cntVT&&(this.cntVT=0),this.validTileData=!1)},renderSpritesPartially:function(t,e,i){if(1===this.f_spVisibility)for(var s=0;s<64;s++)if(this.bgPriority[s]===i&&this.sprX[s]>=0&&this.sprX[s]<256&&this.sprY[s]+8>=t&&this.sprY[s]<t+e)if(0===this.f_spriteSize)this.srcy1=0,this.srcy2=8,this.sprY[s]<t&&(this.srcy1=t-this.sprY[s]-1),this.sprY[s]+8>t+e&&(this.srcy2=t+e-this.sprY[s]+1),0===this.f_spPatternTable?this.ptTile[this.sprTile[s]].render(this.buffer,0,this.srcy1,8,this.srcy2,this.sprX[s],this.sprY[s]+1,this.sprCol[s],this.sprPalette,this.horiFlip[s],this.vertFlip[s],s,this.pixrendered):this.ptTile[this.sprTile[s]+256].render(this.buffer,0,this.srcy1,8,this.srcy2,this.sprX[s],this.sprY[s]+1,this.sprCol[s],this.sprPalette,this.horiFlip[s],this.vertFlip[s],s,this.pixrendered);else{var r=this.sprTile[s];0!==(1&r)&&(r=this.sprTile[s]-1+256);var a=0,n=8;this.sprY[s]<t&&(a=t-this.sprY[s]-1),this.sprY[s]+8>t+e&&(n=t+e-this.sprY[s]),this.ptTile[r+(this.vertFlip[s]?1:0)].render(this.buffer,0,a,8,n,this.sprX[s],this.sprY[s]+1,this.sprCol[s],this.sprPalette,this.horiFlip[s],this.vertFlip[s],s,this.pixrendered),a=0,n=8,this.sprY[s]+8<t&&(a=t-(this.sprY[s]+8+1)),this.sprY[s]+16>t+e&&(n=t+e-(this.sprY[s]+8)),this.ptTile[r+(this.vertFlip[s]?0:1)].render(this.buffer,0,a,8,n,this.sprX[s],this.sprY[s]+1+8,this.sprCol[s],this.sprPalette,this.horiFlip[s],this.vertFlip[s],s,this.pixrendered)}},checkSprite0:function(t){var e;this.spr0HitX=-1,this.spr0HitY=-1;var i,s,r,a,n,h=0===this.f_spPatternTable?0:256;if(i=this.sprX[0],s=this.sprY[0]+1,0===this.f_spriteSize){if(s<=t&&s+8>t&&i>=-7&&i<256)if(r=this.ptTile[this.sprTile[0]+h],e=this.vertFlip[0]?7-(t-s):t-s,e*=8,n=256*t+i,this.horiFlip[0])for(a=7;a>=0;a--){if(i>=0&&i<256&&n>=0&&n<61440&&0!==this.pixrendered[n]&&0!==r.pix[e+a])return this.spr0HitX=n%256,this.spr0HitY=t,!0;i++,n++}else for(a=0;a<8;a++){if(i>=0&&i<256&&n>=0&&n<61440&&0!==this.pixrendered[n]&&0!==r.pix[e+a])return this.spr0HitX=n%256,this.spr0HitY=t,!0;i++,n++}}else if(s<=t&&s+16>t&&i>=-7&&i<256)if(e=this.vertFlip[0]?15-(t-s):t-s,e<8?r=this.ptTile[this.sprTile[0]+(this.vertFlip[0]?1:0)+(0!==(1&this.sprTile[0])?255:0)]:(r=this.ptTile[this.sprTile[0]+(this.vertFlip[0]?0:1)+(0!==(1&this.sprTile[0])?255:0)],this.vertFlip[0]?e=15-e:e-=8),e*=8,n=256*t+i,this.horiFlip[0])for(a=7;a>=0;a--){if(i>=0&&i<256&&n>=0&&n<61440&&0!==this.pixrendered[n]&&0!==r.pix[e+a])return this.spr0HitX=n%256,this.spr0HitY=t,!0;i++,n++}else for(a=0;a<8;a++){if(i>=0&&i<256&&n>=0&&n<61440&&0!==this.pixrendered[n]&&0!==r.pix[e+a])return this.spr0HitX=n%256,this.spr0HitY=t,!0;i++,n++}return!1},writeMem:function(t,e){this.vramMem[t]=e,t<8192?(this.vramMem[t]=e,this.patternWrite(t,e)):t>=8192&&t<9152?this.nameTableWrite(this.ntable1[0],t-8192,e):t>=9152&&t<9216?this.attribTableWrite(this.ntable1[0],t-9152,e):t>=9216&&t<10176?this.nameTableWrite(this.ntable1[1],t-9216,e):t>=10176&&t<10240?this.attribTableWrite(this.ntable1[1],t-10176,e):t>=10240&&t<11200?this.nameTableWrite(this.ntable1[2],t-10240,e):t>=11200&&t<11264?this.attribTableWrite(this.ntable1[2],t-11200,e):t>=11264&&t<12224?this.nameTableWrite(this.ntable1[3],t-11264,e):t>=12224&&t<12288?this.attribTableWrite(this.ntable1[3],t-12224,e):t>=16128&&t<16160&&this.updatePalettes()},updatePalettes:function(){var t;for(t=0;t<16;t++)0===this.f_dispType?this.imgPalette[t]=this.palTable.getEntry(63&this.vramMem[16128+t]):this.imgPalette[t]=this.palTable.getEntry(32&this.vramMem[16128+t]);for(t=0;t<16;t++)0===this.f_dispType?this.sprPalette[t]=this.palTable.getEntry(63&this.vramMem[16144+t]):this.sprPalette[t]=this.palTable.getEntry(32&this.vramMem[16144+t])},patternWrite:function(t,e){var i=Math.floor(t/16),s=t%16;s<8?this.ptTile[i].setScanline(s,e,this.vramMem[t+8]):this.ptTile[i].setScanline(s-8,this.vramMem[t-8],e)},nameTableWrite:function(t,e,i){this.nameTable[t].tile[e]=i,this.checkSprite0(this.scanline-20)},attribTableWrite:function(t,e,i){this.nameTable[t].writeAttrib(e,i)},spriteRamWriteUpdate:function(t,e){var i=Math.floor(t/4);0===i&&this.checkSprite0(this.scanline-20),t%4===0?this.sprY[i]=e:t%4===1?this.sprTile[i]=e:t%4===2?(this.vertFlip[i]=0!==(128&e),this.horiFlip[i]=0!==(64&e),this.bgPriority[i]=0!==(32&e),this.sprCol[i]=(3&e)<<2):t%4===3&&(this.sprX[i]=e)},doNMI:function(){this.setStatusFlag(this.STATUS_VBLANK,!0),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_NMI)},isPixelWhite:function(t,e){return this.triggerRendering(),16777215===this.nes.ppu.buffer[(e<<8)+t]},JSON_PROPERTIES:["vramMem","spriteMem","cntFV","cntV","cntH","cntVT","cntHT","regFV","regV","regH","regVT","regHT","regFH","regS","vramAddress","vramTmpAddress","f_nmiOnVblank","f_spriteSize","f_bgPatternTable","f_spPatternTable","f_addrInc","f_nTblAddress","f_color","f_spVisibility","f_bgVisibility","f_spClipping","f_bgClipping","f_dispType","vramBufferedReadValue","firstWrite","currentMirroring","vramMirrorTable","ntable1","sramAddress","hitSpr0","sprPalette","imgPalette","curX","scanline","lastRenderedScanline","curNt","scantile","attrib","buffer","bgbuffer","pixrendered","requestEndFrame","nmiOk","dummyCycleToggle","nmiCounter","validTileData","scanlineAlreadyRendered"],toJSON:function(){var t,e=o.toJSON(this);for(e.nameTable=[],t=0;t<this.nameTable.length;t++)e.nameTable[t]=this.nameTable[t].toJSON();for(e.ptTile=[],t=0;t<this.ptTile.length;t++)e.ptTile[t]=this.ptTile[t].toJSON();return e},fromJSON:function(t){var e;for(o.fromJSON(this,t),e=0;e<this.nameTable.length;e++)this.nameTable[e].fromJSON(t.nameTable[e]);for(e=0;e<this.ptTile.length;e++)this.ptTile[e].fromJSON(t.ptTile[e]);for(e=0;e<this.spriteMem.length;e++)this.spriteRamWriteUpdate(e,this.spriteMem[e])}};var d=function(t,e,i){this.width=t,this.height=e,this.name=i,this.tile=new Array(t*e),this.attrib=new Array(t*e);for(var s=0;s<t*e;s++)this.tile[s]=0,this.attrib[s]=0};d.prototype={getTileIndex:function(t,e){return this.tile[e*this.width+t]},getAttrib:function(t,e){return this.attrib[e*this.width+t]},writeAttrib:function(t,e){for(var i,s,r,a,n=t%8*4,h=4*Math.floor(t/8),o=0;o<2;o++)for(var l=0;l<2;l++){i=e>>2*(2*o+l)&3;for(var u=0;u<2;u++)for(var c=0;c<2;c++)s=n+2*l+c,r=h+2*o+u,a=r*this.width+s,this.attrib[a]=i<<2&12}},toJSON:function(){return{tile:this.tile,attrib:this.attrib}},fromJSON:function(t){this.tile=t.tile,this.attrib=t.attrib}};var m=function(){this.curTable=new Array(64),this.emphTable=new Array(8),this.currentEmph=-1};m.prototype={reset:function(){this.setEmphasis(0)},loadNTSCPalette:function(){this.curTable=[5395026,11796480,10485760,11599933,7602281,91,95,6208,12048,543240,26368,1196544,7153664,0,0,0,12899815,16728064,14421538,16729963,14090399,6818519,6588,21681,27227,35843,43776,2918400,10777088,0,0,0,16316664,16755516,16742785,16735173,16730354,14633471,4681215,46327,57599,58229,259115,7911470,15065624,7895160,0,0,16777215,16773822,16300216,16300248,16758527,16761855,13095423,10148607,8973816,8650717,12122296,16119980,16777136,16308472,0,0],this.makeTables(),this.setEmphasis(0)},loadPALPalette:function(){this.curTable=[5395026,11796480,10485760,11599933,7602281,91,95,6208,12048,543240,26368,1196544,7153664,0,0,0,12899815,16728064,14421538,16729963,14090399,6818519,6588,21681,27227,35843,43776,2918400,10777088,0,0,0,16316664,16755516,16742785,16735173,16730354,14633471,4681215,46327,57599,58229,259115,7911470,15065624,7895160,0,0,16777215,16773822,16300216,16300248,16758527,16761855,13095423,10148607,8973816,8650717,12122296,16119980,16777136,16308472,0,0],this.makeTables(),this.setEmphasis(0)},makeTables:function(){for(var t,e,i,s,r,a,n,h,o=0;o<8;o++)for(a=1,n=1,h=1,0!==(1&o)&&(a=.75,h=.75),0!==(2&o)&&(a=.75,n=.75),0!==(4&o)&&(n=.75,h=.75),this.emphTable[o]=new Array(64),r=0;r<64;r++)s=this.curTable[r],t=Math.floor(this.getRed(s)*a),e=Math.floor(this.getGreen(s)*n),i=Math.floor(this.getBlue(s)*h),this.emphTable[o][r]=this.getRgb(t,e,i)},setEmphasis:function(t){if(t!==this.currentEmph){this.currentEmph=t;for(var e=0;e<64;e++)this.curTable[e]=this.emphTable[t][e]}},getEntry:function(t){return this.curTable[t]},getRed:function(t){return t>>16&255},getGreen:function(t){return t>>8&255},getBlue:function(t){return 255&t},getRgb:function(t,e,i){return t<<16|e<<8|i},loadDefaultPalette:function(){this.curTable[0]=this.getRgb(117,117,117),this.curTable[1]=this.getRgb(39,27,143),this.curTable[2]=this.getRgb(0,0,171),this.curTable[3]=this.getRgb(71,0,159),this.curTable[4]=this.getRgb(143,0,119),this.curTable[5]=this.getRgb(171,0,19),this.curTable[6]=this.getRgb(167,0,0),this.curTable[7]=this.getRgb(127,11,0),this.curTable[8]=this.getRgb(67,47,0),this.curTable[9]=this.getRgb(0,71,0),this.curTable[10]=this.getRgb(0,81,0),this.curTable[11]=this.getRgb(0,63,23),this.curTable[12]=this.getRgb(27,63,95),this.curTable[13]=this.getRgb(0,0,0),this.curTable[14]=this.getRgb(0,0,0),this.curTable[15]=this.getRgb(0,0,0),this.curTable[16]=this.getRgb(188,188,188),this.curTable[17]=this.getRgb(0,115,239),this.curTable[18]=this.getRgb(35,59,239),this.curTable[19]=this.getRgb(131,0,243),this.curTable[20]=this.getRgb(191,0,191),this.curTable[21]=this.getRgb(231,0,91),this.curTable[22]=this.getRgb(219,43,0),this.curTable[23]=this.getRgb(203,79,15),this.curTable[24]=this.getRgb(139,115,0),this.curTable[25]=this.getRgb(0,151,0),this.curTable[26]=this.getRgb(0,171,0),this.curTable[27]=this.getRgb(0,147,59),this.curTable[28]=this.getRgb(0,131,139),this.curTable[29]=this.getRgb(0,0,0),this.curTable[30]=this.getRgb(0,0,0),this.curTable[31]=this.getRgb(0,0,0),this.curTable[32]=this.getRgb(255,255,255),this.curTable[33]=this.getRgb(63,191,255),this.curTable[34]=this.getRgb(95,151,255),this.curTable[35]=this.getRgb(167,139,253),this.curTable[36]=this.getRgb(247,123,255),this.curTable[37]=this.getRgb(255,119,183),this.curTable[38]=this.getRgb(255,119,99),this.curTable[39]=this.getRgb(255,155,59),this.curTable[40]=this.getRgb(243,191,63),this.curTable[41]=this.getRgb(131,211,19),this.curTable[42]=this.getRgb(79,223,75),this.curTable[43]=this.getRgb(88,248,152),this.curTable[44]=this.getRgb(0,235,219),this.curTable[45]=this.getRgb(0,0,0),this.curTable[46]=this.getRgb(0,0,0),this.curTable[47]=this.getRgb(0,0,0),this.curTable[48]=this.getRgb(255,255,255),this.curTable[49]=this.getRgb(171,231,255),this.curTable[50]=this.getRgb(199,215,255),this.curTable[51]=this.getRgb(215,203,255),this.curTable[52]=this.getRgb(255,199,255),this.curTable[53]=this.getRgb(255,199,219),this.curTable[54]=this.getRgb(255,191,179),this.curTable[55]=this.getRgb(255,219,171),this.curTable[56]=this.getRgb(255,231,163),this.curTable[57]=this.getRgb(227,255,163),this.curTable[58]=this.getRgb(171,243,191),this.curTable[59]=this.getRgb(179,255,207),this.curTable[60]=this.getRgb(159,255,243),this.curTable[61]=this.getRgb(0,0,0),this.curTable[62]=this.getRgb(0,0,0),this.curTable[63]=this.getRgb(0,0,0),this.makeTables(),this.setEmphasis(0)}};var _=1789772.5,f=function(t){this.nes=t,this.square1=new S(this,!0),this.square2=new S(this,!1),this.triangle=new b(this),this.noise=new g(this),this.dmc=new R(this),this.frameIrqCounter=null,this.frameIrqCounterMax=4,this.initCounter=2048,this.channelEnableValue=null,this.sampleRate=44100,this.lengthLookup=null,this.dmcFreqLookup=null,this.noiseWavelengthLookup=null,this.square_table=null,this.tnd_table=null,this.frameIrqEnabled=!1,this.frameIrqActive=null,this.frameClockNow=null,this.startedPlaying=!1,this.recordOutput=!1,this.initingHardware=!1,this.masterFrameCounter=null,this.derivedFrameCounter=null,this.countSequence=null,this.sampleTimer=null,this.frameTime=null,this.sampleTimerMax=null,this.sampleCount=null,this.triValue=0,this.smpSquare1=null,this.smpSquare2=null,this.smpTriangle=null,this.smpDmc=null,this.accCount=null,this.prevSampleL=0,this.prevSampleR=0,this.smpAccumL=0,this.smpAccumR=0,this.dacRange=0,this.dcValue=0,this.masterVolume=256,this.stereoPosLSquare1=null,this.stereoPosLSquare2=null,this.stereoPosLTriangle=null,this.stereoPosLNoise=null,this.stereoPosLDMC=null,this.stereoPosRSquare1=null,this.stereoPosRSquare2=null,this.stereoPosRTriangle=null,this.stereoPosRNoise=null,this.stereoPosRDMC=null,this.extraCycles=null,this.maxSample=null,this.minSample=null,this.panning=[80,170,100,150,128],this.setPanning(this.panning),this.initLengthLookup(),this.initDmcFrequencyLookup(),this.initNoiseWavelengthLookup(),this.initDACtables();for(var e=0;e<20;e++)16===e?this.writeReg(16400,16):this.writeReg(16384+e,0);this.reset()};f.prototype={reset:function(){this.sampleRate=this.nes.opts.sampleRate,this.sampleTimerMax=Math.floor(1024*_*this.nes.opts.preferredFrameRate/(60*this.sampleRate)),this.frameTime=Math.floor(14915*this.nes.opts.preferredFrameRate/60),this.sampleTimer=0,this.updateChannelEnable(0),this.masterFrameCounter=0,this.derivedFrameCounter=0,this.countSequence=0,this.sampleCount=0,this.initCounter=2048,this.frameIrqEnabled=!1,this.initingHardware=!1,this.resetCounter(),this.square1.reset(),this.square2.reset(),this.triangle.reset(),this.noise.reset(),this.dmc.reset(),this.accCount=0,this.smpSquare1=0,this.smpSquare2=0,this.smpTriangle=0,this.smpDmc=0,this.frameIrqEnabled=!1,this.frameIrqCounterMax=4,this.channelEnableValue=255,this.startedPlaying=!1,this.prevSampleL=0,this.prevSampleR=0,this.smpAccumL=0,this.smpAccumR=0,this.maxSample=-5e5,this.minSample=5e5},readReg:function(t){var e=0;return e|=this.square1.getLengthStatus(),e|=this.square2.getLengthStatus()<<1,e|=this.triangle.getLengthStatus()<<2,e|=this.noise.getLengthStatus()<<3,e|=this.dmc.getLengthStatus()<<4,e|=(this.frameIrqActive&&this.frameIrqEnabled?1:0)<<6,e|=this.dmc.getIrqStatus()<<7,this.frameIrqActive=!1,this.dmc.irqGenerated=!1,65535&e},writeReg:function(t,e){t>=16384&&t<16388?this.square1.writeReg(t,e):t>=16388&&t<16392?this.square2.writeReg(t,e):t>=16392&&t<16396?this.triangle.writeReg(t,e):t>=16396&&t<=16399?this.noise.writeReg(t,e):16400===t||16401===t||16402===t||16403===t?this.dmc.writeReg(t,e):16405===t?(this.updateChannelEnable(e),0!==e&&this.initCounter>0&&(this.initingHardware=!0),this.dmc.writeReg(t,e)):16407===t&&(this.countSequence=e>>7&1,this.masterFrameCounter=0,this.frameIrqActive=!1,this.frameIrqEnabled=0===(e>>6&1),0===this.countSequence?(this.frameIrqCounterMax=4,this.derivedFrameCounter=4):(this.frameIrqCounterMax=5,this.derivedFrameCounter=0,this.frameCounterTick()))},resetCounter:function(){0===this.countSequence?this.derivedFrameCounter=4:this.derivedFrameCounter=0},updateChannelEnable:function(t){this.channelEnableValue=65535&t,this.square1.setEnabled(0!==(1&t)),this.square2.setEnabled(0!==(2&t)),this.triangle.setEnabled(0!==(4&t)),this.noise.setEnabled(0!==(8&t)),this.dmc.setEnabled(0!==(16&t))},clockFrameCounter:function(t){if(this.initCounter>0&&this.initingHardware)return this.initCounter-=t,void(this.initCounter<=0&&(this.initingHardware=!1));t+=this.extraCycles;var e=this.sampleTimerMax-this.sampleTimer;t<<10>e?(this.extraCycles=(t<<10)-e>>10,t-=this.extraCycles):this.extraCycles=0;var i=this.dmc,s=this.triangle,r=this.square1,a=this.square2,n=this.noise;if(i.isEnabled){i.shiftCounter-=t<<3;while(i.shiftCounter<=0&&i.dmaFrequency>0)i.shiftCounter+=i.dmaFrequency,i.clockDmc()}if(s.progTimerMax>0){s.progTimerCount-=t;while(s.progTimerCount<=0)s.progTimerCount+=s.progTimerMax+1,s.linearCounter>0&&s.lengthCounter>0&&(s.triangleCounter++,s.triangleCounter&=31,s.isEnabled&&(s.triangleCounter>=16?s.sampleValue=15&s.triangleCounter:s.sampleValue=15-(15&s.triangleCounter),s.sampleValue<<=4))}r.progTimerCount-=t,r.progTimerCount<=0&&(r.progTimerCount+=r.progTimerMax+1<<1,r.squareCounter++,r.squareCounter&=7,r.updateSampleValue()),a.progTimerCount-=t,a.progTimerCount<=0&&(a.progTimerCount+=a.progTimerMax+1<<1,a.squareCounter++,a.squareCounter&=7,a.updateSampleValue());var h=t;if(n.progTimerCount-h>0)n.progTimerCount-=h,n.accCount+=h,n.accValue+=h*n.sampleValue;else while(h-- >0)--n.progTimerCount<=0&&n.progTimerMax>0&&(n.shiftReg<<=1,n.tmp=32768&(n.shiftReg<<(0===n.randomMode?1:6)^n.shiftReg),0!==n.tmp?(n.shiftReg|=1,n.randomBit=0,n.sampleValue=0):(n.randomBit=1,n.isEnabled&&n.lengthCounter>0?n.sampleValue=n.masterVolume:n.sampleValue=0),n.progTimerCount+=n.progTimerMax),n.accValue+=n.sampleValue,n.accCount++;this.frameIrqEnabled&&this.frameIrqActive&&this.nes.cpu.requestIrq(this.nes.cpu.IRQ_NORMAL),this.masterFrameCounter+=t<<1,this.masterFrameCounter>=this.frameTime&&(this.masterFrameCounter-=this.frameTime,this.frameCounterTick()),this.accSample(t),this.sampleTimer+=t<<10,this.sampleTimer>=this.sampleTimerMax&&(this.sample(),this.sampleTimer-=this.sampleTimerMax)},accSample:function(t){this.triangle.sampleCondition&&(this.triValue=Math.floor((this.triangle.progTimerCount<<4)/(this.triangle.progTimerMax+1)),this.triValue>16&&(this.triValue=16),this.triangle.triangleCounter>=16&&(this.triValue=16-this.triValue),this.triValue+=this.triangle.sampleValue),2===t?(this.smpTriangle+=this.triValue<<1,this.smpDmc+=this.dmc.sample<<1,this.smpSquare1+=this.square1.sampleValue<<1,this.smpSquare2+=this.square2.sampleValue<<1,this.accCount+=2):4===t?(this.smpTriangle+=this.triValue<<2,this.smpDmc+=this.dmc.sample<<2,this.smpSquare1+=this.square1.sampleValue<<2,this.smpSquare2+=this.square2.sampleValue<<2,this.accCount+=4):(this.smpTriangle+=t*this.triValue,this.smpDmc+=t*this.dmc.sample,this.smpSquare1+=t*this.square1.sampleValue,this.smpSquare2+=t*this.square2.sampleValue,this.accCount+=t)},frameCounterTick:function(){this.derivedFrameCounter++,this.derivedFrameCounter>=this.frameIrqCounterMax&&(this.derivedFrameCounter=0),1!==this.derivedFrameCounter&&3!==this.derivedFrameCounter||(this.triangle.clockLengthCounter(),this.square1.clockLengthCounter(),this.square2.clockLengthCounter(),this.noise.clockLengthCounter(),this.square1.clockSweep(),this.square2.clockSweep()),this.derivedFrameCounter>=0&&this.derivedFrameCounter<4&&(this.square1.clockEnvDecay(),this.square2.clockEnvDecay(),this.noise.clockEnvDecay(),this.triangle.clockLinearCounter()),3===this.derivedFrameCounter&&0===this.countSequence&&(this.frameIrqActive=!0)},sample:function(){var t,e;this.accCount>0?(this.smpSquare1<<=4,this.smpSquare1=Math.floor(this.smpSquare1/this.accCount),this.smpSquare2<<=4,this.smpSquare2=Math.floor(this.smpSquare2/this.accCount),this.smpTriangle=Math.floor(this.smpTriangle/this.accCount),this.smpDmc<<=4,this.smpDmc=Math.floor(this.smpDmc/this.accCount),this.accCount=0):(this.smpSquare1=this.square1.sampleValue<<4,this.smpSquare2=this.square2.sampleValue<<4,this.smpTriangle=this.triangle.sampleValue,this.smpDmc=this.dmc.sample<<4);var i=Math.floor((this.noise.accValue<<4)/this.noise.accCount);this.noise.accValue=i>>4,this.noise.accCount=1,t=this.smpSquare1*this.stereoPosLSquare1+this.smpSquare2*this.stereoPosLSquare2>>8,e=3*this.smpTriangle*this.stereoPosLTriangle+(i<<1)*this.stereoPosLNoise+this.smpDmc*this.stereoPosLDMC>>8,t>=this.square_table.length&&(t=this.square_table.length-1),e>=this.tnd_table.length&&(e=this.tnd_table.length-1);var s=this.square_table[t]+this.tnd_table[e]-this.dcValue;t=this.smpSquare1*this.stereoPosRSquare1+this.smpSquare2*this.stereoPosRSquare2>>8,e=3*this.smpTriangle*this.stereoPosRTriangle+(i<<1)*this.stereoPosRNoise+this.smpDmc*this.stereoPosRDMC>>8,t>=this.square_table.length&&(t=this.square_table.length-1),e>=this.tnd_table.length&&(e=this.tnd_table.length-1);var r=this.square_table[t]+this.tnd_table[e]-this.dcValue,a=s-this.prevSampleL;this.prevSampleL+=a,this.smpAccumL+=a-(this.smpAccumL>>10),s=this.smpAccumL;var n=r-this.prevSampleR;this.prevSampleR+=n,this.smpAccumR+=n-(this.smpAccumR>>10),r=this.smpAccumR,s>this.maxSample&&(this.maxSample=s),s<this.minSample&&(this.minSample=s),this.nes.opts.onAudioSample&&this.nes.opts.onAudioSample(s/32768,r/32768),this.smpSquare1=0,this.smpSquare2=0,this.smpTriangle=0,this.smpDmc=0},getLengthMax:function(t){return this.lengthLookup[t>>3]},getDmcFrequency:function(t){return t>=0&&t<16?this.dmcFreqLookup[t]:0},getNoiseWaveLength:function(t){return t>=0&&t<16?this.noiseWavelengthLookup[t]:0},setPanning:function(t){for(var e=0;e<5;e++)this.panning[e]=t[e];this.updateStereoPos()},setMasterVolume:function(t){t<0&&(t=0),t>256&&(t=256),this.masterVolume=t,this.updateStereoPos()},updateStereoPos:function(){this.stereoPosLSquare1=this.panning[0]*this.masterVolume>>8,this.stereoPosLSquare2=this.panning[1]*this.masterVolume>>8,this.stereoPosLTriangle=this.panning[2]*this.masterVolume>>8,this.stereoPosLNoise=this.panning[3]*this.masterVolume>>8,this.stereoPosLDMC=this.panning[4]*this.masterVolume>>8,this.stereoPosRSquare1=this.masterVolume-this.stereoPosLSquare1,this.stereoPosRSquare2=this.masterVolume-this.stereoPosLSquare2,this.stereoPosRTriangle=this.masterVolume-this.stereoPosLTriangle,this.stereoPosRNoise=this.masterVolume-this.stereoPosLNoise,this.stereoPosRDMC=this.masterVolume-this.stereoPosLDMC},initLengthLookup:function(){this.lengthLookup=[10,254,20,2,40,4,80,6,160,8,60,10,14,12,26,14,12,16,24,18,48,20,96,22,192,24,72,26,16,28,32,30]},initDmcFrequencyLookup:function(){this.dmcFreqLookup=new Array(16),this.dmcFreqLookup[0]=3424,this.dmcFreqLookup[1]=3040,this.dmcFreqLookup[2]=2720,this.dmcFreqLookup[3]=2560,this.dmcFreqLookup[4]=2288,this.dmcFreqLookup[5]=2032,this.dmcFreqLookup[6]=1808,this.dmcFreqLookup[7]=1712,this.dmcFreqLookup[8]=1520,this.dmcFreqLookup[9]=1280,this.dmcFreqLookup[10]=1136,this.dmcFreqLookup[11]=1024,this.dmcFreqLookup[12]=848,this.dmcFreqLookup[13]=672,this.dmcFreqLookup[14]=576,this.dmcFreqLookup[15]=432},initNoiseWavelengthLookup:function(){this.noiseWavelengthLookup=new Array(16),this.noiseWavelengthLookup[0]=4,this.noiseWavelengthLookup[1]=8,this.noiseWavelengthLookup[2]=16,this.noiseWavelengthLookup[3]=32,this.noiseWavelengthLookup[4]=64,this.noiseWavelengthLookup[5]=96,this.noiseWavelengthLookup[6]=128,this.noiseWavelengthLookup[7]=160,this.noiseWavelengthLookup[8]=202,this.noiseWavelengthLookup[9]=254,this.noiseWavelengthLookup[10]=380,this.noiseWavelengthLookup[11]=508,this.noiseWavelengthLookup[12]=762,this.noiseWavelengthLookup[13]=1016,this.noiseWavelengthLookup[14]=2034,this.noiseWavelengthLookup[15]=4068},initDACtables:function(){var t,e,i,s=0,r=0;for(this.square_table=new Array(512),this.tnd_table=new Array(3264),i=0;i<512;i++)t=95.52/(8128/(i/16)+100),t*=.98411,t*=5e4,e=Math.floor(t),this.square_table[i]=e,e>s&&(s=e);for(i=0;i<3264;i++)t=163.67/(24329/(i/16)+100),t*=.98411,t*=5e4,e=Math.floor(t),this.tnd_table[i]=e,e>r&&(r=e);this.dacRange=s+r,this.dcValue=this.dacRange/2},JSON_PROPERTIES:["frameIrqCounter","frameIrqCounterMax","initCounter","channelEnableValue","sampleRate","frameIrqEnabled","frameIrqActive","frameClockNow","startedPlaying","recordOutput","initingHardware","masterFrameCounter","derivedFrameCounter","countSequence","sampleTimer","frameTime","sampleTimerMax","sampleCount","triValue","smpSquare1","smpSquare2","smpTriangle","smpDmc","accCount","prevSampleL","prevSampleR","smpAccumL","smpAccumR","masterVolume","stereoPosLSquare1","stereoPosLSquare2","stereoPosLTriangle","stereoPosLNoise","stereoPosLDMC","stereoPosRSquare1","stereoPosRSquare2","stereoPosRTriangle","stereoPosRNoise","stereoPosRDMC","extraCycles","maxSample","minSample","panning"],toJSON:function(){var t=o.toJSON(this);return t.dmc=this.dmc.toJSON(),t.noise=this.noise.toJSON(),t.square1=this.square1.toJSON(),t.square2=this.square2.toJSON(),t.triangle=this.triangle.toJSON(),t},fromJSON:function(t){o.fromJSON(this,t),this.dmc.fromJSON(t.dmc),this.noise.fromJSON(t.noise),this.square1.fromJSON(t.square1),this.square2.fromJSON(t.square2),this.triangle.fromJSON(t.triangle)}};var R=function(t){this.papu=t,this.MODE_NORMAL=0,this.MODE_LOOP=1,this.MODE_IRQ=2,this.isEnabled=null,this.hasSample=null,this.irqGenerated=!1,this.playMode=null,this.dmaFrequency=null,this.dmaCounter=null,this.deltaCounter=null,this.playStartAddress=null,this.playAddress=null,this.playLength=null,this.playLengthCounter=null,this.shiftCounter=null,this.reg4012=null,this.reg4013=null,this.sample=null,this.dacLsb=null,this.data=null,this.reset()};R.prototype={clockDmc:function(){this.hasSample&&(0===(1&this.data)?this.deltaCounter>0&&this.deltaCounter--:this.deltaCounter<63&&this.deltaCounter++,this.sample=this.isEnabled?(this.deltaCounter<<1)+this.dacLsb:0,this.data>>=1),this.dmaCounter--,this.dmaCounter<=0&&(this.hasSample=!1,this.endOfSample(),this.dmaCounter=8),this.irqGenerated&&this.papu.nes.cpu.requestIrq(this.papu.nes.cpu.IRQ_NORMAL)},endOfSample:function(){0===this.playLengthCounter&&this.playMode===this.MODE_LOOP&&(this.playAddress=this.playStartAddress,this.playLengthCounter=this.playLength),this.playLengthCounter>0&&(this.nextSample(),0===this.playLengthCounter&&this.playMode===this.MODE_IRQ&&(this.irqGenerated=!0))},nextSample:function(){this.data=this.papu.nes.mmap.load(this.playAddress),this.papu.nes.cpu.haltCycles(4),this.playLengthCounter--,this.playAddress++,this.playAddress>65535&&(this.playAddress=32768),this.hasSample=!0},writeReg:function(t,e){16400===t?(e>>6===0?this.playMode=this.MODE_NORMAL:1===(e>>6&1)?this.playMode=this.MODE_LOOP:e>>6===2&&(this.playMode=this.MODE_IRQ),0===(128&e)&&(this.irqGenerated=!1),this.dmaFrequency=this.papu.getDmcFrequency(15&e)):16401===t?(this.deltaCounter=e>>1&63,this.dacLsb=1&e,this.sample=(this.deltaCounter<<1)+this.dacLsb):16402===t?(this.playStartAddress=e<<6|49152,this.playAddress=this.playStartAddress,this.reg4012=e):16403===t?(this.playLength=1+(e<<4),this.playLengthCounter=this.playLength,this.reg4013=e):16405===t&&(0===(e>>4&1)?this.playLengthCounter=0:(this.playAddress=this.playStartAddress,this.playLengthCounter=this.playLength),this.irqGenerated=!1)},setEnabled:function(t){!this.isEnabled&&t&&(this.playLengthCounter=this.playLength),this.isEnabled=t},getLengthStatus:function(){return 0!==this.playLengthCounter&&this.isEnabled?1:0},getIrqStatus:function(){return this.irqGenerated?1:0},reset:function(){this.isEnabled=!1,this.irqGenerated=!1,this.playMode=this.MODE_NORMAL,this.dmaFrequency=0,this.dmaCounter=0,this.deltaCounter=0,this.playStartAddress=0,this.playAddress=0,this.playLength=0,this.playLengthCounter=0,this.sample=0,this.dacLsb=0,this.shiftCounter=0,this.reg4012=0,this.reg4013=0,this.data=0},JSON_PROPERTIES:["MODE_NORMAL","MODE_LOOP","MODE_IRQ","isEnabled","hasSample","irqGenerated","playMode","dmaFrequency","dmaCounter","deltaCounter","playStartAddress","playAddress","playLength","playLengthCounter","shiftCounter","reg4012","reg4013","sample","dacLsb","data"],toJSON:function(){return o.toJSON(this)},fromJSON:function(t){o.fromJSON(this,t)}};var g=function(t){this.papu=t,this.isEnabled=null,this.envDecayDisable=null,this.envDecayLoopEnable=null,this.lengthCounterEnable=null,this.envReset=null,this.shiftNow=null,this.lengthCounter=null,this.progTimerCount=null,this.progTimerMax=null,this.envDecayRate=null,this.envDecayCounter=null,this.envVolume=null,this.masterVolume=null,this.shiftReg=16384,this.randomBit=null,this.randomMode=null,this.sampleValue=null,this.accValue=0,this.accCount=1,this.tmp=null,this.reset()};g.prototype={reset:function(){this.progTimerCount=0,this.progTimerMax=0,this.isEnabled=!1,this.lengthCounter=0,this.lengthCounterEnable=!1,this.envDecayDisable=!1,this.envDecayLoopEnable=!1,this.shiftNow=!1,this.envDecayRate=0,this.envDecayCounter=0,this.envVolume=0,this.masterVolume=0,this.shiftReg=1,this.randomBit=0,this.randomMode=0,this.sampleValue=0,this.tmp=0},clockLengthCounter:function(){this.lengthCounterEnable&&this.lengthCounter>0&&(this.lengthCounter--,0===this.lengthCounter&&this.updateSampleValue())},clockEnvDecay:function(){this.envReset?(this.envReset=!1,this.envDecayCounter=this.envDecayRate+1,this.envVolume=15):--this.envDecayCounter<=0&&(this.envDecayCounter=this.envDecayRate+1,this.envVolume>0?this.envVolume--:this.envVolume=this.envDecayLoopEnable?15:0),this.envDecayDisable?this.masterVolume=this.envDecayRate:this.masterVolume=this.envVolume,this.updateSampleValue()},updateSampleValue:function(){this.isEnabled&&this.lengthCounter>0&&(this.sampleValue=this.randomBit*this.masterVolume)},writeReg:function(t,e){16396===t?(this.envDecayDisable=0!==(16&e),this.envDecayRate=15&e,this.envDecayLoopEnable=0!==(32&e),this.lengthCounterEnable=0===(32&e),this.envDecayDisable?this.masterVolume=this.envDecayRate:this.masterVolume=this.envVolume):16398===t?(this.progTimerMax=this.papu.getNoiseWaveLength(15&e),this.randomMode=e>>7):16399===t&&(this.lengthCounter=this.papu.getLengthMax(248&e),this.envReset=!0)},setEnabled:function(t){this.isEnabled=t,t||(this.lengthCounter=0),this.updateSampleValue()},getLengthStatus:function(){return 0!==this.lengthCounter&&this.isEnabled?1:0},JSON_PROPERTIES:["isEnabled","envDecayDisable","envDecayLoopEnable","lengthCounterEnable","envReset","shiftNow","lengthCounter","progTimerCount","progTimerMax","envDecayRate","envDecayCounter","envVolume","masterVolume","shiftReg","randomBit","randomMode","sampleValue","accValue","accCount","tmp"],toJSON:function(){return o.toJSON(this)},fromJSON:function(t){o.fromJSON(this,t)}};var S=function(t,e){this.papu=t,this.dutyLookup=[0,1,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,1,0,0,1,1,1,1,1],this.impLookup=[1,-1,0,0,0,0,0,0,1,0,-1,0,0,0,0,0,1,0,0,0,-1,0,0,0,-1,0,1,0,0,0,0,0],this.sqr1=e,this.isEnabled=null,this.lengthCounterEnable=null,this.sweepActive=null,this.envDecayDisable=null,this.envDecayLoopEnable=null,this.envReset=null,this.sweepCarry=null,this.updateSweepPeriod=null,this.progTimerCount=null,this.progTimerMax=null,this.lengthCounter=null,this.squareCounter=null,this.sweepCounter=null,this.sweepCounterMax=null,this.sweepMode=null,this.sweepShiftAmount=null,this.envDecayRate=null,this.envDecayCounter=null,this.envVolume=null,this.masterVolume=null,this.dutyMode=null,this.sweepResult=null,this.sampleValue=null,this.vol=null,this.reset()};S.prototype={reset:function(){this.progTimerCount=0,this.progTimerMax=0,this.lengthCounter=0,this.squareCounter=0,this.sweepCounter=0,this.sweepCounterMax=0,this.sweepMode=0,this.sweepShiftAmount=0,this.envDecayRate=0,this.envDecayCounter=0,this.envVolume=0,this.masterVolume=0,this.dutyMode=0,this.vol=0,this.isEnabled=!1,this.lengthCounterEnable=!1,this.sweepActive=!1,this.sweepCarry=!1,this.envDecayDisable=!1,this.envDecayLoopEnable=!1},clockLengthCounter:function(){this.lengthCounterEnable&&this.lengthCounter>0&&(this.lengthCounter--,0===this.lengthCounter&&this.updateSampleValue())},clockEnvDecay:function(){this.envReset?(this.envReset=!1,this.envDecayCounter=this.envDecayRate+1,this.envVolume=15):--this.envDecayCounter<=0&&(this.envDecayCounter=this.envDecayRate+1,this.envVolume>0?this.envVolume--:this.envVolume=this.envDecayLoopEnable?15:0),this.envDecayDisable?this.masterVolume=this.envDecayRate:this.masterVolume=this.envVolume,this.updateSampleValue()},clockSweep:function(){--this.sweepCounter<=0&&(this.sweepCounter=this.sweepCounterMax+1,this.sweepActive&&this.sweepShiftAmount>0&&this.progTimerMax>7&&(this.sweepCarry=!1,0===this.sweepMode?(this.progTimerMax+=this.progTimerMax>>this.sweepShiftAmount,this.progTimerMax>4095&&(this.progTimerMax=4095,this.sweepCarry=!0)):this.progTimerMax=this.progTimerMax-((this.progTimerMax>>this.sweepShiftAmount)-(this.sqr1?1:0)))),this.updateSweepPeriod&&(this.updateSweepPeriod=!1,this.sweepCounter=this.sweepCounterMax+1)},updateSampleValue:function(){this.isEnabled&&this.lengthCounter>0&&this.progTimerMax>7?0===this.sweepMode&&this.progTimerMax+(this.progTimerMax>>this.sweepShiftAmount)>4095?this.sampleValue=0:this.sampleValue=this.masterVolume*this.dutyLookup[(this.dutyMode<<3)+this.squareCounter]:this.sampleValue=0},writeReg:function(t,e){var i=this.sqr1?0:4;t===16384+i?(this.envDecayDisable=0!==(16&e),this.envDecayRate=15&e,this.envDecayLoopEnable=0!==(32&e),this.dutyMode=e>>6&3,this.lengthCounterEnable=0===(32&e),this.envDecayDisable?this.masterVolume=this.envDecayRate:this.masterVolume=this.envVolume,this.updateSampleValue()):t===16385+i?(this.sweepActive=0!==(128&e),this.sweepCounterMax=e>>4&7,this.sweepMode=e>>3&1,this.sweepShiftAmount=7&e,this.updateSweepPeriod=!0):t===16386+i?(this.progTimerMax&=1792,this.progTimerMax|=e):t===16387+i&&(this.progTimerMax&=255,this.progTimerMax|=(7&e)<<8,this.isEnabled&&(this.lengthCounter=this.papu.getLengthMax(248&e)),this.envReset=!0)},setEnabled:function(t){this.isEnabled=t,t||(this.lengthCounter=0),this.updateSampleValue()},getLengthStatus:function(){return 0!==this.lengthCounter&&this.isEnabled?1:0},JSON_PROPERTIES:["isEnabled","lengthCounterEnable","sweepActive","envDecayDisable","envDecayLoopEnable","envReset","sweepCarry","updateSweepPeriod","progTimerCount","progTimerMax","lengthCounter","squareCounter","sweepCounter","sweepCounterMax","sweepMode","sweepShiftAmount","envDecayRate","envDecayCounter","envVolume","masterVolume","dutyMode","sweepResult","sampleValue","vol"],toJSON:function(){return o.toJSON(this)},fromJSON:function(t){o.fromJSON(this,t)}};var b=function(t){this.papu=t,this.isEnabled=null,this.sampleCondition=null,this.lengthCounterEnable=null,this.lcHalt=null,this.lcControl=null,this.progTimerCount=null,this.progTimerMax=null,this.triangleCounter=null,this.lengthCounter=null,this.linearCounter=null,this.lcLoadValue=null,this.sampleValue=null,this.tmp=null,this.reset()};b.prototype={reset:function(){this.progTimerCount=0,this.progTimerMax=0,this.triangleCounter=0,this.isEnabled=!1,this.sampleCondition=!1,this.lengthCounter=0,this.lengthCounterEnable=!1,this.linearCounter=0,this.lcLoadValue=0,this.lcHalt=!0,this.lcControl=!1,this.tmp=0,this.sampleValue=15},clockLengthCounter:function(){this.lengthCounterEnable&&this.lengthCounter>0&&(this.lengthCounter--,0===this.lengthCounter&&this.updateSampleCondition())},clockLinearCounter:function(){this.lcHalt?(this.linearCounter=this.lcLoadValue,this.updateSampleCondition()):this.linearCounter>0&&(this.linearCounter--,this.updateSampleCondition()),this.lcControl||(this.lcHalt=!1)},getLengthStatus:function(){return 0!==this.lengthCounter&&this.isEnabled?1:0},readReg:function(t){return 0},writeReg:function(t,e){16392===t?(this.lcControl=0!==(128&e),this.lcLoadValue=127&e,this.lengthCounterEnable=!this.lcControl):16394===t?(this.progTimerMax&=1792,this.progTimerMax|=e):16395===t&&(this.progTimerMax&=255,this.progTimerMax|=(7&e)<<8,this.lengthCounter=this.papu.getLengthMax(248&e),this.lcHalt=!0),this.updateSampleCondition()},clockProgrammableTimer:function(t){if(this.progTimerMax>0){this.progTimerCount+=t;while(this.progTimerMax>0&&this.progTimerCount>=this.progTimerMax)this.progTimerCount-=this.progTimerMax,this.isEnabled&&this.lengthCounter>0&&this.linearCounter>0&&this.clockTriangleGenerator()}},clockTriangleGenerator:function(){this.triangleCounter++,this.triangleCounter&=31},setEnabled:function(t){this.isEnabled=t,t||(this.lengthCounter=0),this.updateSampleCondition()},updateSampleCondition:function(){this.sampleCondition=this.isEnabled&&this.progTimerMax>7&&this.linearCounter>0&&this.lengthCounter>0},JSON_PROPERTIES:["isEnabled","sampleCondition","lengthCounterEnable","lcHalt","lcControl","progTimerCount","progTimerMax","triangleCounter","lengthCounter","linearCounter","lcLoadValue","sampleValue","tmp"],toJSON:function(){return o.toJSON(this)},fromJSON:function(t){o.fromJSON(this,t)}};var A={0:function(t){this.nes=t}};A[0].prototype={reset:function(){this.joy1StrobeState=0,this.joy2StrobeState=0,this.joypadLastWrite=0,this.zapperFired=!1,this.zapperX=null,this.zapperY=null},write:function(t,e){t<8192?this.nes.cpu.mem[2047&t]=e:t>16407?(this.nes.cpu.mem[t]=e,t>=24576&&t<32768&&this.nes.opts.onBatteryRamWrite(t,e)):t>8199&&t<16384?this.regWrite(8192+(7&t),e):this.regWrite(t,e)},writelow:function(t,e){t<8192?this.nes.cpu.mem[2047&t]=e:t>16407?this.nes.cpu.mem[t]=e:t>8199&&t<16384?this.regWrite(8192+(7&t),e):this.regWrite(t,e)},load:function(t){return t&=65535,t>16407?this.nes.cpu.mem[t]:t>=8192?this.regLoad(t):this.nes.cpu.mem[2047&t]},regLoad:function(t){switch(t>>12){case 0:break;case 1:break;case 2:case 3:switch(7&t){case 0:return this.nes.cpu.mem[8192];case 1:return this.nes.cpu.mem[8193];case 2:return this.nes.ppu.readStatusRegister();case 3:return 0;case 4:return this.nes.ppu.sramLoad();case 5:return 0;case 6:return 0;case 7:return this.nes.ppu.vramLoad()}break;case 4:switch(t-16405){case 0:return this.nes.papu.readReg(t);case 1:return this.joy1Read();case 2:var e;return e=null!==this.zapperX&&null!==this.zapperY&&this.nes.ppu.isPixelWhite(this.zapperX,this.zapperY)?0:8,this.zapperFired&&(e|=16),65535&(this.joy2Read()|e)}break}return 0},regWrite:function(t,e){switch(t){case 8192:this.nes.cpu.mem[t]=e,this.nes.ppu.updateControlReg1(e);break;case 8193:this.nes.cpu.mem[t]=e,this.nes.ppu.updateControlReg2(e);break;case 8195:this.nes.ppu.writeSRAMAddress(e);break;case 8196:this.nes.ppu.sramWrite(e);break;case 8197:this.nes.ppu.scrollWrite(e);break;case 8198:this.nes.ppu.writeVRAMAddress(e);break;case 8199:this.nes.ppu.vramWrite(e);break;case 16404:this.nes.ppu.sramDMA(e);break;case 16405:this.nes.papu.writeReg(t,e);break;case 16406:0===(1&e)&&1===(1&this.joypadLastWrite)&&(this.joy1StrobeState=0,this.joy2StrobeState=0),this.joypadLastWrite=e;break;case 16407:this.nes.papu.writeReg(t,e);break;default:t>=16384&&t<=16407&&this.nes.papu.writeReg(t,e)}},joy1Read:function(){var t;switch(this.joy1StrobeState){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t=this.nes.controllers[1].state[this.joy1StrobeState];break;case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:t=0;break;case 19:t=1;break;default:t=0}return this.joy1StrobeState++,24===this.joy1StrobeState&&(this.joy1StrobeState=0),t},joy2Read:function(){var t;switch(this.joy2StrobeState){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t=this.nes.controllers[2].state[this.joy2StrobeState];break;case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:t=0;break;case 19:t=1;break;default:t=0}return this.joy2StrobeState++,24===this.joy2StrobeState&&(this.joy2StrobeState=0),t},loadROM:function(){if(!this.nes.rom.valid||this.nes.rom.romCount<1)throw new Error("NoMapper: Invalid ROM! Unable to load.");this.loadPRGROM(),this.loadCHRROM(),this.loadBatteryRam(),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)},loadPRGROM:function(){this.nes.rom.romCount>1?(this.loadRomBank(0,32768),this.loadRomBank(1,49152)):(this.loadRomBank(0,32768),this.loadRomBank(0,49152))},loadCHRROM:function(){this.nes.rom.vromCount>0&&(1===this.nes.rom.vromCount?(this.loadVromBank(0,0),this.loadVromBank(0,4096)):(this.loadVromBank(0,0),this.loadVromBank(1,4096)))},loadBatteryRam:function(){if(this.nes.rom.batteryRam){var t=this.nes.rom.batteryRam;null!==t&&8192===t.length&&o.copyArrayElements(t,0,this.nes.cpu.mem,24576,8192)}},loadRomBank:function(t,e){t%=this.nes.rom.romCount,o.copyArrayElements(this.nes.rom.rom[t],0,this.nes.cpu.mem,e,16384)},loadVromBank:function(t,e){if(0!==this.nes.rom.vromCount){this.nes.ppu.triggerRendering(),o.copyArrayElements(this.nes.rom.vrom[t%this.nes.rom.vromCount],0,this.nes.ppu.vramMem,e,4096);var i=this.nes.rom.vromTile[t%this.nes.rom.vromCount];o.copyArrayElements(i,0,this.nes.ppu.ptTile,e>>4,256)}},load32kRomBank:function(t,e){this.loadRomBank(2*t%this.nes.rom.romCount,e),this.loadRomBank((2*t+1)%this.nes.rom.romCount,e+16384)},load8kVromBank:function(t,e){0!==this.nes.rom.vromCount&&(this.nes.ppu.triggerRendering(),this.loadVromBank(t%this.nes.rom.vromCount,e),this.loadVromBank((t+1)%this.nes.rom.vromCount,e+4096))},load1kVromBank:function(t,e){if(0!==this.nes.rom.vromCount){this.nes.ppu.triggerRendering();var i=Math.floor(t/4)%this.nes.rom.vromCount,s=t%4*1024;o.copyArrayElements(this.nes.rom.vrom[i],s,this.nes.ppu.vramMem,e,1024);for(var r=this.nes.rom.vromTile[i],a=e>>4,n=0;n<64;n++)this.nes.ppu.ptTile[a+n]=r[(t%4<<6)+n]}},load2kVromBank:function(t,e){if(0!==this.nes.rom.vromCount){this.nes.ppu.triggerRendering();var i=Math.floor(t/2)%this.nes.rom.vromCount,s=t%2*2048;o.copyArrayElements(this.nes.rom.vrom[i],s,this.nes.ppu.vramMem,e,2048);for(var r=this.nes.rom.vromTile[i],a=e>>4,n=0;n<128;n++)this.nes.ppu.ptTile[a+n]=r[(t%2<<7)+n]}},load8kRomBank:function(t,e){var i=Math.floor(t/2)%this.nes.rom.romCount,s=t%2*8192;o.copyArrayElements(this.nes.rom.rom[i],s,this.nes.cpu.mem,e,8192)},clockIrqCounter:function(){},latchAccess:function(t){},toJSON:function(){return{joy1StrobeState:this.joy1StrobeState,joy2StrobeState:this.joy2StrobeState,joypadLastWrite:this.joypadLastWrite}},fromJSON:function(t){this.joy1StrobeState=t.joy1StrobeState,this.joy2StrobeState=t.joy2StrobeState,this.joypadLastWrite=t.joypadLastWrite}},A[1]=function(t){this.nes=t},A[1].prototype=new A[0],A[1].prototype.reset=function(){A[0].prototype.reset.apply(this),this.regBuffer=0,this.regBufferCounter=0,this.mirroring=0,this.oneScreenMirroring=0,this.prgSwitchingArea=1,this.prgSwitchingSize=1,this.vromSwitchingSize=0,this.romSelectionReg0=0,this.romSelectionReg1=0,this.romBankSelect=0},A[1].prototype.write=function(t,e){t<32768?A[0].prototype.write.apply(this,arguments):0!==(128&e)?(this.regBufferCounter=0,this.regBuffer=0,0===this.getRegNumber(t)&&(this.prgSwitchingArea=1,this.prgSwitchingSize=1)):(this.regBuffer=this.regBuffer&255-(1<<this.regBufferCounter)|(1&e)<<this.regBufferCounter,this.regBufferCounter++,5===this.regBufferCounter&&(this.setReg(this.getRegNumber(t),this.regBuffer),this.regBuffer=0,this.regBufferCounter=0))},A[1].prototype.setReg=function(t,e){var i;switch(t){case 0:i=3&e,i!==this.mirroring&&(this.mirroring=i,0===(2&this.mirroring)?this.nes.ppu.setMirroring(this.nes.rom.SINGLESCREEN_MIRRORING):0!==(1&this.mirroring)?this.nes.ppu.setMirroring(this.nes.rom.HORIZONTAL_MIRRORING):this.nes.ppu.setMirroring(this.nes.rom.VERTICAL_MIRRORING)),this.prgSwitchingArea=e>>2&1,this.prgSwitchingSize=e>>3&1,this.vromSwitchingSize=e>>4&1;break;case 1:this.romSelectionReg0=e>>4&1,this.nes.rom.vromCount>0&&(0===this.vromSwitchingSize?0===this.romSelectionReg0?this.load8kVromBank(15&e,0):this.load8kVromBank(Math.floor(this.nes.rom.vromCount/2)+(15&e),0):0===this.romSelectionReg0?this.loadVromBank(15&e,0):this.loadVromBank(Math.floor(this.nes.rom.vromCount/2)+(15&e),0));break;case 2:this.romSelectionReg1=e>>4&1,this.nes.rom.vromCount>0&&1===this.vromSwitchingSize&&(0===this.romSelectionReg1?this.loadVromBank(15&e,4096):this.loadVromBank(Math.floor(this.nes.rom.vromCount/2)+(15&e),4096));break;default:var s;i=15&e;var r=0;this.nes.rom.romCount>=32?0===this.vromSwitchingSize?1===this.romSelectionReg0&&(r=16):r=(this.romSelectionReg0|this.romSelectionReg1<<1)<<3:this.nes.rom.romCount>=16&&1===this.romSelectionReg0&&(r=8),0===this.prgSwitchingSize?(s=r+(15&e),this.load32kRomBank(s,32768)):(s=2*r+(15&e),0===this.prgSwitchingArea?this.loadRomBank(s,49152):this.loadRomBank(s,32768))}},A[1].prototype.getRegNumber=function(t){return t>=32768&&t<=40959?0:t>=40960&&t<=49151?1:t>=49152&&t<=57343?2:3},A[1].prototype.loadROM=function(){if(!this.nes.rom.valid)throw new Error("MMC1: Invalid ROM! Unable to load.");this.loadRomBank(0,32768),this.loadRomBank(this.nes.rom.romCount-1,49152),this.loadCHRROM(),this.loadBatteryRam(),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)},A[1].prototype.switchLowHighPrgRom=function(t){},A[1].prototype.switch16to32=function(){},A[1].prototype.switch32to16=function(){},A[1].prototype.toJSON=function(){var t=A[0].prototype.toJSON.apply(this);return t.mirroring=this.mirroring,t.oneScreenMirroring=this.oneScreenMirroring,t.prgSwitchingArea=this.prgSwitchingArea,t.prgSwitchingSize=this.prgSwitchingSize,t.vromSwitchingSize=this.vromSwitchingSize,t.romSelectionReg0=this.romSelectionReg0,t.romSelectionReg1=this.romSelectionReg1,t.romBankSelect=this.romBankSelect,t.regBuffer=this.regBuffer,t.regBufferCounter=this.regBufferCounter,t},A[1].prototype.fromJSON=function(t){A[0].prototype.fromJSON.apply(this,arguments),this.mirroring=t.mirroring,this.oneScreenMirroring=t.oneScreenMirroring,this.prgSwitchingArea=t.prgSwitchingArea,this.prgSwitchingSize=t.prgSwitchingSize,this.vromSwitchingSize=t.vromSwitchingSize,this.romSelectionReg0=t.romSelectionReg0,this.romSelectionReg1=t.romSelectionReg1,this.romBankSelect=t.romBankSelect,this.regBuffer=t.regBuffer,this.regBufferCounter=t.regBufferCounter},A[2]=function(t){this.nes=t},A[2].prototype=new A[0],A[2].prototype.write=function(t,e){t<32768?A[0].prototype.write.apply(this,arguments):this.loadRomBank(e,32768)},A[2].prototype.loadROM=function(){if(!this.nes.rom.valid)throw new Error("UNROM: Invalid ROM! Unable to load.");this.loadRomBank(0,32768),this.loadRomBank(this.nes.rom.romCount-1,49152),this.loadCHRROM(),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)},A[3]=function(t){this.nes=t},A[3].prototype=new A[0],A[3].prototype.write=function(t,e){if(t<32768)A[0].prototype.write.apply(this,arguments);else{var i=e%(this.nes.rom.vromCount/2)*2;this.loadVromBank(i,0),this.loadVromBank(i+1,4096),this.load8kVromBank(2*e,0)}},A[4]=function(t){this.nes=t,this.CMD_SEL_2_1K_VROM_0000=0,this.CMD_SEL_2_1K_VROM_0800=1,this.CMD_SEL_1K_VROM_1000=2,this.CMD_SEL_1K_VROM_1400=3,this.CMD_SEL_1K_VROM_1800=4,this.CMD_SEL_1K_VROM_1C00=5,this.CMD_SEL_ROM_PAGE1=6,this.CMD_SEL_ROM_PAGE2=7,this.command=null,this.prgAddressSelect=null,this.chrAddressSelect=null,this.pageNumber=null,this.irqCounter=null,this.irqLatchValue=null,this.irqEnable=null,this.prgAddressChanged=!1},A[4].prototype=new A[0],A[4].prototype.write=function(t,e){if(t<32768)A[0].prototype.write.apply(this,arguments);else switch(t){case 32768:this.command=7&e;var i=e>>6&1;i!==this.prgAddressSelect&&(this.prgAddressChanged=!0),this.prgAddressSelect=i,this.chrAddressSelect=e>>7&1;break;case 32769:this.executeCommand(this.command,e);break;case 40960:0!==(1&e)?this.nes.ppu.setMirroring(this.nes.rom.HORIZONTAL_MIRRORING):this.nes.ppu.setMirroring(this.nes.rom.VERTICAL_MIRRORING);break;case 40961:break;case 49152:this.irqCounter=e;break;case 49153:this.irqLatchValue=e;break;case 57344:this.irqEnable=0;break;case 57345:this.irqEnable=1;break;default:}},A[4].prototype.executeCommand=function(t,e){switch(t){case this.CMD_SEL_2_1K_VROM_0000:0===this.chrAddressSelect?(this.load1kVromBank(e,0),this.load1kVromBank(e+1,1024)):(this.load1kVromBank(e,4096),this.load1kVromBank(e+1,5120));break;case this.CMD_SEL_2_1K_VROM_0800:0===this.chrAddressSelect?(this.load1kVromBank(e,2048),this.load1kVromBank(e+1,3072)):(this.load1kVromBank(e,6144),this.load1kVromBank(e+1,7168));break;case this.CMD_SEL_1K_VROM_1000:0===this.chrAddressSelect?this.load1kVromBank(e,4096):this.load1kVromBank(e,0);break;case this.CMD_SEL_1K_VROM_1400:0===this.chrAddressSelect?this.load1kVromBank(e,5120):this.load1kVromBank(e,1024);break;case this.CMD_SEL_1K_VROM_1800:0===this.chrAddressSelect?this.load1kVromBank(e,6144):this.load1kVromBank(e,2048);break;case this.CMD_SEL_1K_VROM_1C00:0===this.chrAddressSelect?this.load1kVromBank(e,7168):this.load1kVromBank(e,3072);break;case this.CMD_SEL_ROM_PAGE1:this.prgAddressChanged&&(0===this.prgAddressSelect?this.load8kRomBank(2*(this.nes.rom.romCount-1),49152):this.load8kRomBank(2*(this.nes.rom.romCount-1),32768),this.prgAddressChanged=!1),0===this.prgAddressSelect?this.load8kRomBank(e,32768):this.load8kRomBank(e,49152);break;case this.CMD_SEL_ROM_PAGE2:this.load8kRomBank(e,40960),this.prgAddressChanged&&(0===this.prgAddressSelect?this.load8kRomBank(2*(this.nes.rom.romCount-1),49152):this.load8kRomBank(2*(this.nes.rom.romCount-1),32768),this.prgAddressChanged=!1)}},A[4].prototype.loadROM=function(){if(!this.nes.rom.valid)throw new Error("MMC3: Invalid ROM! Unable to load.");this.load8kRomBank(2*(this.nes.rom.romCount-1),49152),this.load8kRomBank(2*(this.nes.rom.romCount-1)+1,57344),this.load8kRomBank(0,32768),this.load8kRomBank(1,40960),this.loadCHRROM(),this.loadBatteryRam(),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)},A[4].prototype.clockIrqCounter=function(){1===this.irqEnable&&(this.irqCounter--,this.irqCounter<0&&(this.nes.cpu.requestIrq(this.nes.cpu.IRQ_NORMAL),this.irqCounter=this.irqLatchValue))},A[4].prototype.toJSON=function(){var t=A[0].prototype.toJSON.apply(this);return t.command=this.command,t.prgAddressSelect=this.prgAddressSelect,t.chrAddressSelect=this.chrAddressSelect,t.pageNumber=this.pageNumber,t.irqCounter=this.irqCounter,t.irqLatchValue=this.irqLatchValue,t.irqEnable=this.irqEnable,t.prgAddressChanged=this.prgAddressChanged,t},A[4].prototype.fromJSON=function(t){A[0].prototype.fromJSON.apply(this,arguments),this.command=t.command,this.prgAddressSelect=t.prgAddressSelect,this.chrAddressSelect=t.chrAddressSelect,this.pageNumber=t.pageNumber,this.irqCounter=t.irqCounter,this.irqLatchValue=t.irqLatchValue,this.irqEnable=t.irqEnable,this.prgAddressChanged=t.prgAddressChanged},A[5]=function(t){this.nes=t},A[5].prototype=new A[0],A[5].prototype.write=function(t,e){t<32768?A[0].prototype.write.apply(this,arguments):this.load8kVromBank(e,0)},A[5].prototype.write=function(t,e){if(t<20480)A[0].prototype.write.apply(this,arguments);else switch(t){case 20736:this.prg_size=3&e;break;case 20737:this.chr_size=3&e;break;case 20738:this.sram_we_a=3&e;break;case 20739:this.sram_we_b=3&e;break;case 20740:this.graphic_mode=3&e;break;case 20741:this.nametable_mode=e,this.nametable_type[0]=3&e,this.load1kVromBank(3&e,8192),e>>=2,this.nametable_type[1]=3&e,this.load1kVromBank(3&e,9216),e>>=2,this.nametable_type[2]=3&e,this.load1kVromBank(3&e,10240),e>>=2,this.nametable_type[3]=3&e,this.load1kVromBank(3&e,11264);break;case 20742:this.fill_chr=e;break;case 20743:this.fill_pal=3&e;break;case 20755:this.SetBank_SRAM(3,3&e);break;case 20756:case 20757:case 20758:case 20759:this.SetBank_CPU(t,e);break;case 20768:case 20769:case 20770:case 20771:case 20772:case 20773:case 20774:case 20775:this.chr_mode=0,this.chr_page[0][7&t]=e,this.SetBank_PPU();break;case 20776:case 20777:case 20778:case 20779:this.chr_mode=1,this.chr_page[1][0+(3&t)]=e,this.chr_page[1][4+(3&t)]=e,this.SetBank_PPU();break;case 20992:this.split_control=e;break;case 20993:this.split_scroll=e;break;case 20994:this.split_page=63&e;break;case 20995:this.irq_line=e,this.nes.cpu.ClearIRQ();break;case 20996:this.irq_enable=e,this.nes.cpu.ClearIRQ();break;case 20997:this.mult_a=e;break;case 20998:this.mult_b=e;break;default:t>=20480&&t<=20501?this.nes.papu.exWrite(t,e):t>=23552&&t<=24575?2===this.graphic_mode||3!==this.graphic_mode&&this.irq_status:t>=24576&&t<=32767&&2===this.sram_we_a&&this.sram_we_b;break}},A[5].prototype.loadROM=function(){if(!this.nes.rom.valid)throw new Error("UNROM: Invalid ROM! Unable to load.");this.load8kRomBank(2*this.nes.rom.romCount-1,32768),this.load8kRomBank(2*this.nes.rom.romCount-1,40960),this.load8kRomBank(2*this.nes.rom.romCount-1,49152),this.load8kRomBank(2*this.nes.rom.romCount-1,57344),this.loadCHRROM(),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)},A[7]=function(t){this.nes=t},A[7].prototype=new A[0],A[7].prototype.write=function(t,e){t<32768?A[0].prototype.write.apply(this,arguments):(this.load32kRomBank(7&e,32768),16&e?this.nes.ppu.setMirroring(this.nes.rom.SINGLESCREEN_MIRRORING2):this.nes.ppu.setMirroring(this.nes.rom.SINGLESCREEN_MIRRORING))},A[7].prototype.loadROM=function(){if(!this.nes.rom.valid)throw new Error("AOROM: Invalid ROM! Unable to load.");this.loadPRGROM(),this.loadCHRROM(),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)},A[11]=function(t){this.nes=t},A[11].prototype=new A[0],A[11].prototype.write=function(t,e){if(t<32768)A[0].prototype.write.apply(this,arguments);else{var i=2*(15&e)%this.nes.rom.romCount,s=(2*(15&e)+1)%this.nes.rom.romCount;if(this.loadRomBank(i,32768),this.loadRomBank(s,49152),this.nes.rom.vromCount>0){var r=2*(e>>4)%this.nes.rom.vromCount;this.loadVromBank(r,0),this.loadVromBank(r+1,4096)}}},A[34]=function(t){this.nes=t},A[34].prototype=new A[0],A[34].prototype.write=function(t,e){t<32768?A[0].prototype.write.apply(this,arguments):this.load32kRomBank(e,32768)},A[38]=function(t){this.nes=t},A[38].prototype=new A[0],A[38].prototype.write=function(t,e){t<28672||t>32767?A[0].prototype.write.apply(this,arguments):(this.load32kRomBank(3&e,32768),this.load8kVromBank(2*(e>>2&3),0))},A[66]=function(t){this.nes=t},A[66].prototype=new A[0],A[66].prototype.write=function(t,e){t<32768?A[0].prototype.write.apply(this,arguments):(this.load32kRomBank(e>>4&3,32768),this.load8kVromBank(2*(3&e),0))},A[94]=function(t){this.nes=t},A[94].prototype=new A[0],A[94].prototype.write=function(t,e){t<32768?A[0].prototype.write.apply(this,arguments):this.loadRomBank(e>>2,32768)},A[94].prototype.loadROM=function(){if(!this.nes.rom.valid)throw new Error("UN1ROM: Invalid ROM! Unable to load.");this.loadRomBank(0,32768),this.loadRomBank(this.nes.rom.romCount-1,49152),this.loadCHRROM(),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)},A[140]=function(t){this.nes=t},A[140].prototype=new A[0],A[140].prototype.write=function(t,e){t<24576||t>32767?A[0].prototype.write.apply(this,arguments):(this.load32kRomBank(e>>4&3,32768),this.load8kVromBank(2*(15&e),0))},A[180]=function(t){this.nes=t},A[180].prototype=new A[0],A[180].prototype.write=function(t,e){t<32768?A[0].prototype.write.apply(this,arguments):this.loadRomBank(e,49152)},A[180].prototype.loadROM=function(){if(!this.nes.rom.valid)throw new Error("Mapper 180: Invalid ROM! Unable to load.");this.loadRomBank(0,32768),this.loadRomBank(this.nes.rom.romCount-1,49152),this.loadCHRROM(),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)};var C=function(t){this.nes=t,this.mapperName=new Array(92);for(var e=0;e<92;e++)this.mapperName[e]="Unknown Mapper";this.mapperName[0]="Direct Access",this.mapperName[1]="Nintendo MMC1",this.mapperName[2]="UNROM",this.mapperName[3]="CNROM",this.mapperName[4]="Nintendo MMC3",this.mapperName[5]="Nintendo MMC5",this.mapperName[6]="FFE F4xxx",this.mapperName[7]="AOROM",this.mapperName[8]="FFE F3xxx",this.mapperName[9]="Nintendo MMC2",this.mapperName[10]="Nintendo MMC4",this.mapperName[11]="Color Dreams Chip",this.mapperName[12]="FFE F6xxx",this.mapperName[15]="100-in-1 switch",this.mapperName[16]="Bandai chip",this.mapperName[17]="FFE F8xxx",this.mapperName[18]="Jaleco SS8806 chip",this.mapperName[19]="Namcot 106 chip",this.mapperName[20]="Famicom Disk System",this.mapperName[21]="Konami VRC4a",this.mapperName[22]="Konami VRC2a",this.mapperName[23]="Konami VRC2a",this.mapperName[24]="Konami VRC6",this.mapperName[25]="Konami VRC4b",this.mapperName[32]="Irem G-101 chip",this.mapperName[33]="Taito TC0190/TC0350",this.mapperName[34]="32kB ROM switch",this.mapperName[64]="Tengen RAMBO-1 chip",this.mapperName[65]="Irem H-3001 chip",this.mapperName[66]="GNROM switch",this.mapperName[67]="SunSoft3 chip",this.mapperName[68]="SunSoft4 chip",this.mapperName[69]="SunSoft5 FME-7 chip",this.mapperName[71]="Camerica chip",this.mapperName[78]="Irem 74HC161/32-based",this.mapperName[91]="Pirate HK-SF3 chip"};C.prototype={VERTICAL_MIRRORING:0,HORIZONTAL_MIRRORING:1,FOURSCREEN_MIRRORING:2,SINGLESCREEN_MIRRORING:3,SINGLESCREEN_MIRRORING2:4,SINGLESCREEN_MIRRORING3:5,SINGLESCREEN_MIRRORING4:6,CHRROM_MIRRORING:7,header:null,rom:null,vrom:null,vromTile:null,romCount:null,vromCount:null,mirroring:null,batteryRam:null,trainer:null,fourScreen:null,mapperType:null,valid:!1,load:function(t){var e,i,s;if(-1===t.indexOf("NES"))throw new Error("Not a valid NES ROM.");for(this.header=new Array(16),e=0;e<16;e++)this.header[e]=255&t.charCodeAt(e);this.romCount=this.header[4],this.vromCount=2*this.header[5],this.mirroring=0!==(1&this.header[6])?1:0,this.batteryRam=0!==(2&this.header[6]),this.trainer=0!==(4&this.header[6]),this.fourScreen=0!==(8&this.header[6]),this.mapperType=this.header[6]>>4|240&this.header[7];var r=!1;for(e=8;e<16;e++)if(0!==this.header[e]){r=!0;break}r&&(this.mapperType&=15),this.rom=new Array(this.romCount);var a,n,h=16;for(e=0;e<this.romCount;e++){for(this.rom[e]=new Array(16384),i=0;i<16384;i++){if(h+i>=t.length)break;this.rom[e][i]=255&t.charCodeAt(h+i)}h+=16384}for(this.vrom=new Array(this.vromCount),e=0;e<this.vromCount;e++){for(this.vrom[e]=new Array(4096),i=0;i<4096;i++){if(h+i>=t.length)break;this.vrom[e][i]=255&t.charCodeAt(h+i)}h+=4096}for(this.vromTile=new Array(this.vromCount),e=0;e<this.vromCount;e++)for(this.vromTile[e]=new Array(256),i=0;i<256;i++)this.vromTile[e][i]=new c;for(s=0;s<this.vromCount;s++)for(e=0;e<4096;e++)a=e>>4,n=e%16,n<8?this.vromTile[s][a].setScanline(n,this.vrom[s][e],this.vrom[s][e+8]):this.vromTile[s][a].setScanline(n-8,this.vrom[s][e-8],this.vrom[s][e]);this.valid=!0},getMirroringType:function(){return this.fourScreen?this.FOURSCREEN_MIRRORING:0===this.mirroring?this.HORIZONTAL_MIRRORING:this.VERTICAL_MIRRORING},getMapperName:function(){return this.mapperType>=0&&this.mapperType<this.mapperName.length?this.mapperName[this.mapperType]:"Unknown Mapper, "+this.mapperType},mapperSupported:function(){return"undefined"!==typeof A[this.mapperType]},createMapper:function(){if(this.mapperSupported())return new A[this.mapperType](this.nes);throw new Error("This ROM uses a mapper not supported by JSNES: "+this.getMapperName()+"("+this.mapperType+")")}};var D=function(t){var e;if(this.opts={onFrame:function(){},onAudioSample:null,onStatusUpdate:function(t){},onBatteryRamWrite:function(){},preferredFrameRate:60,emulateSound:!0,sampleRate:48e3},"undefined"!==typeof t)for(e in this.opts)"undefined"!==typeof t[e]&&(this.opts[e]=t[e]);this.frameTime=1e3/this.opts.preferredFrameRate,this.ui={writeFrame:this.opts.onFrame,updateStatus:this.opts.onStatusUpdate},this.cpu=new l(this),this.ppu=new p(this),this.papu=new f(this),this.mmap=null,this.controllers={1:new h,2:new h},this.ui.updateStatus("Ready to load a ROM."),this.frame=this.frame.bind(this),this.buttonDown=this.buttonDown.bind(this),this.buttonUp=this.buttonUp.bind(this),this.zapperMove=this.zapperMove.bind(this),this.zapperFireDown=this.zapperFireDown.bind(this),this.zapperFireUp=this.zapperFireUp.bind(this)};D.prototype={fpsFrameCount:0,romData:null,break:!1,stop:function(){this.break=!0},reset:function(){null!==this.mmap&&this.mmap.reset(),this.cpu.reset(),this.ppu.reset(),this.papu.reset(),this.lastFpsTime=null,this.fpsFrameCount=0,this.break=!1},frame:function(){this.ppu.startFrame();var t=0,e=this.opts.emulateSound,i=this.cpu,s=this.ppu,r=this.papu;t:for(;;){if(this.break)break;for(0===i.cyclesToHalt?(t=i.emulate(),e&&r.clockFrameCounter(t),t*=3):i.cyclesToHalt>8?(t=24,e&&r.clockFrameCounter(8),i.cyclesToHalt-=8):(t=3*i.cyclesToHalt,e&&r.clockFrameCounter(i.cyclesToHalt),i.cyclesToHalt=0);t>0;t--){if(s.curX===s.spr0HitX&&1===s.f_spVisibility&&s.scanline-21===s.spr0HitY&&s.setStatusFlag(s.STATUS_SPRITE0HIT,!0),s.requestEndFrame&&(s.nmiCounter--,0===s.nmiCounter)){s.requestEndFrame=!1,s.startVBlank();break t}s.curX++,341===s.curX&&(s.curX=0,s.endScanline())}}this.fpsFrameCount++},buttonDown:function(t,e){this.controllers[t].buttonDown(e)},buttonUp:function(t,e){this.controllers[t].buttonUp(e)},zapperMove:function(t,e){this.mmap&&(this.mmap.zapperX=t,this.mmap.zapperY=e)},zapperFireDown:function(){this.mmap&&(this.mmap.zapperFired=!0)},zapperFireUp:function(){this.mmap&&(this.mmap.zapperFired=!1)},getFPS:function(){var t=+new Date,e=null;return this.lastFpsTime&&(e=this.fpsFrameCount/((t-this.lastFpsTime)/1e3)),this.fpsFrameCount=0,this.lastFpsTime=t,e},reloadROM:function(){null!==this.romData&&this.loadROM(this.romData)},loadROM:function(t){this.rom=new C(this),this.rom.load(t),this.reset(),this.mmap=this.rom.createMapper(),this.mmap.loadROM(),this.ppu.setMirroring(this.rom.getMirroringType()),this.romData=t},setFramerate:function(t){this.opts.preferredFrameRate=t,this.frameTime=1e3/t,this.papu.setSampleRate(this.opts.sampleRate,!1)},toJSON:function(){return{cpu:this.cpu.toJSON(),mmap:this.mmap.toJSON(),ppu:this.ppu.toJSON(),papu:this.papu.toJSON()}},fromJSON:function(t){this.reset(),this.cpu.fromJSON(t.cpu),this.mmap.fromJSON(t.mmap),this.ppu.fromJSON(t.ppu),this.papu.fromJSON(t.papu)}};var w,v,y,N,I={Controller:h,NES:D},T={},E=256,k=240,O=E*k,M=512,F=4096,L=F-1,P=new Float32Array(F),x=new Float32Array(F),B=0,G=0,V=new I.NES({onFrame:function(t){for(var e=0;e<O;e++)N[e]=4278190080|t[e]},onAudioSample:function(t,e){P[B]=t,x[B]=e,B=B+1&L}});function U(){V.ui.updateStatus(parseInt(V.getFPS())),window.requestAnimationFrame(U),v.data.set(y),w.putImageData(v,0,0)}function q(){return B-G&L}function X(t){if(null!=V.rom){var e=t.outputBuffer,i=e.length;q()<M&&V.frame();for(var s=e.getChannelData(0),r=e.getChannelData(1),a=0;a<i;a++){var n=G+a&L;s[a]=P[n],r[a]=x[n]}G=G+i&L}}T.nes=V;var Z={BUTTON_A:222,BUTTON_B:186,BUTTON_SELECT:32,BUTTON_START:13,BUTTON_UP:87,BUTTON_DOWN:83,BUTTON_LEFT:65,BUTTON_RIGHT:68},Y={BUTTON_A:97,BUTTON_B:98,BUTTON_SELECT:100,BUTTON_START:101,BUTTON_UP:38,BUTTON_DOWN:40,BUTTON_LEFT:37,BUTTON_RIGHT:39},z={reSet:80,PauseAndStart:82,save:66,load:77};function H(t,e){var i=1,s=2;switch(e.keyCode){case Z.BUTTON_A:t(i,I.Controller.BUTTON_A);break;case Z.BUTTON_B:t(i,I.Controller.BUTTON_B);break;case Z.BUTTON_SELECT:t(i,I.Controller.BUTTON_SELECT);break;case Z.BUTTON_START:t(i,I.Controller.BUTTON_START);break;case Z.BUTTON_UP:t(i,I.Controller.BUTTON_UP);break;case Z.BUTTON_DOWN:t(i,I.Controller.BUTTON_DOWN);break;case Z.BUTTON_LEFT:t(i,I.Controller.BUTTON_LEFT);break;case Z.BUTTON_RIGHT:t(i,I.Controller.BUTTON_RIGHT);break;case Y.BUTTON_A:t(s,I.Controller.BUTTON_A);break;case Y.BUTTON_B:t(s,I.Controller.BUTTON_B);break;case Y.BUTTON_SELECT:t(s,I.Controller.BUTTON_SELECT);break;case Y.BUTTON_START:t(s,I.Controller.BUTTON_START);break;case Y.BUTTON_UP:t(s,I.Controller.BUTTON_UP);break;case Y.BUTTON_DOWN:t(s,I.Controller.BUTTON_DOWN);break;case Y.BUTTON_LEFT:t(s,I.Controller.BUTTON_LEFT);break;case Y.BUTTON_RIGHT:t(s,I.Controller.BUTTON_RIGHT);break;case z.reSet:"keydown"===e.type&&Q();break;case z.PauseAndStart:"keydown"===e.type&&j();break;case z.save:T.$vm&&T.$vm.savePako(),e.stopPropagation(),e.preventDefault();break;case z.load:T.$vm&&T.$vm.loadPako(),e.stopPropagation(),e.preventDefault();break;default:return!0}}function W(t){var e=document.getElementById(t);w=e.getContext("2d"),v=w.getImageData(0,0,E,k),w.fillStyle="black",w.fillRect(0,0,E,k);var i=new ArrayBuffer(v.data.length);if(y=new Uint8ClampedArray(i),N=new Uint32Array(i),!T.alerdSet){T.alerdSet=!0;var s,r=window.AudioContext||window.webkitAudioContext||!1;r?s=new r({sampleRate:V.papu.sampleRate}):console.error("错误"),s.resume();var a=s.createScriptProcessor(M,0,2);a["onaudioprocess"]=X,a.connect(s.destination),T.audio_ctx=s}T.screen=$(e)}function J(t){V.loadROM(t),window.requestAnimationFrame(U)}function K(t,e){W(t);var i=new XMLHttpRequest;i.open("GET",e),i.overrideMimeType("text/plain; charset=x-user-defined"),i.onerror=function(){return console.log("Error loading ".concat(e,": ").concat(i.statusText))},i.onload=function(){200===this.status?J(this.responseText):0===this.status||i.onerror()},i.send()}function j(){"running"===T.audio_ctx.state?T.audio_ctx.suspend():"suspended"===T.audio_ctx.state&&T.audio_ctx.resume()}function Q(){T.nes.reloadROM()}function tt(){if(V.romData){var t=V.toJSON(),e=JSON.stringify(t);return e}return null}function et(t){var e=JSON.parse(t);V.fromJSON(e)}!function(){var t=localStorage.getItem("player1Set");Z=null!=t&&t?JSON.parse(t):Z;var e=localStorage.getItem("player2Set");Y=null!=e&&e?JSON.parse(e):Y;var i=localStorage.getItem("nesSet");z=null!=i&&i?JSON.parse(i):z}(),T.player1Set=Z,T.player2Set=Y,T.nesSet=z,T.saveThisKeyMap=function(){localStorage.setItem("player1Set",JSON.stringify(Z)),localStorage.setItem("player2Set",JSON.stringify(Y)),localStorage.setItem("nesSet",JSON.stringify(z))},T.nes_load_url=K,T.alerdSet=!1,document.addEventListener("keydown",(function(t){H(V.buttonDown,t)})),document.addEventListener("keyup",(function(t){H(V.buttonUp,t)})),T.saveState=tt,T.loadState=et;var it={"最爱":[["快打旋风","roms/1981/kuaidaxuanfeng.nes"],["炸弹人1 (J) Bomberman [!]","roms/rom1/(J) Bomberman [!].nes"],["忍者","roms/1981//ninja.nes"],["激龟快打","roms/1981/HeroTurtles.nes"],["炸弹人2","roms/1981/boomman.nes"],["雪人兄弟","roms/1981/Snow Bros. (J).nes"],["冒险岛4","roms/1981/maoxiandao.nes"],["加纳战机","roms/1981/Gun-Nac.nes"],["三目童子","roms/1981/sanmotz.nes"],["魂斗罗1(U)30S","roms/Contra/Contra1(U)30S.nes"],["超级马里奥1 (W) Super Mario Bros. [!]","roms/rom1/(W) Super Mario Bros. [!].nes"],["双截龙2 Double Dragon2","roms/Double Dragon/Double Dragon2.nes"]],"魂斗罗":[["魂斗罗1(U)30","roms/Contra/Contra1(U)30.nes"],["魂斗罗1(U)30F","roms/Contra/Contra1(U)30F.nes"],["魂斗罗1(U)30L","roms/Contra/Contra1(U)30L.nes"],["魂斗罗1(U)30M","roms/Contra/Contra1(U)30M.nes"],["魂斗罗1(U)F","roms/Contra/Contra1(U)F.nes"],["魂斗罗1(U)L","roms/Contra/Contra1(U)L.nes"],["魂斗罗1(U)M","roms/Contra/Contra1(U)M.nes"],["魂斗罗1(U)S","roms/Contra/Contra1(U)S.nes"]],"超级玛丽":[["超级马里奥3 (W) Super Mario Bros. 3 (U)","roms/bfirsh/Super Mario Bros. 3 (U) (PRG1) [!].nes"],["马里奥拆屋工 (W) Wrecking Crew [!]","roms/rom1/(W) Wrecking Crew [!].nes"],["马里奥医生 Dr. Mario (JU)","roms/bfirsh/Dr. Mario (JU).nes"]],"双截龙":[["双截龙1 Double Dragon1","roms/Double Dragon/Double Dragon1.nes"],["双截龙3 Double Dragon3","roms/Double Dragon/Double Dragon3.nes"],["双截龙4 Double Dragon4","roms/Double Dragon/Double Dragon4.nes"]],"俄罗斯方块":[["俄罗斯方块LJ65","roms/lj65/lj65.nes"],["俄罗斯方块Tetris(U)","roms/other/Tetris (U) [!].nes"],["俄罗斯方块Tetris 2(U)","roms/other/Tetris 2 (U) [!].nes"]],"坦克":[["坦克 (Ch) Missile Tank","roms/rom1/(Ch) Missile Tank.nes"],["坦克 (Ch) Tank 1990","roms/rom1/(Ch) Tank 1990.nes"],["坦克 (J) Battle City","roms/rom1/(J) Battle City.nes"]],"经典":[["赤影战士 Kage","roms/other/Kage.nes"],["中国象棋","roms/other/Zhong Guo Xiang Qi.nes"],["吃豆精灵 (J) (V1.1) Pac-Man [!]","roms/other/Pac-Man.nes"],["摩托车大赛 (J) (PRG1) Mach Rider [!]","roms/other/Mach Rider.nes"],["沙罗曼蛇 (U) Life Force","roms/rom2/Life Force [!].nes"],["1943 (U) 1943 - The Battle of Midway","roms/rom2/1943.nes"],["脱狱 Cross Fire (J)","roms/rom2/Cross Fire (J).nes"],["撞球咖啡馆 Shufflepuck Cafe","roms/rom2/Shufflepuck Cafe.nes"],["功夫 (J) (V1.2) Yie Ar Kung-Fu [!]","roms/rom1/(J) (V1.2) Yie Ar Kung-Fu [!].nes"]],"淘金者":[["淘金者(汉化)","roms/rom1/TaoJinZhe.nes"],["淘金者(J)","roms/rom1/Championship Lode Runner (J).nes"]],"赛车":[["F1赛车 (J) F-1 Race [!]","roms/rom1/(J) F-1 Race [!].nes"],["摩托车大赛 (JU) (PRG0) Mach Rider [!]","roms/rom1/(JU) (PRG0) Mach Rider [!].nes"],["越野机车 (JU) Excitebike [!]","roms/rom1/(JU) Excitebike [!].nes"],["火箭车 (J) Road Fighter [!]","roms/rom1/(J) Road Fighter [!].nes"]],"其它":[["泡泡 Bubble Bobble (U)","roms/bfirsh/Bubble Bobble (U).nes"],["Concentration Room","roms/croom/croom.nes"],["网球Tennis(JU)","roms/other/Tennis (JU) [!].nes"],["高尔夫 Golf (JU)","roms/bfirsh/Golf (JU).nes"],["Zelda II - The Adventure of Link(U)","roms/other/Zelda II - The Adventure of Link (U).nes"],["地底探险1 (J) Spelunker [!]","roms/rom1/(J) Spelunker [!].nes"],["快乐猫 (J) Mappy [!]","roms/rom1/(J) Mappy [!].nes"],["成龙踢馆1 (J) Spartan X [!]","roms/rom1/(J) Spartan X [!].nes"],["敲冰块 (J) Ice Climber","roms/rom1/(J) Ice Climber.nes"],["猪小弟 (J) Pooyan","roms/rom1/(J) Pooyan.nes"],["马戏团 (J) Circus Charlie [!]","roms/rom1/(J) Circus Charlie [!].nes"]],keyMap:{8:"Backspace",9:"Tab",13:"Enter",16:"ShiftLeft",17:"ControlLeft",18:"AltLeft",19:"Pause",20:"CapsLock",27:"Escape",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",48:"Digit0",49:"Digit1",50:"Digit2",51:"Digit3",52:"Digit4",53:"Digit5",54:"Digit6",55:"Digit7",56:"Digit8",57:"Digit9",65:"KeyA",66:"KeyB",67:"KeyC",68:"KeyD",69:"KeyE",70:"KeyF",71:"KeyG",72:"KeyH",73:"KeyI",74:"KeyJ",75:"KeyK",76:"KeyL",77:"KeyM",78:"KeyN",79:"KeyO",80:"KeyP",81:"KeyQ",82:"KeyR",83:"KeyS",84:"KeyT",85:"KeyU",86:"KeyV",87:"KeyW",88:"KeyX",89:"KeyY",90:"KeyZ",91:"MetaLeft",93:"ContextMenu",96:"Numpad0",97:"Numpad1",98:"Numpad2",99:"Numpad3",100:"Numpad4",101:"Numpad5",102:"Numpad6",103:"Numpad7",104:"Numpad8",105:"Numpad9",106:"NumpadMultiply",107:"NumpadAdd",109:"NumpadSubtract",110:"NumpadDecimal",111:"NumpadDivide",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",186:"Semicolon",187:"Equal",188:"Comma",189:"Minus",190:"Period",191:"Slash",192:"Backquote",219:"BracketLeft",220:"Backslash",221:"BracketRight",222:"Quote"}};i("a4d3"),i("e01a"),i("d28b");function st(t){return st="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},st(t)}var rt,at={},nt=window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.requestAnimationFrame,ht=window.mozCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.cancelRequestAnimationFrame;if(window.addEventListener("gamepadconnected",(function(){var t=navigator.getGamepads()[0];at.innerHTML="Gamepad connected at index "+t.index+": "+t.id+". It has "+t.buttons.length+" buttons and "+t.axes.length+" axes.",St()})),window.addEventListener("gamepaddisconnected",(function(){at.innerHTML="Waiting for gamepad.",ht(rt)})),!("GamepadEvent"in window))var ot=setInterval(lt,100);function lt(){for(var t=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[],e=0;e<t.length;e++){var i=t[e];i&&(at.innerHTML="Gamepad connected at index "+i.index+": "+i.id+". It has "+i.buttons.length+" buttons and "+i.axes.length+" axes.",St(),clearInterval(ot))}}function ut(t){return"object"==st(t)?t.pressed&&t.touched:1==t}var ct={KEY_A:0,KEY_B:1,KEY_SELECT:2,KEY_START:3,KEY_UP:4,KEY_DOWN:5,KEY_LEFT:6,KEY_RIGHT:7},pt=0,dt=2,mt=1,_t=3,ft={12:"KEY_UP",13:"KEY_DOWN",14:"KEY_LEFT",15:"KEY_RIGHT",8:"KEY_SELECT",9:"KEY_START"};ft[pt]="KEY_A",ft[dt]="KEY_B",ft[mt]="KEY_AA",ft[_t]="KEY_BB",function(){var t=localStorage.getItem("kesPad");ft=null!=t&&t?JSON.parse(t):ft}();var Rt,gt=[];function St(){var t=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[];if(t){for(var e=t[0],i=0;i<e.axes.length;i++){var s=e.axes[i];-1===s&&console.log("-1位于".concat(i)),1===s&&console.log("1位于".concat(i))}for(i=0;i<e.buttons.length;i++)if(ut(e.buttons[i]))-1===gt.indexOf(i)&&(console.log("按下了".concat(ft[i])),Rt=i,void 0!==canSet&&(Ct.setGamePad(canSetValue),window.setGamePadCall(Rt)),T.nes.buttonDown(1,ct[ft[i]]),gt[gt.length]=i),i===mt&&bt(0),i===_t&&bt(1);else{var r=gt.indexOf(i);r>-1&&(console.log("抬起了".concat(ft[i])),T.nes.buttonUp(1,ct[ft[i]]),i===mt&&T.nes.buttonUp(1,0),i===_t&&T.nes.buttonUp(1,1),delete gt[r])}nt(St)}}function bt(t){return At.apply(this,arguments)}function At(){return At=n(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:T.nes.buttonDown(1,e),setTimeout((function(){T.nes.buttonUp(1,e)}),10);case 2:case"end":return t.stop()}}),t)}))),At.apply(this,arguments)}window.canSet=void 0,window.canSetValue=void 0;var Ct={kesPad:ft,saveKesPadSet:function(){localStorage.setItem("kesPad",JSON.stringify(ft))},setGamePad:function(t,e){ft[Rt]=t}},Dt=i("21a6"),wt=i("acff"),vt={name:"Nes",components:{},data:function(){return{canWidth:"256px",canHeigh:"240px",toggRange:1.5,labSpan:6,inputSpan:14,fileMulti:!1,trueFlag:!0,falseFlag:!1,fileAcc:"data",keyMap:{},gamePadSet:[],player1Set:[],player2Set:[],cb1:4,cb3:7,zj:12,cb2:1,fps:0,activeName:"p1",value:"",label:"存档",options:[{label:"热门城市",options:[{value:"Shanghai",label:"上海"}]},{}]}},created:function(){var t=this;this.setOption(),this.setPadKey(),this.keyMap=it.keyMap,T.alreadyLoadRom&&(this.value=T.alreadyLoadRom),this.$nextTick((function(){t.setFc()}))},beforeRouteLeave:function(t,e,i){T.audio_ctx&&T.audio_ctx.suspend(),i()},methods:{setFc:function(){T.audio_ctx&&T.audio_ctx.resume(),T.alreadyLoad?T.nes_load_url("nes-canvas",T.alreadyLoad):(T.nes_load_url("nes-canvas","../../roms/Contra/Contra1(U)30.nes"),this.value="roms/Contra/Contra1(U)30.nes");var t=0,e=this;T.nes.ui.updateStatus=function(){var i=n(regeneratorRuntime.mark((function i(s){var r;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(r=(new Date).getTime(),!(r-t<300)){i.next=3;break}return i.abrupt("return");case 3:t=r,e.fps=s;case 5:case"end":return i.stop()}}),i)})));return function(t){return i.apply(this,arguments)}}(),T.screen.animate({width:"".concat(512*this.toggRange,"px"),height:"".concat(480*this.toggRange,"px")},0),T.$vm=this,setTimeout((function(){T.audio_ctx.suspend()}),1e3)},setPadKey:function(){var t=Ct.kesPad;for(var e in t){var i={label:t[e],key:e};this.gamePadSet[this.gamePadSet.length]=i}var s=T.player1Set;for(var r in s){var a={label:r,key:s[r]};this.player1Set[this.player1Set.length]=a}var n=T.player2Set;for(var h in n){var o={label:h,key:n[h]};this.player2Set[this.player2Set.length]=o}},setOption:function(){var t=[];for(var e in it){var i={};if("keyMap"!==e){var s=it[e];i.label=e,i.options=[];for(var r=0;r<s.length;r++){var a=s[r];i.options[i.options.length]={value:a[1],label:a[0]}}}t[t.length]=i}this.options=t},changeGame:function(t){T.audio_ctx.resume(),T.alreadyLoad="../../".concat(t),T.alreadyLoadRom=t;var e=new XMLHttpRequest;e.open("GET","../../".concat(t)),e.overrideMimeType("text/plain; charset=x-user-defined"),e.onerror=function(){return console.log("Error loading ".concat(data.value,": ").concat(e.statusText))},e.onload=function(){200===this.status?T.nes.loadROM(this.responseText):0===this.status||e.onerror()},e.send()},getOptionLabel:function(t,e){if(e.value!==t)if(e.options)for(var i=0;i<e.options.length;i++)this.getOptionLabel(t,e.options[i]);else for(var s=0;s<e.length;s++)this.getOptionLabel(t,e[s]);else this.label=e.label},showSaveData:function(){var t=0;if(window.localStorage)for(var e in window.localStorage)window.localStorage.hasOwnProperty(e)&&(t+=window.localStorage.getItem(e).length);this.$message("存储占用量--\x3e".concat((t/1024/1024).toFixed(2),"M"))},save:function(t){var e=this;t=t||this.value||123;var i=T.saveState();null==i?this.$notify.success("无数据！"):(localStorage.setItem(t,i),this.$notify.success("保存成功key--\x3e".concat(t)),this.$nextTick((function(){e.showSaveData()})))},load:function(t){T.audio_ctx.resume(),t=t||this.value||123;var e=localStorage.getItem(t);e&&(T.loadState(e),this.$notify.success("加载成功key--\x3e".concat(t)))},savePako:function(t){var e=this;t=t||this.value||123;var i=T.saveState();null==i?this.$notify.success("无数据！"):setTimeout((function(){i=wt.gzip(i,{to:"string"}),localStorage.setItem(t,i),e.$notify.success("保存成功key--\x3e".concat(t)),e.$nextTick((function(){e.showSaveData()}))}))},loadPako:function(t){t=t||this.value||123;var e=localStorage.getItem(t);if(e){var i=e.split(",");e=Uint8Array.from(i),e=wt.ungzip(e,{to:"string"}),T.loadState(e),this.$notify.success("加载成功key--\x3e".concat(t))}},exportArchive:function(t){var e=this;t=t||this.value||123,T.audio_ctx.suspend(),this.getOptionLabel(t,this.options);var i=T.saveState();null==i?this.$notify.success("无数据！"):setTimeout((function(){if(i=wt.gzip(i,{to:"string"}),localStorage.setItem(t,i),Dt["saveAs"]){var s=new Blob([t,",",i.toString()],{type:"text/plain;charset=utf-8"});Object(Dt["saveAs"])(s,e.label+".data")}else e.funDownload([t,",",i.toString()],e.label+".data")}))},funDownload:function(t,e){var i=document.createElement("a");i.download=e,i.style.display="none";var s=new Blob([t]);i.href=URL.createObjectURL(s),document.body.appendChild(i),i.click(),document.body.removeChild(i),this.$message.success("成功")},fileSuccess:function(t,e,i){},fileUpload:function(t){T.audio_ctx.resume(),this.readText(t)},fileUpload2:function(t){T.audio_ctx.resume(),this.readBinary(t)},readText:function(){var t=n(regeneratorRuntime.mark((function t(e){var i,s=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:i=new FileReader,i.onload=function(t){var i=t.target.result,r=i.split(","),a=r.shift();localStorage.setItem(a,r.join(",")),s.changeGame(a),s.value=a,setTimeout((function(){r=Uint8Array.from(r),r=wt.ungzip(r,{to:"string"}),T.loadState(r)}),300),e.onSuccess()},i.readAsText(e.file);case 3:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}(),readBinary:function(){var t=n(regeneratorRuntime.mark((function t(e){var i,s=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:i=new FileReader,i.onload=function(t){var i=t.target.result;T.audio_ctx.resume();try{T.nes.loadROM(i)}catch(t){T.audio_ctx.suspend(),s.$message.error(t.message)}e.onSuccess()},i.readAsBinaryString(e.file);case 3:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}(),initContenMenu:function(){var t=this;this.$contextmenu({items:[{label:"保存游戏",disabled:!1,onClick:function(){t.savePako()}},{label:"加载存档",disabled:!1,onClick:function(){t.loadPako()}},{label:"导出存档",disabled:!1,onClick:function(){t.exportArchive()}},{label:"暂停",disabled:!1,onClick:function(){"running"===T.audio_ctx.state&&T.audio_ctx.suspend()}},{label:"开始",disabled:!1,onClick:function(){"suspended"===T.audio_ctx.state&&T.audio_ctx.resume()}},{label:"重置",disabled:!1,onClick:function(){"suspended"===T.audio_ctx.state&&T.audio_ctx.resume(),T.nes.reloadROM()}}],event:event,zIndex:3,minWidth:140}),event.preventDefault()}}},yt=vt,Nt=i("2877"),It=Object(Nt["a"])(yt,s,r,!1,null,"a249ecdc",null);e["default"]=It.exports},"21a6":function(t,e,i){(function(i){var s,r,a;(function(i,n){r=[],s=n,a="function"===typeof s?s.apply(e,r):s,void 0===a||(t.exports=a)})(0,(function(){"use strict";function e(t,e){return"undefined"==typeof e?e={autoBom:!1}:"object"!=typeof e&&(console.warn("Deprecated: Expected third argument to be a object"),e={autoBom:!e}),e.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob(["\ufeff",t],{type:t.type}):t}function s(t,e,i){var s=new XMLHttpRequest;s.open("GET",t),s.responseType="blob",s.onload=function(){o(s.response,e,i)},s.onerror=function(){console.error("could not download file")},s.send()}function r(t){var e=new XMLHttpRequest;e.open("HEAD",t,!1);try{e.send()}catch(t){}return 200<=e.status&&299>=e.status}function a(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(s){var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(e)}}var n="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof i&&i.global===i?i:void 0,h=n.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),o=n.saveAs||("object"!=typeof window||window!==n?function(){}:"download"in HTMLAnchorElement.prototype&&!h?function(t,e,i){var h=n.URL||n.webkitURL,o=document.createElement("a");e=e||t.name||"download",o.download=e,o.rel="noopener","string"==typeof t?(o.href=t,o.origin===location.origin?a(o):r(o.href)?s(t,e,i):a(o,o.target="_blank")):(o.href=h.createObjectURL(t),setTimeout((function(){h.revokeObjectURL(o.href)}),4e4),setTimeout((function(){a(o)}),0))}:"msSaveOrOpenBlob"in navigator?function(t,i,n){if(i=i||t.name||"download","string"!=typeof t)navigator.msSaveOrOpenBlob(e(t,n),i);else if(r(t))s(t,i,n);else{var h=document.createElement("a");h.href=t,h.target="_blank",setTimeout((function(){a(h)}))}}:function(t,e,i,r){if(r=r||open("","_blank"),r&&(r.document.title=r.document.body.innerText="downloading..."),"string"==typeof t)return s(t,e,i);var a="application/octet-stream"===t.type,o=/constructor/i.test(n.HTMLElement)||n.safari,l=/CriOS\/[\d]+/.test(navigator.userAgent);if((l||a&&o||h)&&"undefined"!=typeof FileReader){var u=new FileReader;u.onloadend=function(){var t=u.result;t=l?t:t.replace(/^data:[^;]*;/,"data:attachment/file;"),r?r.location.href=t:location=t,r=null},u.readAsDataURL(t)}else{var c=n.URL||n.webkitURL,p=c.createObjectURL(t);r?r.location=p:location.href=p,r=null,setTimeout((function(){c.revokeObjectURL(p)}),4e4)}});n.saveAs=o.saveAs=o,t.exports=o}))}).call(this,i("c8ba"))},"96cf":function(t,e,i){var s=function(t){"use strict";var e,i=Object.prototype,s=i.hasOwnProperty,r="function"===typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",n=r.asyncIterator||"@@asyncIterator",h=r.toStringTag||"@@toStringTag";function o(t,e,i){return Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{o({},"")}catch(O){o=function(t,e,i){return t[e]=i}}function l(t,e,i,s){var r=e&&e.prototype instanceof f?e:f,a=Object.create(r.prototype),n=new T(s||[]);return a._invoke=v(t,i,n),a}function u(t,e,i){try{return{type:"normal",arg:t.call(e,i)}}catch(O){return{type:"throw",arg:O}}}t.wrap=l;var c="suspendedStart",p="suspendedYield",d="executing",m="completed",_={};function f(){}function R(){}function g(){}var S={};o(S,a,(function(){return this}));var b=Object.getPrototypeOf,A=b&&b(b(E([])));A&&A!==i&&s.call(A,a)&&(S=A);var C=g.prototype=f.prototype=Object.create(S);function D(t){["next","throw","return"].forEach((function(e){o(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){function i(r,a,n,h){var o=u(t[r],t,a);if("throw"!==o.type){var l=o.arg,c=l.value;return c&&"object"===typeof c&&s.call(c,"__await")?e.resolve(c.__await).then((function(t){i("next",t,n,h)}),(function(t){i("throw",t,n,h)})):e.resolve(c).then((function(t){l.value=t,n(l)}),(function(t){return i("throw",t,n,h)}))}h(o.arg)}var r;function a(t,s){function a(){return new e((function(e,r){i(t,s,e,r)}))}return r=r?r.then(a,a):a()}this._invoke=a}function v(t,e,i){var s=c;return function(r,a){if(s===d)throw new Error("Generator is already running");if(s===m){if("throw"===r)throw a;return k()}i.method=r,i.arg=a;while(1){var n=i.delegate;if(n){var h=y(n,i);if(h){if(h===_)continue;return h}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(s===c)throw s=m,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);s=d;var o=u(t,e,i);if("normal"===o.type){if(s=i.done?m:p,o.arg===_)continue;return{value:o.arg,done:i.done}}"throw"===o.type&&(s=m,i.method="throw",i.arg=o.arg)}}}function y(t,i){var s=t.iterator[i.method];if(s===e){if(i.delegate=null,"throw"===i.method){if(t.iterator["return"]&&(i.method="return",i.arg=e,y(t,i),"throw"===i.method))return _;i.method="throw",i.arg=new TypeError("The iterator does not provide a 'throw' method")}return _}var r=u(s,t.iterator,i.arg);if("throw"===r.type)return i.method="throw",i.arg=r.arg,i.delegate=null,_;var a=r.arg;return a?a.done?(i[t.resultName]=a.value,i.next=t.nextLoc,"return"!==i.method&&(i.method="next",i.arg=e),i.delegate=null,_):a:(i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,_)}function N(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(N,this),this.reset(!0)}function E(t){if(t){var i=t[a];if(i)return i.call(t);if("function"===typeof t.next)return t;if(!isNaN(t.length)){var r=-1,n=function i(){while(++r<t.length)if(s.call(t,r))return i.value=t[r],i.done=!1,i;return i.value=e,i.done=!0,i};return n.next=n}}return{next:k}}function k(){return{value:e,done:!0}}return R.prototype=g,o(C,"constructor",g),o(g,"constructor",R),R.displayName=o(g,h,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"===typeof t&&t.constructor;return!!e&&(e===R||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,o(t,h,"GeneratorFunction")),t.prototype=Object.create(C),t},t.awrap=function(t){return{__await:t}},D(w.prototype),o(w.prototype,n,(function(){return this})),t.AsyncIterator=w,t.async=function(e,i,s,r,a){void 0===a&&(a=Promise);var n=new w(l(e,i,s,r),a);return t.isGeneratorFunction(i)?n:n.next().then((function(t){return t.done?t.value:n.next()}))},D(C),o(C,h,"Generator"),o(C,a,(function(){return this})),o(C,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var i in t)e.push(i);return e.reverse(),function i(){while(e.length){var s=e.pop();if(s in t)return i.value=s,i.done=!1,i}return i.done=!0,i}},t.values=E,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(I),!t)for(var i in this)"t"===i.charAt(0)&&s.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0],e=t.completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var i=this;function r(s,r){return h.type="throw",h.arg=t,i.next=s,r&&(i.method="next",i.arg=e),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var n=this.tryEntries[a],h=n.completion;if("root"===n.tryLoc)return r("end");if(n.tryLoc<=this.prev){var o=s.call(n,"catchLoc"),l=s.call(n,"finallyLoc");if(o&&l){if(this.prev<n.catchLoc)return r(n.catchLoc,!0);if(this.prev<n.finallyLoc)return r(n.finallyLoc)}else if(o){if(this.prev<n.catchLoc)return r(n.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return r(n.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&s.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var n=a?a.completion:{};return n.type=t,n.arg=e,a?(this.method="next",this.next=a.finallyLoc,_):this.complete(n)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),_},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),I(i),_}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.tryLoc===t){var s=i.completion;if("throw"===s.type){var r=s.arg;I(i)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,i,s){return this.delegate={iterator:E(t),resultName:i,nextLoc:s},"next"===this.method&&(this.arg=e),_}},t}(t.exports);try{regeneratorRuntime=s}catch(r){"object"===typeof globalThis?globalThis.regeneratorRuntime=s:Function("r","regeneratorRuntime = r")(s)}},acff:function(t,e,i){"use strict";i.r(e),i.d(e,"Deflate",(function(){return ta})),i.d(e,"Inflate",(function(){return ra})),i.d(e,"constants",(function(){return oa})),i.d(e,"default",(function(){return la})),i.d(e,"deflate",(function(){return ea})),i.d(e,"deflateRaw",(function(){return ia})),i.d(e,"gzip",(function(){return sa})),i.d(e,"inflate",(function(){return aa})),i.d(e,"inflateRaw",(function(){return na})),i.d(e,"ungzip",(function(){return ha}));
/*! pako 2.0.4 https://github.com/nodeca/pako @license (MIT AND Zlib) */
const s=4,r=0,a=1,n=2;function h(t){let e=t.length;while(--e>=0)t[e]=0}const o=0,l=1,u=2,c=3,p=258,d=29,m=256,_=m+1+d,f=30,R=19,g=2*_+1,S=15,b=16,A=7,C=256,D=16,w=17,v=18,y=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),N=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),I=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),T=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),E=512,k=new Array(2*(_+2));h(k);const O=new Array(2*f);h(O);const M=new Array(E);h(M);const F=new Array(p-c+1);h(F);const L=new Array(d);h(L);const P=new Array(f);function x(t,e,i,s,r){this.static_tree=t,this.extra_bits=e,this.extra_base=i,this.elems=s,this.max_length=r,this.has_stree=t&&t.length}let B,G,V;function U(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}h(P);const q=t=>t<256?M[t]:M[256+(t>>>7)],X=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},Z=(t,e,i)=>{t.bi_valid>b-i?(t.bi_buf|=e<<t.bi_valid&65535,X(t,t.bi_buf),t.bi_buf=e>>b-t.bi_valid,t.bi_valid+=i-b):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=i)},Y=(t,e,i)=>{Z(t,i[2*e],i[2*e+1])},z=(t,e)=>{let i=0;do{i|=1&t,t>>>=1,i<<=1}while(--e>0);return i>>>1},H=t=>{16===t.bi_valid?(X(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)},W=(t,e)=>{const i=e.dyn_tree,s=e.max_code,r=e.stat_desc.static_tree,a=e.stat_desc.has_stree,n=e.stat_desc.extra_bits,h=e.stat_desc.extra_base,o=e.stat_desc.max_length;let l,u,c,p,d,m,_=0;for(p=0;p<=S;p++)t.bl_count[p]=0;for(i[2*t.heap[t.heap_max]+1]=0,l=t.heap_max+1;l<g;l++)u=t.heap[l],p=i[2*i[2*u+1]+1]+1,p>o&&(p=o,_++),i[2*u+1]=p,u>s||(t.bl_count[p]++,d=0,u>=h&&(d=n[u-h]),m=i[2*u],t.opt_len+=m*(p+d),a&&(t.static_len+=m*(r[2*u+1]+d)));if(0!==_){do{p=o-1;while(0===t.bl_count[p])p--;t.bl_count[p]--,t.bl_count[p+1]+=2,t.bl_count[o]--,_-=2}while(_>0);for(p=o;0!==p;p--){u=t.bl_count[p];while(0!==u)c=t.heap[--l],c>s||(i[2*c+1]!==p&&(t.opt_len+=(p-i[2*c+1])*i[2*c],i[2*c+1]=p),u--)}}},J=(t,e,i)=>{const s=new Array(S+1);let r,a,n=0;for(r=1;r<=S;r++)s[r]=n=n+i[r-1]<<1;for(a=0;a<=e;a++){let e=t[2*a+1];0!==e&&(t[2*a]=z(s[e]++,e))}},K=()=>{let t,e,i,s,r;const a=new Array(S+1);for(i=0,s=0;s<d-1;s++)for(L[s]=i,t=0;t<1<<y[s];t++)F[i++]=s;for(F[i-1]=s,r=0,s=0;s<16;s++)for(P[s]=r,t=0;t<1<<N[s];t++)M[r++]=s;for(r>>=7;s<f;s++)for(P[s]=r<<7,t=0;t<1<<N[s]-7;t++)M[256+r++]=s;for(e=0;e<=S;e++)a[e]=0;t=0;while(t<=143)k[2*t+1]=8,t++,a[8]++;while(t<=255)k[2*t+1]=9,t++,a[9]++;while(t<=279)k[2*t+1]=7,t++,a[7]++;while(t<=287)k[2*t+1]=8,t++,a[8]++;for(J(k,_+1,a),t=0;t<f;t++)O[2*t+1]=5,O[2*t]=z(t,5);B=new x(k,y,m+1,_,S),G=new x(O,N,0,f,S),V=new x(new Array(0),I,0,R,A)},j=t=>{let e;for(e=0;e<_;e++)t.dyn_ltree[2*e]=0;for(e=0;e<f;e++)t.dyn_dtree[2*e]=0;for(e=0;e<R;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*C]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0},Q=t=>{t.bi_valid>8?X(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},$=(t,e,i,s)=>{Q(t),s&&(X(t,i),X(t,~i)),t.pending_buf.set(t.window.subarray(e,e+i),t.pending),t.pending+=i},tt=(t,e,i,s)=>{const r=2*e,a=2*i;return t[r]<t[a]||t[r]===t[a]&&s[e]<=s[i]},et=(t,e,i)=>{const s=t.heap[i];let r=i<<1;while(r<=t.heap_len){if(r<t.heap_len&&tt(e,t.heap[r+1],t.heap[r],t.depth)&&r++,tt(e,s,t.heap[r],t.depth))break;t.heap[i]=t.heap[r],i=r,r<<=1}t.heap[i]=s},it=(t,e,i)=>{let s,r,a,n,h=0;if(0!==t.last_lit)do{s=t.pending_buf[t.d_buf+2*h]<<8|t.pending_buf[t.d_buf+2*h+1],r=t.pending_buf[t.l_buf+h],h++,0===s?Y(t,r,e):(a=F[r],Y(t,a+m+1,e),n=y[a],0!==n&&(r-=L[a],Z(t,r,n)),s--,a=q(s),Y(t,a,i),n=N[a],0!==n&&(s-=P[a],Z(t,s,n)))}while(h<t.last_lit);Y(t,C,e)},st=(t,e)=>{const i=e.dyn_tree,s=e.stat_desc.static_tree,r=e.stat_desc.has_stree,a=e.stat_desc.elems;let n,h,o,l=-1;for(t.heap_len=0,t.heap_max=g,n=0;n<a;n++)0!==i[2*n]?(t.heap[++t.heap_len]=l=n,t.depth[n]=0):i[2*n+1]=0;while(t.heap_len<2)o=t.heap[++t.heap_len]=l<2?++l:0,i[2*o]=1,t.depth[o]=0,t.opt_len--,r&&(t.static_len-=s[2*o+1]);for(e.max_code=l,n=t.heap_len>>1;n>=1;n--)et(t,i,n);o=a;do{n=t.heap[1],t.heap[1]=t.heap[t.heap_len--],et(t,i,1),h=t.heap[1],t.heap[--t.heap_max]=n,t.heap[--t.heap_max]=h,i[2*o]=i[2*n]+i[2*h],t.depth[o]=(t.depth[n]>=t.depth[h]?t.depth[n]:t.depth[h])+1,i[2*n+1]=i[2*h+1]=o,t.heap[1]=o++,et(t,i,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],W(t,e),J(i,l,t.bl_count)},rt=(t,e,i)=>{let s,r,a=-1,n=e[1],h=0,o=7,l=4;for(0===n&&(o=138,l=3),e[2*(i+1)+1]=65535,s=0;s<=i;s++)r=n,n=e[2*(s+1)+1],++h<o&&r===n||(h<l?t.bl_tree[2*r]+=h:0!==r?(r!==a&&t.bl_tree[2*r]++,t.bl_tree[2*D]++):h<=10?t.bl_tree[2*w]++:t.bl_tree[2*v]++,h=0,a=r,0===n?(o=138,l=3):r===n?(o=6,l=3):(o=7,l=4))},at=(t,e,i)=>{let s,r,a=-1,n=e[1],h=0,o=7,l=4;for(0===n&&(o=138,l=3),s=0;s<=i;s++)if(r=n,n=e[2*(s+1)+1],!(++h<o&&r===n)){if(h<l)do{Y(t,r,t.bl_tree)}while(0!==--h);else 0!==r?(r!==a&&(Y(t,r,t.bl_tree),h--),Y(t,D,t.bl_tree),Z(t,h-3,2)):h<=10?(Y(t,w,t.bl_tree),Z(t,h-3,3)):(Y(t,v,t.bl_tree),Z(t,h-11,7));h=0,a=r,0===n?(o=138,l=3):r===n?(o=6,l=3):(o=7,l=4)}},nt=t=>{let e;for(rt(t,t.dyn_ltree,t.l_desc.max_code),rt(t,t.dyn_dtree,t.d_desc.max_code),st(t,t.bl_desc),e=R-1;e>=3;e--)if(0!==t.bl_tree[2*T[e]+1])break;return t.opt_len+=3*(e+1)+5+5+4,e},ht=(t,e,i,s)=>{let r;for(Z(t,e-257,5),Z(t,i-1,5),Z(t,s-4,4),r=0;r<s;r++)Z(t,t.bl_tree[2*T[r]+1],3);at(t,t.dyn_ltree,e-1),at(t,t.dyn_dtree,i-1)},ot=t=>{let e,i=4093624447;for(e=0;e<=31;e++,i>>>=1)if(1&i&&0!==t.dyn_ltree[2*e])return r;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return a;for(e=32;e<m;e++)if(0!==t.dyn_ltree[2*e])return a;return r};let lt=!1;const ut=t=>{lt||(K(),lt=!0),t.l_desc=new U(t.dyn_ltree,B),t.d_desc=new U(t.dyn_dtree,G),t.bl_desc=new U(t.bl_tree,V),t.bi_buf=0,t.bi_valid=0,j(t)},ct=(t,e,i,s)=>{Z(t,(o<<1)+(s?1:0),3),$(t,e,i,!0)},pt=t=>{Z(t,l<<1,3),Y(t,C,k),H(t)},dt=(t,e,i,r)=>{let a,h,o=0;t.level>0?(t.strm.data_type===n&&(t.strm.data_type=ot(t)),st(t,t.l_desc),st(t,t.d_desc),o=nt(t),a=t.opt_len+3+7>>>3,h=t.static_len+3+7>>>3,h<=a&&(a=h)):a=h=i+5,i+4<=a&&-1!==e?ct(t,e,i,r):t.strategy===s||h===a?(Z(t,(l<<1)+(r?1:0),3),it(t,k,O)):(Z(t,(u<<1)+(r?1:0),3),ht(t,t.l_desc.max_code+1,t.d_desc.max_code+1,o+1),it(t,t.dyn_ltree,t.dyn_dtree)),j(t),r&&Q(t)},mt=(t,e,i)=>(t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&i,t.last_lit++,0===e?t.dyn_ltree[2*i]++:(t.matches++,e--,t.dyn_ltree[2*(F[i]+m+1)]++,t.dyn_dtree[2*q(e)]++),t.last_lit===t.lit_bufsize-1);var _t=ut,ft=ct,Rt=dt,gt=mt,St=pt,bt={_tr_init:_t,_tr_stored_block:ft,_tr_flush_block:Rt,_tr_tally:gt,_tr_align:St};const At=(t,e,i,s)=>{let r=65535&t|0,a=t>>>16&65535|0,n=0;while(0!==i){n=i>2e3?2e3:i,i-=n;do{r=r+e[s++]|0,a=a+r|0}while(--n);r%=65521,a%=65521}return r|a<<16|0};var Ct=At;const Dt=()=>{let t,e=[];for(var i=0;i<256;i++){t=i;for(var s=0;s<8;s++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e},wt=new Uint32Array(Dt()),vt=(t,e,i,s)=>{const r=wt,a=s+i;t^=-1;for(let n=s;n<a;n++)t=t>>>8^r[255&(t^e[n])];return-1^t};var yt=vt,Nt={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},It={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Tt,_tr_stored_block:Et,_tr_flush_block:kt,_tr_tally:Ot,_tr_align:Mt}=bt,{Z_NO_FLUSH:Ft,Z_PARTIAL_FLUSH:Lt,Z_FULL_FLUSH:Pt,Z_FINISH:xt,Z_BLOCK:Bt,Z_OK:Gt,Z_STREAM_END:Vt,Z_STREAM_ERROR:Ut,Z_DATA_ERROR:qt,Z_BUF_ERROR:Xt,Z_DEFAULT_COMPRESSION:Zt,Z_FILTERED:Yt,Z_HUFFMAN_ONLY:zt,Z_RLE:Ht,Z_FIXED:Wt,Z_DEFAULT_STRATEGY:Jt,Z_UNKNOWN:Kt,Z_DEFLATED:jt}=It,Qt=9,$t=15,te=8,ee=29,ie=256,se=ie+1+ee,re=30,ae=19,ne=2*se+1,he=15,oe=3,le=258,ue=le+oe+1,ce=32,pe=42,de=69,me=73,_e=91,fe=103,Re=113,ge=666,Se=1,be=2,Ae=3,Ce=4,De=3,we=(t,e)=>(t.msg=Nt[e],e),ve=t=>(t<<1)-(t>4?9:0),ye=t=>{let e=t.length;while(--e>=0)t[e]=0};let Ne=(t,e,i)=>(e<<t.hash_shift^i)&t.hash_mask,Ie=Ne;const Te=t=>{const e=t.state;let i=e.pending;i>t.avail_out&&(i=t.avail_out),0!==i&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+i),t.next_out),t.next_out+=i,e.pending_out+=i,t.total_out+=i,t.avail_out-=i,e.pending-=i,0===e.pending&&(e.pending_out=0))},Ee=(t,e)=>{kt(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,Te(t.strm)},ke=(t,e)=>{t.pending_buf[t.pending++]=e},Oe=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},Me=(t,e,i,s)=>{let r=t.avail_in;return r>s&&(r=s),0===r?0:(t.avail_in-=r,e.set(t.input.subarray(t.next_in,t.next_in+r),i),1===t.state.wrap?t.adler=Ct(t.adler,e,r,i):2===t.state.wrap&&(t.adler=yt(t.adler,e,r,i)),t.next_in+=r,t.total_in+=r,r)},Fe=(t,e)=>{let i,s,r=t.max_chain_length,a=t.strstart,n=t.prev_length,h=t.nice_match;const o=t.strstart>t.w_size-ue?t.strstart-(t.w_size-ue):0,l=t.window,u=t.w_mask,c=t.prev,p=t.strstart+le;let d=l[a+n-1],m=l[a+n];t.prev_length>=t.good_match&&(r>>=2),h>t.lookahead&&(h=t.lookahead);do{if(i=e,l[i+n]===m&&l[i+n-1]===d&&l[i]===l[a]&&l[++i]===l[a+1]){a+=2,i++;do{}while(l[++a]===l[++i]&&l[++a]===l[++i]&&l[++a]===l[++i]&&l[++a]===l[++i]&&l[++a]===l[++i]&&l[++a]===l[++i]&&l[++a]===l[++i]&&l[++a]===l[++i]&&a<p);if(s=le-(p-a),a=p-le,s>n){if(t.match_start=e,n=s,s>=h)break;d=l[a+n-1],m=l[a+n]}}}while((e=c[e&u])>o&&0!==--r);return n<=t.lookahead?n:t.lookahead},Le=t=>{const e=t.w_size;let i,s,r,a,n;do{if(a=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-ue)){t.window.set(t.window.subarray(e,e+e),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,s=t.hash_size,i=s;do{r=t.head[--i],t.head[i]=r>=e?r-e:0}while(--s);s=e,i=s;do{r=t.prev[--i],t.prev[i]=r>=e?r-e:0}while(--s);a+=e}if(0===t.strm.avail_in)break;if(s=Me(t.strm,t.window,t.strstart+t.lookahead,a),t.lookahead+=s,t.lookahead+t.insert>=oe){n=t.strstart-t.insert,t.ins_h=t.window[n],t.ins_h=Ie(t,t.ins_h,t.window[n+1]);while(t.insert)if(t.ins_h=Ie(t,t.ins_h,t.window[n+oe-1]),t.prev[n&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=n,n++,t.insert--,t.lookahead+t.insert<oe)break}}while(t.lookahead<ue&&0!==t.strm.avail_in)},Pe=(t,e)=>{let i=65535;for(i>t.pending_buf_size-5&&(i=t.pending_buf_size-5);;){if(t.lookahead<=1){if(Le(t),0===t.lookahead&&e===Ft)return Se;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;const s=t.block_start+i;if((0===t.strstart||t.strstart>=s)&&(t.lookahead=t.strstart-s,t.strstart=s,Ee(t,!1),0===t.strm.avail_out))return Se;if(t.strstart-t.block_start>=t.w_size-ue&&(Ee(t,!1),0===t.strm.avail_out))return Se}return t.insert=0,e===xt?(Ee(t,!0),0===t.strm.avail_out?Ae:Ce):(t.strstart>t.block_start&&(Ee(t,!1),t.strm.avail_out),Se)},xe=(t,e)=>{let i,s;for(;;){if(t.lookahead<ue){if(Le(t),t.lookahead<ue&&e===Ft)return Se;if(0===t.lookahead)break}if(i=0,t.lookahead>=oe&&(t.ins_h=Ie(t,t.ins_h,t.window[t.strstart+oe-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==i&&t.strstart-i<=t.w_size-ue&&(t.match_length=Fe(t,i)),t.match_length>=oe)if(s=Ot(t,t.strstart-t.match_start,t.match_length-oe),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=oe){t.match_length--;do{t.strstart++,t.ins_h=Ie(t,t.ins_h,t.window[t.strstart+oe-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!==--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=Ie(t,t.ins_h,t.window[t.strstart+1]);else s=Ot(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(s&&(Ee(t,!1),0===t.strm.avail_out))return Se}return t.insert=t.strstart<oe-1?t.strstart:oe-1,e===xt?(Ee(t,!0),0===t.strm.avail_out?Ae:Ce):t.last_lit&&(Ee(t,!1),0===t.strm.avail_out)?Se:be},Be=(t,e)=>{let i,s,r;for(;;){if(t.lookahead<ue){if(Le(t),t.lookahead<ue&&e===Ft)return Se;if(0===t.lookahead)break}if(i=0,t.lookahead>=oe&&(t.ins_h=Ie(t,t.ins_h,t.window[t.strstart+oe-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=oe-1,0!==i&&t.prev_length<t.max_lazy_match&&t.strstart-i<=t.w_size-ue&&(t.match_length=Fe(t,i),t.match_length<=5&&(t.strategy===Yt||t.match_length===oe&&t.strstart-t.match_start>4096)&&(t.match_length=oe-1)),t.prev_length>=oe&&t.match_length<=t.prev_length){r=t.strstart+t.lookahead-oe,s=Ot(t,t.strstart-1-t.prev_match,t.prev_length-oe),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=r&&(t.ins_h=Ie(t,t.ins_h,t.window[t.strstart+oe-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!==--t.prev_length);if(t.match_available=0,t.match_length=oe-1,t.strstart++,s&&(Ee(t,!1),0===t.strm.avail_out))return Se}else if(t.match_available){if(s=Ot(t,0,t.window[t.strstart-1]),s&&Ee(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return Se}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(s=Ot(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<oe-1?t.strstart:oe-1,e===xt?(Ee(t,!0),0===t.strm.avail_out?Ae:Ce):t.last_lit&&(Ee(t,!1),0===t.strm.avail_out)?Se:be},Ge=(t,e)=>{let i,s,r,a;const n=t.window;for(;;){if(t.lookahead<=le){if(Le(t),t.lookahead<=le&&e===Ft)return Se;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=oe&&t.strstart>0&&(r=t.strstart-1,s=n[r],s===n[++r]&&s===n[++r]&&s===n[++r])){a=t.strstart+le;do{}while(s===n[++r]&&s===n[++r]&&s===n[++r]&&s===n[++r]&&s===n[++r]&&s===n[++r]&&s===n[++r]&&s===n[++r]&&r<a);t.match_length=le-(a-r),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=oe?(i=Ot(t,1,t.match_length-oe),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(i=Ot(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),i&&(Ee(t,!1),0===t.strm.avail_out))return Se}return t.insert=0,e===xt?(Ee(t,!0),0===t.strm.avail_out?Ae:Ce):t.last_lit&&(Ee(t,!1),0===t.strm.avail_out)?Se:be},Ve=(t,e)=>{let i;for(;;){if(0===t.lookahead&&(Le(t),0===t.lookahead)){if(e===Ft)return Se;break}if(t.match_length=0,i=Ot(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,i&&(Ee(t,!1),0===t.strm.avail_out))return Se}return t.insert=0,e===xt?(Ee(t,!0),0===t.strm.avail_out?Ae:Ce):t.last_lit&&(Ee(t,!1),0===t.strm.avail_out)?Se:be};function Ue(t,e,i,s,r){this.good_length=t,this.max_lazy=e,this.nice_length=i,this.max_chain=s,this.func=r}const qe=[new Ue(0,0,0,0,Pe),new Ue(4,4,8,4,xe),new Ue(4,5,16,8,xe),new Ue(4,6,32,32,xe),new Ue(4,4,16,16,Be),new Ue(8,16,32,32,Be),new Ue(8,16,128,128,Be),new Ue(8,32,128,256,Be),new Ue(32,128,258,1024,Be),new Ue(32,258,258,4096,Be)],Xe=t=>{t.window_size=2*t.w_size,ye(t.head),t.max_lazy_match=qe[t.level].max_lazy,t.good_match=qe[t.level].good_length,t.nice_match=qe[t.level].nice_length,t.max_chain_length=qe[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=oe-1,t.match_available=0,t.ins_h=0};function Ze(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=jt,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*ne),this.dyn_dtree=new Uint16Array(2*(2*re+1)),this.bl_tree=new Uint16Array(2*(2*ae+1)),ye(this.dyn_ltree),ye(this.dyn_dtree),ye(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(he+1),this.heap=new Uint16Array(2*se+1),ye(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*se+1),ye(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Ye=t=>{if(!t||!t.state)return we(t,Ut);t.total_in=t.total_out=0,t.data_type=Kt;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?pe:Re,t.adler=2===e.wrap?0:1,e.last_flush=Ft,Tt(e),Gt},ze=t=>{const e=Ye(t);return e===Gt&&Xe(t.state),e},He=(t,e)=>t&&t.state?2!==t.state.wrap?Ut:(t.state.gzhead=e,Gt):Ut,We=(t,e,i,s,r,a)=>{if(!t)return Ut;let n=1;if(e===Zt&&(e=6),s<0?(n=0,s=-s):s>15&&(n=2,s-=16),r<1||r>Qt||i!==jt||s<8||s>15||e<0||e>9||a<0||a>Wt)return we(t,Ut);8===s&&(s=9);const h=new Ze;return t.state=h,h.strm=t,h.wrap=n,h.gzhead=null,h.w_bits=s,h.w_size=1<<h.w_bits,h.w_mask=h.w_size-1,h.hash_bits=r+7,h.hash_size=1<<h.hash_bits,h.hash_mask=h.hash_size-1,h.hash_shift=~~((h.hash_bits+oe-1)/oe),h.window=new Uint8Array(2*h.w_size),h.head=new Uint16Array(h.hash_size),h.prev=new Uint16Array(h.w_size),h.lit_bufsize=1<<r+6,h.pending_buf_size=4*h.lit_bufsize,h.pending_buf=new Uint8Array(h.pending_buf_size),h.d_buf=1*h.lit_bufsize,h.l_buf=3*h.lit_bufsize,h.level=e,h.strategy=a,h.method=i,ze(t)},Je=(t,e)=>We(t,e,jt,$t,te,Jt),Ke=(t,e)=>{let i,s;if(!t||!t.state||e>Bt||e<0)return t?we(t,Ut):Ut;const r=t.state;if(!t.output||!t.input&&0!==t.avail_in||r.status===ge&&e!==xt)return we(t,0===t.avail_out?Xt:Ut);r.strm=t;const a=r.last_flush;if(r.last_flush=e,r.status===pe)if(2===r.wrap)t.adler=0,ke(r,31),ke(r,139),ke(r,8),r.gzhead?(ke(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),ke(r,255&r.gzhead.time),ke(r,r.gzhead.time>>8&255),ke(r,r.gzhead.time>>16&255),ke(r,r.gzhead.time>>24&255),ke(r,9===r.level?2:r.strategy>=zt||r.level<2?4:0),ke(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(ke(r,255&r.gzhead.extra.length),ke(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(t.adler=yt(t.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=de):(ke(r,0),ke(r,0),ke(r,0),ke(r,0),ke(r,0),ke(r,9===r.level?2:r.strategy>=zt||r.level<2?4:0),ke(r,De),r.status=Re);else{let e=jt+(r.w_bits-8<<4)<<8,i=-1;i=r.strategy>=zt||r.level<2?0:r.level<6?1:6===r.level?2:3,e|=i<<6,0!==r.strstart&&(e|=ce),e+=31-e%31,r.status=Re,Oe(r,e),0!==r.strstart&&(Oe(r,t.adler>>>16),Oe(r,65535&t.adler)),t.adler=1}if(r.status===de)if(r.gzhead.extra){i=r.pending;while(r.gzindex<(65535&r.gzhead.extra.length)){if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>i&&(t.adler=yt(t.adler,r.pending_buf,r.pending-i,i)),Te(t),i=r.pending,r.pending===r.pending_buf_size))break;ke(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++}r.gzhead.hcrc&&r.pending>i&&(t.adler=yt(t.adler,r.pending_buf,r.pending-i,i)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=me)}else r.status=me;if(r.status===me)if(r.gzhead.name){i=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>i&&(t.adler=yt(t.adler,r.pending_buf,r.pending-i,i)),Te(t),i=r.pending,r.pending===r.pending_buf_size)){s=1;break}s=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,ke(r,s)}while(0!==s);r.gzhead.hcrc&&r.pending>i&&(t.adler=yt(t.adler,r.pending_buf,r.pending-i,i)),0===s&&(r.gzindex=0,r.status=_e)}else r.status=_e;if(r.status===_e)if(r.gzhead.comment){i=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>i&&(t.adler=yt(t.adler,r.pending_buf,r.pending-i,i)),Te(t),i=r.pending,r.pending===r.pending_buf_size)){s=1;break}s=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,ke(r,s)}while(0!==s);r.gzhead.hcrc&&r.pending>i&&(t.adler=yt(t.adler,r.pending_buf,r.pending-i,i)),0===s&&(r.status=fe)}else r.status=fe;if(r.status===fe&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&Te(t),r.pending+2<=r.pending_buf_size&&(ke(r,255&t.adler),ke(r,t.adler>>8&255),t.adler=0,r.status=Re)):r.status=Re),0!==r.pending){if(Te(t),0===t.avail_out)return r.last_flush=-1,Gt}else if(0===t.avail_in&&ve(e)<=ve(a)&&e!==xt)return we(t,Xt);if(r.status===ge&&0!==t.avail_in)return we(t,Xt);if(0!==t.avail_in||0!==r.lookahead||e!==Ft&&r.status!==ge){let i=r.strategy===zt?Ve(r,e):r.strategy===Ht?Ge(r,e):qe[r.level].func(r,e);if(i!==Ae&&i!==Ce||(r.status=ge),i===Se||i===Ae)return 0===t.avail_out&&(r.last_flush=-1),Gt;if(i===be&&(e===Lt?Mt(r):e!==Bt&&(Et(r,0,0,!1),e===Pt&&(ye(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),Te(t),0===t.avail_out))return r.last_flush=-1,Gt}return e!==xt?Gt:r.wrap<=0?Vt:(2===r.wrap?(ke(r,255&t.adler),ke(r,t.adler>>8&255),ke(r,t.adler>>16&255),ke(r,t.adler>>24&255),ke(r,255&t.total_in),ke(r,t.total_in>>8&255),ke(r,t.total_in>>16&255),ke(r,t.total_in>>24&255)):(Oe(r,t.adler>>>16),Oe(r,65535&t.adler)),Te(t),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?Gt:Vt)},je=t=>{if(!t||!t.state)return Ut;const e=t.state.status;return e!==pe&&e!==de&&e!==me&&e!==_e&&e!==fe&&e!==Re&&e!==ge?we(t,Ut):(t.state=null,e===Re?we(t,qt):Gt)},Qe=(t,e)=>{let i=e.length;if(!t||!t.state)return Ut;const s=t.state,r=s.wrap;if(2===r||1===r&&s.status!==pe||s.lookahead)return Ut;if(1===r&&(t.adler=Ct(t.adler,e,i,0)),s.wrap=0,i>=s.w_size){0===r&&(ye(s.head),s.strstart=0,s.block_start=0,s.insert=0);let t=new Uint8Array(s.w_size);t.set(e.subarray(i-s.w_size,i),0),e=t,i=s.w_size}const a=t.avail_in,n=t.next_in,h=t.input;t.avail_in=i,t.next_in=0,t.input=e,Le(s);while(s.lookahead>=oe){let t=s.strstart,e=s.lookahead-(oe-1);do{s.ins_h=Ie(s,s.ins_h,s.window[t+oe-1]),s.prev[t&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=t,t++}while(--e);s.strstart=t,s.lookahead=oe-1,Le(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=oe-1,s.match_available=0,t.next_in=n,t.input=h,t.avail_in=a,s.wrap=r,Gt};var $e=Je,ti=We,ei=ze,ii=Ye,si=He,ri=Ke,ai=je,ni=Qe,hi="pako deflate (from Nodeca project)",oi={deflateInit:$e,deflateInit2:ti,deflateReset:ei,deflateResetKeep:ii,deflateSetHeader:si,deflate:ri,deflateEnd:ai,deflateSetDictionary:ni,deflateInfo:hi};const li=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var ui=function(t){const e=Array.prototype.slice.call(arguments,1);while(e.length){const i=e.shift();if(i){if("object"!==typeof i)throw new TypeError(i+"must be non-object");for(const e in i)li(i,e)&&(t[e]=i[e])}}return t},ci=t=>{let e=0;for(let s=0,r=t.length;s<r;s++)e+=t[s].length;const i=new Uint8Array(e);for(let s=0,r=0,a=t.length;s<a;s++){let e=t[s];i.set(e,r),r+=e.length}return i},pi={assign:ui,flattenChunks:ci};let di=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(ua){di=!1}const mi=new Uint8Array(256);for(let ca=0;ca<256;ca++)mi[ca]=ca>=252?6:ca>=248?5:ca>=240?4:ca>=224?3:ca>=192?2:1;mi[254]=mi[254]=1;var _i=t=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(t);let e,i,s,r,a,n=t.length,h=0;for(r=0;r<n;r++)i=t.charCodeAt(r),55296===(64512&i)&&r+1<n&&(s=t.charCodeAt(r+1),56320===(64512&s)&&(i=65536+(i-55296<<10)+(s-56320),r++)),h+=i<128?1:i<2048?2:i<65536?3:4;for(e=new Uint8Array(h),a=0,r=0;a<h;r++)i=t.charCodeAt(r),55296===(64512&i)&&r+1<n&&(s=t.charCodeAt(r+1),56320===(64512&s)&&(i=65536+(i-55296<<10)+(s-56320),r++)),i<128?e[a++]=i:i<2048?(e[a++]=192|i>>>6,e[a++]=128|63&i):i<65536?(e[a++]=224|i>>>12,e[a++]=128|i>>>6&63,e[a++]=128|63&i):(e[a++]=240|i>>>18,e[a++]=128|i>>>12&63,e[a++]=128|i>>>6&63,e[a++]=128|63&i);return e};const fi=(t,e)=>{if(e<65534&&t.subarray&&di)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let i="";for(let s=0;s<e;s++)i+=String.fromCharCode(t[s]);return i};var Ri=(t,e)=>{const i=e||t.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(t.subarray(0,e));let s,r;const a=new Array(2*i);for(r=0,s=0;s<i;){let e=t[s++];if(e<128){a[r++]=e;continue}let n=mi[e];if(n>4)a[r++]=65533,s+=n-1;else{e&=2===n?31:3===n?15:7;while(n>1&&s<i)e=e<<6|63&t[s++],n--;n>1?a[r++]=65533:e<65536?a[r++]=e:(e-=65536,a[r++]=55296|e>>10&1023,a[r++]=56320|1023&e)}}return fi(a,r)},gi=(t,e)=>{e=e||t.length,e>t.length&&(e=t.length);let i=e-1;while(i>=0&&128===(192&t[i]))i--;return i<0||0===i?e:i+mi[t[i]]>e?i:e},Si={string2buf:_i,buf2string:Ri,utf8border:gi};function bi(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var Ai=bi;const Ci=Object.prototype.toString,{Z_NO_FLUSH:Di,Z_SYNC_FLUSH:wi,Z_FULL_FLUSH:vi,Z_FINISH:yi,Z_OK:Ni,Z_STREAM_END:Ii,Z_DEFAULT_COMPRESSION:Ti,Z_DEFAULT_STRATEGY:Ei,Z_DEFLATED:ki}=It;function Oi(t){this.options=pi.assign({level:Ti,method:ki,chunkSize:16384,windowBits:15,memLevel:8,strategy:Ei},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ai,this.strm.avail_out=0;let i=oi.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(i!==Ni)throw new Error(Nt[i]);if(e.header&&oi.deflateSetHeader(this.strm,e.header),e.dictionary){let t;if(t="string"===typeof e.dictionary?Si.string2buf(e.dictionary):"[object ArrayBuffer]"===Ci.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,i=oi.deflateSetDictionary(this.strm,t),i!==Ni)throw new Error(Nt[i]);this._dict_set=!0}}function Mi(t,e){const i=new Oi(e);if(i.push(t,!0),i.err)throw i.msg||Nt[i.err];return i.result}function Fi(t,e){return e=e||{},e.raw=!0,Mi(t,e)}function Li(t,e){return e=e||{},e.gzip=!0,Mi(t,e)}Oi.prototype.push=function(t,e){const i=this.strm,s=this.options.chunkSize;let r,a;if(this.ended)return!1;for(a=e===~~e?e:!0===e?yi:Di,"string"===typeof t?i.input=Si.string2buf(t):"[object ArrayBuffer]"===Ci.call(t)?i.input=new Uint8Array(t):i.input=t,i.next_in=0,i.avail_in=i.input.length;;)if(0===i.avail_out&&(i.output=new Uint8Array(s),i.next_out=0,i.avail_out=s),(a===wi||a===vi)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(r=oi.deflate(i,a),r===Ii)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),r=oi.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===Ni;if(0!==i.avail_out){if(a>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(0===i.avail_in)break}else this.onData(i.output)}return!0},Oi.prototype.onData=function(t){this.chunks.push(t)},Oi.prototype.onEnd=function(t){t===Ni&&(this.result=pi.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Pi=Oi,xi=Mi,Bi=Fi,Gi=Li,Vi=It,Ui={Deflate:Pi,deflate:xi,deflateRaw:Bi,gzip:Gi,constants:Vi};const qi=30,Xi=12;var Zi=function(t,e){let i,s,r,a,n,h,o,l,u,c,p,d,m,_,f,R,g,S,b,A,C,D,w,v;const y=t.state;i=t.next_in,w=t.input,s=i+(t.avail_in-5),r=t.next_out,v=t.output,a=r-(e-t.avail_out),n=r+(t.avail_out-257),h=y.dmax,o=y.wsize,l=y.whave,u=y.wnext,c=y.window,p=y.hold,d=y.bits,m=y.lencode,_=y.distcode,f=(1<<y.lenbits)-1,R=(1<<y.distbits)-1;t:do{d<15&&(p+=w[i++]<<d,d+=8,p+=w[i++]<<d,d+=8),g=m[p&f];e:for(;;){if(S=g>>>24,p>>>=S,d-=S,S=g>>>16&255,0===S)v[r++]=65535&g;else{if(!(16&S)){if(0===(64&S)){g=m[(65535&g)+(p&(1<<S)-1)];continue e}if(32&S){y.mode=Xi;break t}t.msg="invalid literal/length code",y.mode=qi;break t}b=65535&g,S&=15,S&&(d<S&&(p+=w[i++]<<d,d+=8),b+=p&(1<<S)-1,p>>>=S,d-=S),d<15&&(p+=w[i++]<<d,d+=8,p+=w[i++]<<d,d+=8),g=_[p&R];i:for(;;){if(S=g>>>24,p>>>=S,d-=S,S=g>>>16&255,!(16&S)){if(0===(64&S)){g=_[(65535&g)+(p&(1<<S)-1)];continue i}t.msg="invalid distance code",y.mode=qi;break t}if(A=65535&g,S&=15,d<S&&(p+=w[i++]<<d,d+=8,d<S&&(p+=w[i++]<<d,d+=8)),A+=p&(1<<S)-1,A>h){t.msg="invalid distance too far back",y.mode=qi;break t}if(p>>>=S,d-=S,S=r-a,A>S){if(S=A-S,S>l&&y.sane){t.msg="invalid distance too far back",y.mode=qi;break t}if(C=0,D=c,0===u){if(C+=o-S,S<b){b-=S;do{v[r++]=c[C++]}while(--S);C=r-A,D=v}}else if(u<S){if(C+=o+u-S,S-=u,S<b){b-=S;do{v[r++]=c[C++]}while(--S);if(C=0,u<b){S=u,b-=S;do{v[r++]=c[C++]}while(--S);C=r-A,D=v}}}else if(C+=u-S,S<b){b-=S;do{v[r++]=c[C++]}while(--S);C=r-A,D=v}while(b>2)v[r++]=D[C++],v[r++]=D[C++],v[r++]=D[C++],b-=3;b&&(v[r++]=D[C++],b>1&&(v[r++]=D[C++]))}else{C=r-A;do{v[r++]=v[C++],v[r++]=v[C++],v[r++]=v[C++],b-=3}while(b>2);b&&(v[r++]=v[C++],b>1&&(v[r++]=v[C++]))}break}}break}}while(i<s&&r<n);b=d>>3,i-=b,d-=b<<3,p&=(1<<d)-1,t.next_in=i,t.next_out=r,t.avail_in=i<s?s-i+5:5-(i-s),t.avail_out=r<n?n-r+257:257-(r-n),y.hold=p,y.bits=d};const Yi=15,zi=852,Hi=592,Wi=0,Ji=1,Ki=2,ji=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Qi=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),$i=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),ts=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),es=(t,e,i,s,r,a,n,h)=>{const o=h.bits;let l,u,c,p,d,m,_=0,f=0,R=0,g=0,S=0,b=0,A=0,C=0,D=0,w=0,v=null,y=0;const N=new Uint16Array(Yi+1),I=new Uint16Array(Yi+1);let T,E,k,O=null,M=0;for(_=0;_<=Yi;_++)N[_]=0;for(f=0;f<s;f++)N[e[i+f]]++;for(S=o,g=Yi;g>=1;g--)if(0!==N[g])break;if(S>g&&(S=g),0===g)return r[a++]=20971520,r[a++]=20971520,h.bits=1,0;for(R=1;R<g;R++)if(0!==N[R])break;for(S<R&&(S=R),C=1,_=1;_<=Yi;_++)if(C<<=1,C-=N[_],C<0)return-1;if(C>0&&(t===Wi||1!==g))return-1;for(I[1]=0,_=1;_<Yi;_++)I[_+1]=I[_]+N[_];for(f=0;f<s;f++)0!==e[i+f]&&(n[I[e[i+f]]++]=f);if(t===Wi?(v=O=n,m=19):t===Ji?(v=ji,y-=257,O=Qi,M-=257,m=256):(v=$i,O=ts,m=-1),w=0,f=0,_=R,d=a,b=S,A=0,c=-1,D=1<<S,p=D-1,t===Ji&&D>zi||t===Ki&&D>Hi)return 1;for(;;){T=_-A,n[f]<m?(E=0,k=n[f]):n[f]>m?(E=O[M+n[f]],k=v[y+n[f]]):(E=96,k=0),l=1<<_-A,u=1<<b,R=u;do{u-=l,r[d+(w>>A)+u]=T<<24|E<<16|k|0}while(0!==u);l=1<<_-1;while(w&l)l>>=1;if(0!==l?(w&=l-1,w+=l):w=0,f++,0===--N[_]){if(_===g)break;_=e[i+n[f]]}if(_>S&&(w&p)!==c){0===A&&(A=S),d+=R,b=_-A,C=1<<b;while(b+A<g){if(C-=N[b+A],C<=0)break;b++,C<<=1}if(D+=1<<b,t===Ji&&D>zi||t===Ki&&D>Hi)return 1;c=w&p,r[c]=S<<24|b<<16|d-a|0}}return 0!==w&&(r[d+w]=_-A<<24|64<<16|0),h.bits=S,0};var is=es;const ss=0,rs=1,as=2,{Z_FINISH:ns,Z_BLOCK:hs,Z_TREES:os,Z_OK:ls,Z_STREAM_END:us,Z_NEED_DICT:cs,Z_STREAM_ERROR:ps,Z_DATA_ERROR:ds,Z_MEM_ERROR:ms,Z_BUF_ERROR:_s,Z_DEFLATED:fs}=It,Rs=1,gs=2,Ss=3,bs=4,As=5,Cs=6,Ds=7,ws=8,vs=9,ys=10,Ns=11,Is=12,Ts=13,Es=14,ks=15,Os=16,Ms=17,Fs=18,Ls=19,Ps=20,xs=21,Bs=22,Gs=23,Vs=24,Us=25,qs=26,Xs=27,Zs=28,Ys=29,zs=30,Hs=31,Ws=32,Js=852,Ks=592,js=15,Qs=js,$s=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function tr(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const er=t=>{if(!t||!t.state)return ps;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=Rs,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(Js),e.distcode=e.distdyn=new Int32Array(Ks),e.sane=1,e.back=-1,ls},ir=t=>{if(!t||!t.state)return ps;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,er(t)},sr=(t,e)=>{let i;if(!t||!t.state)return ps;const s=t.state;return e<0?(i=0,e=-e):(i=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?ps:(null!==s.window&&s.wbits!==e&&(s.window=null),s.wrap=i,s.wbits=e,ir(t))},rr=(t,e)=>{if(!t)return ps;const i=new tr;t.state=i,i.window=null;const s=sr(t,e);return s!==ls&&(t.state=null),s},ar=t=>rr(t,Qs);let nr,hr,or=!0;const lr=t=>{if(or){nr=new Int32Array(512),hr=new Int32Array(32);let e=0;while(e<144)t.lens[e++]=8;while(e<256)t.lens[e++]=9;while(e<280)t.lens[e++]=7;while(e<288)t.lens[e++]=8;is(rs,t.lens,0,288,nr,0,t.work,{bits:9}),e=0;while(e<32)t.lens[e++]=5;is(as,t.lens,0,32,hr,0,t.work,{bits:5}),or=!1}t.lencode=nr,t.lenbits=9,t.distcode=hr,t.distbits=5},ur=(t,e,i,s)=>{let r;const a=t.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),s>=a.wsize?(a.window.set(e.subarray(i-a.wsize,i),0),a.wnext=0,a.whave=a.wsize):(r=a.wsize-a.wnext,r>s&&(r=s),a.window.set(e.subarray(i-s,i-s+r),a.wnext),s-=r,s?(a.window.set(e.subarray(i-s,i),0),a.wnext=s,a.whave=a.wsize):(a.wnext+=r,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=r))),0},cr=(t,e)=>{let i,s,r,a,n,h,o,l,u,c,p,d,m,_,f,R,g,S,b,A,C,D,w=0;const v=new Uint8Array(4);let y,N;const I=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return ps;i=t.state,i.mode===Is&&(i.mode=Ts),n=t.next_out,r=t.output,o=t.avail_out,a=t.next_in,s=t.input,h=t.avail_in,l=i.hold,u=i.bits,c=h,p=o,D=ls;t:for(;;)switch(i.mode){case Rs:if(0===i.wrap){i.mode=Ts;break}while(u<16){if(0===h)break t;h--,l+=s[a++]<<u,u+=8}if(2&i.wrap&&35615===l){i.check=0,v[0]=255&l,v[1]=l>>>8&255,i.check=yt(i.check,v,2,0),l=0,u=0,i.mode=gs;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&l)<<8)+(l>>8))%31){t.msg="incorrect header check",i.mode=zs;break}if((15&l)!==fs){t.msg="unknown compression method",i.mode=zs;break}if(l>>>=4,u-=4,C=8+(15&l),0===i.wbits)i.wbits=C;else if(C>i.wbits){t.msg="invalid window size",i.mode=zs;break}i.dmax=1<<i.wbits,t.adler=i.check=1,i.mode=512&l?ys:Is,l=0,u=0;break;case gs:while(u<16){if(0===h)break t;h--,l+=s[a++]<<u,u+=8}if(i.flags=l,(255&i.flags)!==fs){t.msg="unknown compression method",i.mode=zs;break}if(57344&i.flags){t.msg="unknown header flags set",i.mode=zs;break}i.head&&(i.head.text=l>>8&1),512&i.flags&&(v[0]=255&l,v[1]=l>>>8&255,i.check=yt(i.check,v,2,0)),l=0,u=0,i.mode=Ss;case Ss:while(u<32){if(0===h)break t;h--,l+=s[a++]<<u,u+=8}i.head&&(i.head.time=l),512&i.flags&&(v[0]=255&l,v[1]=l>>>8&255,v[2]=l>>>16&255,v[3]=l>>>24&255,i.check=yt(i.check,v,4,0)),l=0,u=0,i.mode=bs;case bs:while(u<16){if(0===h)break t;h--,l+=s[a++]<<u,u+=8}i.head&&(i.head.xflags=255&l,i.head.os=l>>8),512&i.flags&&(v[0]=255&l,v[1]=l>>>8&255,i.check=yt(i.check,v,2,0)),l=0,u=0,i.mode=As;case As:if(1024&i.flags){while(u<16){if(0===h)break t;h--,l+=s[a++]<<u,u+=8}i.length=l,i.head&&(i.head.extra_len=l),512&i.flags&&(v[0]=255&l,v[1]=l>>>8&255,i.check=yt(i.check,v,2,0)),l=0,u=0}else i.head&&(i.head.extra=null);i.mode=Cs;case Cs:if(1024&i.flags&&(d=i.length,d>h&&(d=h),d&&(i.head&&(C=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(s.subarray(a,a+d),C)),512&i.flags&&(i.check=yt(i.check,s,d,a)),h-=d,a+=d,i.length-=d),i.length))break t;i.length=0,i.mode=Ds;case Ds:if(2048&i.flags){if(0===h)break t;d=0;do{C=s[a+d++],i.head&&C&&i.length<65536&&(i.head.name+=String.fromCharCode(C))}while(C&&d<h);if(512&i.flags&&(i.check=yt(i.check,s,d,a)),h-=d,a+=d,C)break t}else i.head&&(i.head.name=null);i.length=0,i.mode=ws;case ws:if(4096&i.flags){if(0===h)break t;d=0;do{C=s[a+d++],i.head&&C&&i.length<65536&&(i.head.comment+=String.fromCharCode(C))}while(C&&d<h);if(512&i.flags&&(i.check=yt(i.check,s,d,a)),h-=d,a+=d,C)break t}else i.head&&(i.head.comment=null);i.mode=vs;case vs:if(512&i.flags){while(u<16){if(0===h)break t;h--,l+=s[a++]<<u,u+=8}if(l!==(65535&i.check)){t.msg="header crc mismatch",i.mode=zs;break}l=0,u=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),t.adler=i.check=0,i.mode=Is;break;case ys:while(u<32){if(0===h)break t;h--,l+=s[a++]<<u,u+=8}t.adler=i.check=$s(l),l=0,u=0,i.mode=Ns;case Ns:if(0===i.havedict)return t.next_out=n,t.avail_out=o,t.next_in=a,t.avail_in=h,i.hold=l,i.bits=u,cs;t.adler=i.check=1,i.mode=Is;case Is:if(e===hs||e===os)break t;case Ts:if(i.last){l>>>=7&u,u-=7&u,i.mode=Xs;break}while(u<3){if(0===h)break t;h--,l+=s[a++]<<u,u+=8}switch(i.last=1&l,l>>>=1,u-=1,3&l){case 0:i.mode=Es;break;case 1:if(lr(i),i.mode=Ps,e===os){l>>>=2,u-=2;break t}break;case 2:i.mode=Ms;break;case 3:t.msg="invalid block type",i.mode=zs}l>>>=2,u-=2;break;case Es:l>>>=7&u,u-=7&u;while(u<32){if(0===h)break t;h--,l+=s[a++]<<u,u+=8}if((65535&l)!==(l>>>16^65535)){t.msg="invalid stored block lengths",i.mode=zs;break}if(i.length=65535&l,l=0,u=0,i.mode=ks,e===os)break t;case ks:i.mode=Os;case Os:if(d=i.length,d){if(d>h&&(d=h),d>o&&(d=o),0===d)break t;r.set(s.subarray(a,a+d),n),h-=d,a+=d,o-=d,n+=d,i.length-=d;break}i.mode=Is;break;case Ms:while(u<14){if(0===h)break t;h--,l+=s[a++]<<u,u+=8}if(i.nlen=257+(31&l),l>>>=5,u-=5,i.ndist=1+(31&l),l>>>=5,u-=5,i.ncode=4+(15&l),l>>>=4,u-=4,i.nlen>286||i.ndist>30){t.msg="too many length or distance symbols",i.mode=zs;break}i.have=0,i.mode=Fs;case Fs:while(i.have<i.ncode){while(u<3){if(0===h)break t;h--,l+=s[a++]<<u,u+=8}i.lens[I[i.have++]]=7&l,l>>>=3,u-=3}while(i.have<19)i.lens[I[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,y={bits:i.lenbits},D=is(ss,i.lens,0,19,i.lencode,0,i.work,y),i.lenbits=y.bits,D){t.msg="invalid code lengths set",i.mode=zs;break}i.have=0,i.mode=Ls;case Ls:while(i.have<i.nlen+i.ndist){for(;;){if(w=i.lencode[l&(1<<i.lenbits)-1],f=w>>>24,R=w>>>16&255,g=65535&w,f<=u)break;if(0===h)break t;h--,l+=s[a++]<<u,u+=8}if(g<16)l>>>=f,u-=f,i.lens[i.have++]=g;else{if(16===g){N=f+2;while(u<N){if(0===h)break t;h--,l+=s[a++]<<u,u+=8}if(l>>>=f,u-=f,0===i.have){t.msg="invalid bit length repeat",i.mode=zs;break}C=i.lens[i.have-1],d=3+(3&l),l>>>=2,u-=2}else if(17===g){N=f+3;while(u<N){if(0===h)break t;h--,l+=s[a++]<<u,u+=8}l>>>=f,u-=f,C=0,d=3+(7&l),l>>>=3,u-=3}else{N=f+7;while(u<N){if(0===h)break t;h--,l+=s[a++]<<u,u+=8}l>>>=f,u-=f,C=0,d=11+(127&l),l>>>=7,u-=7}if(i.have+d>i.nlen+i.ndist){t.msg="invalid bit length repeat",i.mode=zs;break}while(d--)i.lens[i.have++]=C}}if(i.mode===zs)break;if(0===i.lens[256]){t.msg="invalid code -- missing end-of-block",i.mode=zs;break}if(i.lenbits=9,y={bits:i.lenbits},D=is(rs,i.lens,0,i.nlen,i.lencode,0,i.work,y),i.lenbits=y.bits,D){t.msg="invalid literal/lengths set",i.mode=zs;break}if(i.distbits=6,i.distcode=i.distdyn,y={bits:i.distbits},D=is(as,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,y),i.distbits=y.bits,D){t.msg="invalid distances set",i.mode=zs;break}if(i.mode=Ps,e===os)break t;case Ps:i.mode=xs;case xs:if(h>=6&&o>=258){t.next_out=n,t.avail_out=o,t.next_in=a,t.avail_in=h,i.hold=l,i.bits=u,Zi(t,p),n=t.next_out,r=t.output,o=t.avail_out,a=t.next_in,s=t.input,h=t.avail_in,l=i.hold,u=i.bits,i.mode===Is&&(i.back=-1);break}for(i.back=0;;){if(w=i.lencode[l&(1<<i.lenbits)-1],f=w>>>24,R=w>>>16&255,g=65535&w,f<=u)break;if(0===h)break t;h--,l+=s[a++]<<u,u+=8}if(R&&0===(240&R)){for(S=f,b=R,A=g;;){if(w=i.lencode[A+((l&(1<<S+b)-1)>>S)],f=w>>>24,R=w>>>16&255,g=65535&w,S+f<=u)break;if(0===h)break t;h--,l+=s[a++]<<u,u+=8}l>>>=S,u-=S,i.back+=S}if(l>>>=f,u-=f,i.back+=f,i.length=g,0===R){i.mode=qs;break}if(32&R){i.back=-1,i.mode=Is;break}if(64&R){t.msg="invalid literal/length code",i.mode=zs;break}i.extra=15&R,i.mode=Bs;case Bs:if(i.extra){N=i.extra;while(u<N){if(0===h)break t;h--,l+=s[a++]<<u,u+=8}i.length+=l&(1<<i.extra)-1,l>>>=i.extra,u-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=Gs;case Gs:for(;;){if(w=i.distcode[l&(1<<i.distbits)-1],f=w>>>24,R=w>>>16&255,g=65535&w,f<=u)break;if(0===h)break t;h--,l+=s[a++]<<u,u+=8}if(0===(240&R)){for(S=f,b=R,A=g;;){if(w=i.distcode[A+((l&(1<<S+b)-1)>>S)],f=w>>>24,R=w>>>16&255,g=65535&w,S+f<=u)break;if(0===h)break t;h--,l+=s[a++]<<u,u+=8}l>>>=S,u-=S,i.back+=S}if(l>>>=f,u-=f,i.back+=f,64&R){t.msg="invalid distance code",i.mode=zs;break}i.offset=g,i.extra=15&R,i.mode=Vs;case Vs:if(i.extra){N=i.extra;while(u<N){if(0===h)break t;h--,l+=s[a++]<<u,u+=8}i.offset+=l&(1<<i.extra)-1,l>>>=i.extra,u-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){t.msg="invalid distance too far back",i.mode=zs;break}i.mode=Us;case Us:if(0===o)break t;if(d=p-o,i.offset>d){if(d=i.offset-d,d>i.whave&&i.sane){t.msg="invalid distance too far back",i.mode=zs;break}d>i.wnext?(d-=i.wnext,m=i.wsize-d):m=i.wnext-d,d>i.length&&(d=i.length),_=i.window}else _=r,m=n-i.offset,d=i.length;d>o&&(d=o),o-=d,i.length-=d;do{r[n++]=_[m++]}while(--d);0===i.length&&(i.mode=xs);break;case qs:if(0===o)break t;r[n++]=i.length,o--,i.mode=xs;break;case Xs:if(i.wrap){while(u<32){if(0===h)break t;h--,l|=s[a++]<<u,u+=8}if(p-=o,t.total_out+=p,i.total+=p,p&&(t.adler=i.check=i.flags?yt(i.check,r,p,n-p):Ct(i.check,r,p,n-p)),p=o,(i.flags?l:$s(l))!==i.check){t.msg="incorrect data check",i.mode=zs;break}l=0,u=0}i.mode=Zs;case Zs:if(i.wrap&&i.flags){while(u<32){if(0===h)break t;h--,l+=s[a++]<<u,u+=8}if(l!==(4294967295&i.total)){t.msg="incorrect length check",i.mode=zs;break}l=0,u=0}i.mode=Ys;case Ys:D=us;break t;case zs:D=ds;break t;case Hs:return ms;case Ws:default:return ps}return t.next_out=n,t.avail_out=o,t.next_in=a,t.avail_in=h,i.hold=l,i.bits=u,(i.wsize||p!==t.avail_out&&i.mode<zs&&(i.mode<Xs||e!==ns))&&ur(t,t.output,t.next_out,p-t.avail_out),c-=t.avail_in,p-=t.avail_out,t.total_in+=c,t.total_out+=p,i.total+=p,i.wrap&&p&&(t.adler=i.check=i.flags?yt(i.check,r,p,t.next_out-p):Ct(i.check,r,p,t.next_out-p)),t.data_type=i.bits+(i.last?64:0)+(i.mode===Is?128:0)+(i.mode===Ps||i.mode===ks?256:0),(0===c&&0===p||e===ns)&&D===ls&&(D=_s),D},pr=t=>{if(!t||!t.state)return ps;let e=t.state;return e.window&&(e.window=null),t.state=null,ls},dr=(t,e)=>{if(!t||!t.state)return ps;const i=t.state;return 0===(2&i.wrap)?ps:(i.head=e,e.done=!1,ls)},mr=(t,e)=>{const i=e.length;let s,r,a;return t&&t.state?(s=t.state,0!==s.wrap&&s.mode!==Ns?ps:s.mode===Ns&&(r=1,r=Ct(r,e,i,0),r!==s.check)?ds:(a=ur(t,e,i,i),a?(s.mode=Hs,ms):(s.havedict=1,ls))):ps};var _r=ir,fr=sr,Rr=er,gr=ar,Sr=rr,br=cr,Ar=pr,Cr=dr,Dr=mr,wr="pako inflate (from Nodeca project)",vr={inflateReset:_r,inflateReset2:fr,inflateResetKeep:Rr,inflateInit:gr,inflateInit2:Sr,inflate:br,inflateEnd:Ar,inflateGetHeader:Cr,inflateSetDictionary:Dr,inflateInfo:wr};function yr(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var Nr=yr;const Ir=Object.prototype.toString,{Z_NO_FLUSH:Tr,Z_FINISH:Er,Z_OK:kr,Z_STREAM_END:Or,Z_NEED_DICT:Mr,Z_STREAM_ERROR:Fr,Z_DATA_ERROR:Lr,Z_MEM_ERROR:Pr}=It;function xr(t){this.options=pi.assign({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0===(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ai,this.strm.avail_out=0;let i=vr.inflateInit2(this.strm,e.windowBits);if(i!==kr)throw new Error(Nt[i]);if(this.header=new Nr,vr.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"===typeof e.dictionary?e.dictionary=Si.string2buf(e.dictionary):"[object ArrayBuffer]"===Ir.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(i=vr.inflateSetDictionary(this.strm,e.dictionary),i!==kr)))throw new Error(Nt[i])}function Br(t,e){const i=new xr(e);if(i.push(t),i.err)throw i.msg||Nt[i.err];return i.result}function Gr(t,e){return e=e||{},e.raw=!0,Br(t,e)}xr.prototype.push=function(t,e){const i=this.strm,s=this.options.chunkSize,r=this.options.dictionary;let a,n,h;if(this.ended)return!1;for(n=e===~~e?e:!0===e?Er:Tr,"[object ArrayBuffer]"===Ir.call(t)?i.input=new Uint8Array(t):i.input=t,i.next_in=0,i.avail_in=i.input.length;;){0===i.avail_out&&(i.output=new Uint8Array(s),i.next_out=0,i.avail_out=s),a=vr.inflate(i,n),a===Mr&&r&&(a=vr.inflateSetDictionary(i,r),a===kr?a=vr.inflate(i,n):a===Lr&&(a=Mr));while(i.avail_in>0&&a===Or&&i.state.wrap>0&&0!==t[i.next_in])vr.inflateReset(i),a=vr.inflate(i,n);switch(a){case Fr:case Lr:case Mr:case Pr:return this.onEnd(a),this.ended=!0,!1}if(h=i.avail_out,i.next_out&&(0===i.avail_out||a===Or))if("string"===this.options.to){let t=Si.utf8border(i.output,i.next_out),e=i.next_out-t,r=Si.buf2string(i.output,t);i.next_out=e,i.avail_out=s-e,e&&i.output.set(i.output.subarray(t,t+e),0),this.onData(r)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(a!==kr||0!==h){if(a===Or)return a=vr.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(0===i.avail_in)break}}return!0},xr.prototype.onData=function(t){this.chunks.push(t)},xr.prototype.onEnd=function(t){t===kr&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=pi.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Vr=xr,Ur=Br,qr=Gr,Xr=Br,Zr=It,Yr={Inflate:Vr,inflate:Ur,inflateRaw:qr,ungzip:Xr,constants:Zr};const{Deflate:zr,deflate:Hr,deflateRaw:Wr,gzip:Jr}=Ui,{Inflate:Kr,inflate:jr,inflateRaw:Qr,ungzip:$r}=Yr;var ta=zr,ea=Hr,ia=Wr,sa=Jr,ra=Kr,aa=jr,na=Qr,ha=$r,oa=It,la={Deflate:ta,deflate:ea,deflateRaw:ia,gzip:sa,Inflate:ra,inflate:aa,inflateRaw:na,ungzip:ha,constants:oa}}}]);